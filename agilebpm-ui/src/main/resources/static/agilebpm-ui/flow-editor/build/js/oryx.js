if(!ORYX)var ORYX={};ORYX.Utils={getParamFromUrl:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null==t?null:t[1]},adjustLightness:function(){return arguments[0]},adjustGradient:function(e,t){if(ORYX.CONFIG.DISABLE_GRADIENT&&e){var i=t.getAttributeNS(null,"stop-color")||"#ffffff";$A(e.getElementsByTagName("stop")).each(function(e){e!=t&&e.setAttributeNS(null,"stop-color",i)})}}},XMLNS={ATOM:"http://www.w3.org/2005/Atom",XHTML:"http://www.w3.org/1999/xhtml",ERDF:"http://purl.org/NET/erdf/profile",RDFS:"http://www.w3.org/2000/01/rdf-schema#",RDF:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",RAZIEL:"http://b3mn.org/Raziel",SCHEMA:""};var Kickstart={started:!1,callbacks:[],alreadyLoaded:[],PATH:"",load:function(){Kickstart.kick()},kick:function(){Kickstart.started||(Kickstart.started=!0,Kickstart.callbacks.each(function(e){window.setTimeout(e,1)}))},register:function(callback){with(Kickstart)started?window.setTimeout(callback,1):Kickstart.callbacks.push(callback)},require:function(e){return!Kickstart.alreadyLoaded.member(e)&&Kickstart.include(e)},include:function(e){var t=document.getElementsByTagNameNS(XMLNS.XHTML,"head")[0],i=document.createElementNS(XMLNS.XHTML,"script");return i.setAttributeNS(XMLNS.XHTML,"type","text/javascript"),i.src=Kickstart.PATH+e,t.appendChild(i),Kickstart.alreadyLoaded.push(e),!0}};Event.observe(window,"load",Kickstart.load);var ERDF={LITERAL:1,RESOURCE:2,DELIMITERS:[".","-"],HASH:"#",HYPHEN:"-",schemas:[],callback:void 0,log:void 0,init:function(e){ERDF.callback=e,ERDF.registerSchema("schema",XMLNS.SCHEMA),ERDF.registerSchema("rdfs",XMLNS.RDFS)},run:function(){return ERDF._checkProfile()&&ERDF.parse()},parse:function(){ERDF.__startTime=new Date;var e=document.getElementsByTagNameNS(XMLNS.XHTML,"body"),t={type:ERDF.RESOURCE,value:""},i=ERDF._parseDocumentMetadata()&&ERDF._parseFromTag(e[0],t);ERDF.__stopTime=new Date;ERDF.__stopTime,ERDF.__startTime;return i},_parseDocumentMetadata:function(){var e=document.getElementsByTagNameNS(XMLNS.XHTML,"head"),t=e[0].getElementsByTagNameNS(XMLNS.XHTML,"link"),i=e[0].getElementsByTagNameNS(XMLNS.XHTML,"meta");return $A(t).each(function(e){var t=e.getAttribute("rel"),i=e.getAttribute("rev"),n=e.getAttribute("href");ERDF._parseTriplesFrom(ERDF.RESOURCE,"",t,ERDF.RESOURCE,n),ERDF._parseTriplesFrom(ERDF.RESOURCE,n,i,ERDF.RESOURCE,"")}),$A(i).each(function(e){var t=e.getAttribute("name"),i=e.getAttribute("content");ERDF._parseTriplesFrom(ERDF.RESOURCE,"",t,ERDF.LITERAL,i)}),!0},_parseFromTag:function(e,t,i){if(e&&e.namespaceURI&&e.namespaceURI==XMLNS.XHTML){i||(i=0);var n=e.getAttribute("id");if(e.nodeName.endsWith(":a")||"a"==e.nodeName){var s=e.getAttribute("rel"),o=e.getAttribute("rev"),a=e.getAttribute("href"),r=e.getAttribute("title"),h=e.textContent;ERDF._parseTriplesFrom(t.type,t.value,s,ERDF.RESOURCE,a,function(e){var t=r||h;ERDF._parseTriplesFrom(e.object.type,e.object.value,"rdfs.label",ERDF.LITERAL,t)}),ERDF._parseTriplesFrom(t.type,t.value,o,ERDF.RESOURCE,""),ERDF._parseTypeTriplesFrom(t.type,t.value,s)}else if(e.nodeName.endsWith(":img")||"img"==e.nodeName){s=e.getAttribute("class"),a=e.getAttribute("src");var c=e.getAttribute("alt");ERDF._parseTriplesFrom(t.type,t.value,s,ERDF.RESOURCE,a,function(e){var t=c;ERDF._parseTriplesFrom(e.object.type,e.object.value,"rdfs.label",ERDF.LITERAL,t)})}s=e.getAttribute("class"),r=e.getAttribute("title"),h=e.textContent;var d=r||h;ERDF._parseTriplesFrom(t.type,t.value,s,ERDF.LITERAL,d),n&&(t={type:ERDF.RESOURCE,value:ERDF.HASH+n}),ERDF._parseTypeTriplesFrom(t.type,t.value,s);var l=e.childNodes;l&&$A(l).each(function(e){e.nodeType==e.ELEMENT_NODE&&ERDF._parseFromTag(e,t,i+1)})}},_parseTriplesFrom:function(e,n,t,s,o,a){t&&t.toLowerCase().split(" ").each(function(i){var e=ERDF.schemas.find(function(t){return ERDF.DELIMITERS.find(function(e){return i.startsWith(t.prefix+e)})});if(e&&o){i=i.substring(e.prefix.length+1,i.length);var t=ERDF.registerTriple(new ERDF.Resource(n),{prefix:e.prefix,name:i},s==ERDF.RESOURCE?new ERDF.Resource(o):new ERDF.Literal(o));a&&a(t)}})},_parseTypeTriplesFrom:function(n,s,e,o){e&&e.toLowerCase().split(" ").each(function(i){var e=ERDF.schemas.find(function(t){return ERDF.DELIMITERS.find(function(e){return i.startsWith(ERDF.HYPHEN+t.prefix+e)})});if(e&&s){i=i.substring(e.prefix.length+2,i.length);var t=ERDF.registerTriple(n==ERDF.RESOURCE?new ERDF.Resource(s):new ERDF.Literal(s),{prefix:"rdf",name:"type"},new ERDF.Resource(e.namespace+i));o&&o(t)}})},_checkProfile:function(){var e=document.getElementsByTagNameNS(XMLNS.XHTML,"head")[0].getAttribute("profile");return!(!e||!e.split(" ").member(XMLNS.ERDF))},__stripHashes:function(e){return e&&"function"==typeof e.substring&&"#"==e.substring(0,1)?e.substring(1,e.length):e},registerSchema:function(e,t){ERDF.schemas.push({prefix:e,namespace:t})},registerTriple:function(e,t,i){"schema"==t.prefix.toLowerCase()&&this.registerSchema(t.name,i.value);var n=new ERDF.Triple(e,t,i);return ERDF.callback(n),n},__enhanceObject:function(){this.isResource=function(){return this.type==ERDF.RESOURCE},this.isLocal=function(){return this.isResource()&&this.value.startsWith("#")},this.isCurrentDocument=function(){return this.isResource()&&""==this.value},this.getId=function(){return!!this.isLocal()&&ERDF.__stripHashes(this.value)},this.isLiteral=function(){return this.type==ERDF.LIITERAL}},serialize:function(e){return e?e.constructor==String?e:e.constructor==Boolean?e?"true":"false":e.toString():""},Triple:function(e,t,i){this.subject=e,this.predicate=t,this.object=i,this.toString=function(){return"[ERDF.Triple] "+this.subject.toString()+" "+this.predicate.prefix+":"+this.predicate.name+" "+this.object.toString()}},Resource:function(e){this.type=ERDF.RESOURCE,this.value=e,ERDF.__enhanceObject.apply(this),this.toString=function(){return"&lt;"+this.value+"&gt;"}},Literal:function(e){this.type=ERDF.LITERAL,this.value=ERDF.serialize(e),ERDF.__enhanceObject.apply(this),this.toString=function(){return'"'+this.value+'"'}}},USE_ASYNCHRONOUS_REQUESTS=!0,DISCARD_UNUSED_TRIPLES=!0,PREFER_SPANS_OVER_DIVS=!0,PREFER_TITLE_OVER_TEXTNODE=!1,RESOURCE_ID_PREFIX="resource",SHOW_DEBUG_ALERTS_WHEN_SAVING=!1,SHOW_EXTENDED_DEBUG_INFORMATION=!1,USE_ARESS_WORKAROUNDS=!0,RESOURCE_CREATED=1,RESOURCE_REMOVED=2,RESOURCE_SAVED=4,RESOURCE_RELOADED=8,RESOURCE_SYNCHRONIZED=16,TRIPLE_REMOVE=1,TRIPLE_ADD=2,TRIPLE_RELOAD=4,TRIPLE_SAVE=8,PROCESSDATA_REF="processdata",DataManager={init:function(){ERDF.init(DataManager._registerTriple),DataManager.__synclocal()},_triples:[],_registerTriple:function(e){DataManager._triples.push(e)},__synclocal:function(){DataManager._triples=[],ERDF.run()},__synchronizeShape:function(n){var e=ResourceManager.getResource(n.resourceId);return n.serialize().each(function(e){var t="resource"==e.type,i=new ERDF.Triple(new ERDF.Resource(n.resourceId),{prefix:e.prefix,name:e.name},t?new ERDF.Resource(e.value):new ERDF.Literal(e.value));DataManager.setObject(i)}),e},__storeShape:function(e){DataManager.__synchronizeShape(e).save()},__forceExistance:function(e){if($(e.resourceId)){var t=$(e.resourceId);$A(t.childNodes).each(function(e){t.removeChild(e)})}else $$("."+PROCESSDATA_REF)[0]||DataManager.graft(XMLNS.XHTML,document.getElementsByTagNameNS(XMLNS.XHTML,"body").item(0),["div",{class:PROCESSDATA_REF,style:"display:none;"}]),DataManager.graft(XMLNS.XHTML,$$("."+PROCESSDATA_REF)[0],["div",{id:e.resourceId,class:e instanceof ORYX.Core.Canvas?"-oryx-canvas":void 0}])},__persistShape:function(e){var t=e.serialize(),i=new ERDF.Resource(e.resourceId);DataManager.removeTriples(DataManager.query(i,void 0,void 0)),t.each(function(e){var t="resource"==e.type?new ERDF.Resource(e.value):new ERDF.Literal(e.value);DataManager.addTriple(new ERDF.Triple(i,{prefix:e.prefix,name:e.name},t))})},__persistDOM:function(e){var t=e.getCanvas().getChildShapes(!0),i="";return t.each(function(e){DataManager.__forceExistance(e)}),DataManager.__renderCanvas(e),i+=DataManager.serialize($(ERDF.__stripHashes(e.getCanvas().resourceId)),!0),t.each(function(e){DataManager.__persistShape(e),i+=DataManager.serialize($(ERDF.__stripHashes(e.resourceId)),!0)}),i},__renderCanvas:function(e){var t=e.getCanvas(),i=e.getStencilSets(),n=t.getChildShapes(!0);DataManager.__forceExistance(t),DataManager.__persistShape(t);var s=new ERDF.Resource(t.resourceId);DataManager.removeTriples(DataManager.query(s,void 0,void 0)),DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"mode"},new ERDF.Literal("writable"))),DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"mode"},new ERDF.Literal("fullscreen"))),i.values().each(function(e){DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"stencilset"},new ERDF.Resource(e.source().replace(/&/g,"%26")))),DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"ssnamespace"},new ERDF.Resource(e.namespace()))),e.extensions().keys().each(function(e){DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"ssextension"},new ERDF.Literal(e)))})}),n.each(function(e){DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"render"},new ERDF.Resource("#"+e.resourceId)))})},__counter:0,__provideId:function(){for(;$(RESOURCE_ID_PREFIX+DataManager.__counter);)DataManager.__counter++;return RESOURCE_ID_PREFIX+DataManager.__counter},serializeDOM:function(e){return DataManager.__persistDOM(e)},syncGlobal:function(e){return DataManager.__syncglobal(e)},__syncglobal:function(e){var t=e.getCanvas().getChildShapes(!0);t.select(function(e){return!$(e.resourceId)}).each(function(e){if(USE_ARESS_WORKAROUNDS){var t='<div xmlns="http://www.w3.org/1999/xhtml"><span class="raziel-type">'+e.properties["raziel-type"]+"</span></div>",i=ResourceManager.__createResource(t);e.resourceId=i.id()}else{i=ResourceManager.__createResource();e.resourceId=i.id()}}),t.each(function(e){DataManager.__storeShape(e)})},serialize:function(e,t){if(e.nodeType==e.ELEMENT_NODE){var i=$A(e.childNodes),n=$A(e.attributes);if(new String(e.getAttribute("class")).split(" ").member("transient"))return"";var s="<"+e.nodeName;return t||(s+=' xmlns="'+(e.namespaceURI?e.namespaceURI:XMLNS.XHTML)+'" xmlns:oryx="http://oryx-editor.org"'),n.each(function(e){s+=" "+e.nodeName+'="'+e.nodeValue+'"'}),0==i.length?s+="/>":(s+=">",i.each(function(e){s+=DataManager.serialize(e,!0)}),s+="</"+e.nodeName+">"),s}if(e.nodeType==e.TEXT_NODE)return e.nodeValue},addTriple:function(e){if(!e.subject.type==ERDF.LITERAL)throw"Cannot add the triple "+e.toString()+" because the subject is not a resource.";var t=ERDF.__stripHashes(e.subject.value),i=$(t);if(!i)throw"Cannot add the triple "+e.toString()+' because the subject "'+t+'" is not in the document.';return e.object.type==ERDF.LITERAL?DataManager.graft(XMLNS.XHTML,i,["span",{class:e.predicate.prefix+"-"+e.predicate.name},e.object.value.escapeHTML()]):DataManager.graft(XMLNS.XHTML,i,["a",{rel:e.predicate.prefix+"-"+e.predicate.name,href:e.object.value}]),!0},removeTriples:function(e){return e.select(function(e){return DataManager.__removeTriple(e)})},removeTriple:function(e){return DataManager.__removeTriple(e)},__removeTriple:function(e){if(!e.subject.type==ERDF.LITERAL)throw"Cannot remove the triple "+e.toString()+" because the subject is not a resource.";var t=ERDF.__stripHashes(e.subject.value),i=$(t);if(!i)throw"Cannot remove the triple "+e.toString()+" because the subject is not in the document.";if(e.object.type==ERDF.LITERAL)return DataManager.__removeTripleRecursively(e,i)},__removeTripleRecursively:function(t,e){if(e.nodeType!=e.ELEMENT_NODE)return!1;var i=new String(e.getAttribute("class")),n=$A(e.childNodes);if(i.include(t.predicate.prefix+"-"+t.predicate.name)){var s=e.textContent;return t.object.type==ERDF.LITERAL&&t.object.value==s&&e.parentNode.removeChild(e),!0}return n.each(function(e){DataManager.__removeTripleRecursively(t,e)}),!1},graft:function(e,t,i,n){var s;if(n=n||t&&t.ownerDocument||document,void 0===i)echo("Can't graft an undefined value");else if(i.constructor==String)s=n.createTextNode(i);else for(var o=0;o<i.length;o++){if(0===o&&i[o].constructor==String){var a=i[o].match(/^([a-z][a-z0-9]*)\.([^\s\.]+)$/i);if(a){(s=n.createElementNS(e,a[1])).setAttributeNS(null,"class",a[2]);continue}if(a=i[o].match(/^([a-z][a-z0-9]*)$/i)){s=n.createElementNS(e,a[1]);continue}(s=n.createElementNS(e,"span")).setAttribute(null,"class","namelessFromLOL")}if(void 0===i[o])echo("Can't graft an undefined value in a list!");else if(i[o].constructor==String||i[o].constructor==Array)this.graft(e,s,i[o],n);else if(i[o].constructor==Number)this.graft(e,s,i[o].toString(),n);else if(i[o].constructor==Object)for(var r in i[o])s.setAttributeNS(null,r,i[o][r]);else{if(i[o].constructor!=Boolean)throw"Object "+i[o]+" is inscrutable as an graft arglet.";this.graft(e,s,i[o]?"true":"false",n)}}return t&&t.appendChild(s),Element.extend(s)},setObject:function(e){var t=DataManager.query(e.subject,e.predicate,void 0);return DataManager.removeTriples(t),DataManager.addTriple(e),!0},query:function(i,n,s){return DataManager._triples.select(function(e){var t=!i||e.subject.type==i.type&&e.subject.value==i.value;return n&&(t=(t=t&&(!n.prefix||e.predicate.prefix==n.prefix))&&(!n.name||e.predicate.name==n.name)),t=t&&(!s||e.object.type==s.type&&e.object.value==s.value)})}};function assert(e,t){if(!e)throw t}function DMCommand(e,t){this.action=e,this.triple=t,this.toString=function(){return"Command("+e+", "+t+")"}}function DMCommandHandler(i){this.__setNext=function(e){var t=this.__next;return this.__next=i,t||!0},this.__setNext(i),this.__invokeNext=function(e){return!!this.__next&&this.__next.handle(e)},this.handle=function(e){return!!this.process(e)||this.__invokeNext(e)},this.process=function(e){return!1}}function MetaTagHandler(next){DMCommandHandler.apply(this,[next]),this.process=function(command){with(command.triple)if(!(subject instanceof ERDF.Resource&&subject.isCurrentDocument()&&object instanceof ERDF.Literal))return!1}}Kickstart.register(DataManager.init);var chain=new MetaTagHandler,command=new DMCommand(TRIPLE_ADD,new ERDF.Triple(new ERDF.Resource(""),"rdf:tool",new ERDF.Literal("")));ResourceManager={__corrupt:!1,__latelyCreatedResource:void 0,__listeners:$H(),__token:1,addListener:function(e,t){if(!(e instanceof Function))throw"Resource event listener is not a function!";if(!t)throw"Invalid mask for resource event listener registration.";var i={listener:e,mask:t},n=ResourceManager.__token++;return ResourceManager.__listeners[n]=i,n},removeListener:function(e){return ResourceManager.__listners.remove(e)},__Event:function(e,t){this.action=e,this.resourceId=t},__dispatchEvent:function(t){ResourceManager.__listeners.values().each(function(e){if(t.action&e.mask)return e.listener(t)})},getResource:function(e){e=ERDF.__stripHashes(e);var t=DataManager.query(new ERDF.Resource("#"+e),{prefix:"raziel",name:"entry"},void 0);if(1==t.length&&t[0].object.isResource()){var i=t[0].object.value;return new ResourceManager.__Resource(e,i)}throw"Resource with id "+e+" not recognized as such. "+(1<t.length?" There is more than one raziel:entry URL.":" There is no raziel:entry URL.")},__createResource:function(e){var t=DataManager.query(new ERDF.Resource(""),{prefix:"raziel",name:"collection"},void 0);if(1==t.length&&t[0].object.isResource()){var i=t[0].object.value,n=void 0,s=e||'<div xmlns="http://www.w3.org/1999/xhtml"></div>';return ResourceManager.__request("POST",i,s,function(){var e=this.responseXML.childNodes[0],t=e.getAttribute("id");$$("."+PROCESSDATA_REF)[0]||DataManager.graft(XMLNS.XHTML,document.getElementsByTagNameNS(XMLNS.XHTML,"body").item(0),["div",{class:PROCESSDATA_REF,style:"display:none;"}]),$$("."+PROCESSDATA_REF)[0].appendChild(e.cloneNode(!0)),DataManager.__synclocal(),n=new ResourceManager.getResource(t),ResourceManager.__resourceActionSucceeded(this,RESOURCE_CREATED,void 0)},function(){ResourceManager.__resourceActionFailed(this,RESOURCE_CREATED,void 0)},!1),n}throw"Could not create resource! raziel:collection URL is missing!"},__Resource:function(e,t){this.__id=e,this.__url=t,this.id=function(){return this.__id},this.url=function(){return this.__url},this.reload=function(){var e=this.__url,t=this.__id;ResourceManager.__request("GET",e,null,function(){ResourceManager.__resourceActionSucceeded(this,RESOURCE_RELOADED,t)},function(){ResourceManager.__resourceActionFailed(this,RESURCE_RELOADED,t)},USE_ASYNCHRONOUS_REQUESTS)},this.save=function(e){var t=this.__url,i=this.__id;data=DataManager.serialize($(i)),ResourceManager.__request("PUT",t,data,function(){ResourceManager.__resourceActionSucceeded(this,e?RESOURCE_SAVED|RESOURCE_SYNCHRONIZED:RESOURCE_SAVED,i)},function(){ResourceManager.__resourceActionFailed(this,e?RESOURCE_SAVED|RESOURCE_SYNCHRONIZED:RESOURCE.SAVED,i)},USE_ASYNCHRONOUS_REQUESTS)},this.remove=function(){var e=this.__url,t=this.__id;ResourceManager.__request("DELETE",e,null,function(){ResourceManager.__resourceActionSucceeded(this,RESOURCE_REMOVED,t)},function(){ResourceManager.__resourceActionFailed(this,RESOURCE_REMOVED,t)},USE_ASYNCHRONOUS_REQUESTS)}},request:function(e,t){var i={method:"get",asynchronous:!0,parameters:{}};Object.extend(i,t||{});var n=Hash.toQueryString(i.parameters);return n&&(e+=(e.include("?")?"&":"?")+n),ResourceManager.__request(i.method,e,i.data,i.onSuccess instanceof Function?function(){i.onSuccess(this)}:void 0,i.onFailure instanceof Function?function(){i.onFailure(this)}:void 0,i.asynchronous&&USE_ASYNCHRONOUS_REQUESTS,i.headers)},__request:function(e,t,i,n,s,o,a){var r=Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")});if(!r){if(!this.__corrupt)throw"This browser does not provide any AJAX functionality. You will not be able to use the software provided with the page you are viewing. Please consider installing appropriate extensions.";return!(this.__corrupt=!0)}n instanceof Function&&(r.onload=n),s instanceof Function&&(r.onerror=s);var h=$H(a);h.keys().each(function(e){r.setRequestHeader(e,h[e])});try{SHOW_DEBUG_ALERTS_WHEN_SAVING&&alert(e+" "+t+"\n"+SHOW_EXTENDED_DEBUG_INFORMATION?i:""),r.open(e,t,!!o),r.send(i)}catch(e){return!1}return!0},__resourceActionSucceeded:function(e,t,i){var n=e.status;e.responseText;if(SHOW_DEBUG_ALERTS_WHEN_SAVING&&alert(n+" "+url+"\n"+SHOW_EXTENDED_DEBUG_INFORMATION?data:""),300<=n)throw"The server responded with an error: "+n+"\n"+(SHOW_EXTENDED_DEBUG_INFORMATION?+data:"If you need additional information here, including the data sent by the server, consider setting SHOW_EXTENDED_DEBUG_INFORMATION to true.");switch(t){case RESOURCE_REMOVED:i=(s=e.responseXML.childNodes[0]).getAttribute("id");(o=document.getElementById(i)).parentNode.removeChild(o);break;case RESOURCE_CREATED:break;case RESOURCE_SAVED|RESOURCE_SYNCHRONIZED:DataManager.__synclocal();case RESOURCE_SAVED:break;case RESOURCE_RELOADED:var s,o;i=(s=e.responseXML.childNodes[0]).getAttribute("id");(o=document.getElementById(i)).parentNode.removeChild(o),$$(PROCESSDATA_REF)[0]||DataManager.graft(XMLNS.XHTML,document.getElementsByTagNameNS(XMLNS.XHTML,"body").item(0),["div",{class:PROCESSDATA_REF,style:"display:none;"}]),$$(PROCESSDATA_REF)[0].appendChild(s.cloneNode(!0)),DataManager.__synclocal();break;default:DataManager.__synclocal()}ResourceManager.__dispatchEvent(new ResourceManager.__Event(t,i))},__resourceActionFailed:function(e,t,i){throw"Fatal: Resource action failed. There is something horribly wrong with either the server, the transport protocol or your online status. Sure you're online?"}};var Clazz=function(){};if(Clazz.prototype.construct=function(){},Clazz.extend=function(e){var t=function(){arguments[0]!==Clazz&&this.construct.apply(this,arguments)},i=new this(Clazz),n=this.prototype;for(var s in e){var o=e[s];o instanceof Function&&(o.$=n),i[s]=o}return t.prototype=i,t.extend=this.extend,t},!ORYX)var ORYX={};if(ORYX.CONFIG||(ORYX.CONFIG={}),ORYX.CONFIG.ROOT_PATH="editor/",ORYX.CONFIG.EXPLORER_PATH="explorer",ORYX.CONFIG.LIBS_PATH="libs",ORYX.CONFIG.SERVER_HANDLER_ROOT="service",ORYX.CONFIG.SERVER_EDITOR_HANDLER=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/editor",ORYX.CONFIG.SERVER_MODEL_HANDLER=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/model",ORYX.CONFIG.STENCILSET_HANDLER=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/editor_stencilset?embedsvg=true&url=true&namespace=",ORYX.CONFIG.STENCIL_SETS_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/editor_stencilset",ORYX.CONFIG.PLUGINS_CONFIG="editor-app/plugins.xml",ORYX.CONFIG.SYNTAXCHECKER_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/syntaxchecker",ORYX.CONFIG.DEPLOY_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/model/deploy",ORYX.CONFIG.MODEL_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/models",ORYX.CONFIG.FORM_FLOW_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/formflows",ORYX.CONFIG.FORM_FLOW_IMAGE_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/formflow",ORYX.CONFIG.FORM_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/forms",ORYX.CONFIG.FORM_IMAGE_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/form",ORYX.CONFIG.SUB_PROCESS_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/subprocesses",ORYX.CONFIG.SUB_PROCESS_IMAGE_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/subprocess",ORYX.CONFIG.TEST_SERVICE_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/service/",ORYX.CONFIG.SERVICE_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/services",ORYX.CONFIG.CONDITION_ELEMENT_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/conditionelements",ORYX.CONFIG.VARIABLEDEF_ELEMENT_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/variabledefinitionelements",ORYX.CONFIG.VALIDATOR_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/validators",ORYX.CONFIG.SS_EXTENSIONS_FOLDER=ORYX.CONFIG.ROOT_PATH+"stencilsets/extensions/",ORYX.CONFIG.SS_EXTENSIONS_CONFIG=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/editor_ssextensions",ORYX.CONFIG.ORYX_NEW_URL="/new",ORYX.CONFIG.BPMN_LAYOUTER=ORYX.CONFIG.ROOT_PATH+"bpmnlayouter",ORYX.CONFIG.EXPRESSION_METADATA_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/expression-metadata",ORYX.CONFIG.DATASOURCE_METADATA_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/datasource-metadata",!ORYX)var ORYX={};function printf(){for(var e=arguments[0],t=1;t<arguments.length;t++)e=e.replace("%"+(t-1),arguments[t]);return e}ORYX.CONFIG||(ORYX.CONFIG={}),ORYX.CONFIG.BACKEND_SWITCH=!0,ORYX.CONFIG.PANEL_LEFT_WIDTH=250,ORYX.CONFIG.PANEL_RIGHT_COLLAPSED=!0,ORYX.CONFIG.PANEL_RIGHT_WIDTH=300,ORYX.CONFIG.APPNAME="KISBPM",ORYX.CONFIG.WEB_URL=".",ORYX.CONFIG.BLANK_IMAGE=ORYX.CONFIG.LIBS_PATH+"/ext-2.0.2/resources/images/default/s.gif",ORYX.CONFIG.OFFSET_HEADER=61,ORYX.CONFIG.SHOW_GRIDLINE=!0,ORYX.CONFIG.MODE_READONLY="readonly",ORYX.CONFIG.MODE_FULLSCREEN="fullscreen",ORYX.CONFIG.WINDOW_HEIGHT=800,ORYX.CONFIG.PREVENT_LOADINGMASK_AT_READY=!1,ORYX.CONFIG.PLUGINS_ENABLED=!0,ORYX.CONFIG.PLUGINS_FOLDER="Plugins/",ORYX.CONFIG.BPMN20_SCHEMA_VALIDATION_ON=!0,ORYX.CONFIG.NAMESPACE_ORYX="http://www.b3mn.org/oryx",ORYX.CONFIG.NAMESPACE_SVG="http://www.w3.org/2000/svg",ORYX.CONFIG.CANVAS_WIDTH=1200,ORYX.CONFIG.CANVAS_HEIGHT=1050,ORYX.CONFIG.CANVAS_RESIZE_INTERVAL=100,ORYX.CONFIG.CANVAS_MIN_WIDTH=800,ORYX.CONFIG.CANVAS_MIN_HEIGHT=300,ORYX.CONFIG.SELECTED_AREA_PADDING=4,ORYX.CONFIG.CANVAS_BACKGROUND_COLOR="none",ORYX.CONFIG.GRID_DISTANCE=30,ORYX.CONFIG.GRID_ENABLED=!0,ORYX.CONFIG.ZOOM_OFFSET=.1,ORYX.CONFIG.DEFAULT_SHAPE_MARGIN=60,ORYX.CONFIG.SCALERS_SIZE=7,ORYX.CONFIG.MINIMUM_SIZE=20,ORYX.CONFIG.MAXIMUM_SIZE=1e4,ORYX.CONFIG.OFFSET_MAGNET=15,ORYX.CONFIG.OFFSET_EDGE_LABEL_TOP=8,ORYX.CONFIG.OFFSET_EDGE_LABEL_BOTTOM=8,ORYX.CONFIG.OFFSET_EDGE_BOUNDS=5,ORYX.CONFIG.COPY_MOVE_OFFSET=30,ORYX.CONFIG.BORDER_OFFSET=14,ORYX.CONFIG.MAX_NUM_SHAPES_NO_GROUP=20,ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER=30,ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET=45,ORYX.CONFIG.SHAPEMENU_RIGHT="Oryx_Right",ORYX.CONFIG.SHAPEMENU_BOTTOM="Oryx_Bottom",ORYX.CONFIG.SHAPEMENU_LEFT="Oryx_Left",ORYX.CONFIG.SHAPEMENU_TOP="Oryx_Top",ORYX.CONFIG.MORPHITEM_DISABLED="Oryx_MorphItem_disabled",ORYX.CONFIG.TYPE_STRING="string",ORYX.CONFIG.TYPE_BOOLEAN="boolean",ORYX.CONFIG.TYPE_INTEGER="integer",ORYX.CONFIG.TYPE_FLOAT="float",ORYX.CONFIG.TYPE_COLOR="color",ORYX.CONFIG.TYPE_DATE="date",ORYX.CONFIG.TYPE_CHOICE="choice",ORYX.CONFIG.TYPE_URL="url",ORYX.CONFIG.TYPE_DIAGRAM_LINK="diagramlink",ORYX.CONFIG.TYPE_COMPLEX="complex",ORYX.CONFIG.TYPE_MULTIPLECOMPLEX="multiplecomplex",ORYX.CONFIG.TYPE_TEXT="text",ORYX.CONFIG.TYPE_KISBPM_MULTIINSTANCE="kisbpm-multiinstance",ORYX.CONFIG.TYPE_MODEL_LINK="modellink",ORYX.CONFIG.TYPE_FORM_FLOW_LINK="formflowlink",ORYX.CONFIG.TYPE_FORM_LINK="formlink",ORYX.CONFIG.TYPE_SUB_PROCESS_LINK="subprocesslink",ORYX.CONFIG.TYPE_SERVICE_LINK="servicelink",ORYX.CONFIG.TYPE_CONDITIONS="conditions",ORYX.CONFIG.TYPE_VARIABLES="variables",ORYX.CONFIG.TYPE_LISTENER="listener",ORYX.CONFIG.TYPE_EPC_FREQ="epcfrequency",ORYX.CONFIG.TYPE_GLOSSARY_LINK="glossarylink",ORYX.CONFIG.TYPE_EXPRESSION="expression",ORYX.CONFIG.TYPE_DATASOURCE="datasource",ORYX.CONFIG.TYPE_DATASOURCE_MINIMAL="datasource-minimal",ORYX.CONFIG.TYPE_VALIDATORS="validators",ORYX.CONFIG.LABEL_LINE_DISTANCE=2,ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT=12,ORYX.CONFIG.ENABLE_MORPHMENU_BY_HOVER=!1,ORYX.CONFIG.EDITOR_ALIGN_BOTTOM=1,ORYX.CONFIG.EDITOR_ALIGN_MIDDLE=2,ORYX.CONFIG.EDITOR_ALIGN_TOP=4,ORYX.CONFIG.EDITOR_ALIGN_LEFT=8,ORYX.CONFIG.EDITOR_ALIGN_CENTER=16,ORYX.CONFIG.EDITOR_ALIGN_RIGHT=32,ORYX.CONFIG.EDITOR_ALIGN_SIZE=48,ORYX.CONFIG.EVENT_MOUSEDOWN="mousedown",ORYX.CONFIG.EVENT_MOUSEUP="mouseup",ORYX.CONFIG.EVENT_MOUSEOVER="mouseover",ORYX.CONFIG.EVENT_MOUSEOUT="mouseout",ORYX.CONFIG.EVENT_MOUSEMOVE="mousemove",ORYX.CONFIG.EVENT_DBLCLICK="dblclick",ORYX.CONFIG.EVENT_KEYDOWN="keydown",ORYX.CONFIG.EVENT_KEYUP="keyup",ORYX.CONFIG.EVENT_LOADED="editorloaded",ORYX.CONFIG.EVENT_SAVED="editorSaved",ORYX.CONFIG.EVENT_EXECUTE_COMMANDS="executeCommands",ORYX.CONFIG.EVENT_STENCIL_SET_LOADED="stencilSetLoaded",ORYX.CONFIG.EVENT_SELECTION_CHANGED="selectionchanged",ORYX.CONFIG.EVENT_SHAPEADDED="shapeadded",ORYX.CONFIG.EVENT_SHAPEREMOVED="shaperemoved",ORYX.CONFIG.EVENT_PROPERTY_CHANGED="propertyChanged",ORYX.CONFIG.EVENT_DRAGDROP_START="dragdrop.start",ORYX.CONFIG.EVENT_SHAPE_MENU_CLOSE="shape.menu.close",ORYX.CONFIG.EVENT_DRAGDROP_END="dragdrop.end",ORYX.CONFIG.EVENT_RESIZE_START="resize.start",ORYX.CONFIG.EVENT_RESIZE_END="resize.end",ORYX.CONFIG.EVENT_DRAGDOCKER_DOCKED="dragDocker.docked",ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW="highlight.showHighlight",ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE="highlight.hideHighlight",ORYX.CONFIG.EVENT_LOADING_ENABLE="loading.enable",ORYX.CONFIG.EVENT_LOADING_DISABLE="loading.disable",ORYX.CONFIG.EVENT_LOADING_STATUS="loading.status",ORYX.CONFIG.EVENT_OVERLAY_SHOW="overlay.show",ORYX.CONFIG.EVENT_OVERLAY_HIDE="overlay.hide",ORYX.CONFIG.EVENT_ARRANGEMENT_TOP="arrangement.setToTop",ORYX.CONFIG.EVENT_ARRANGEMENT_BACK="arrangement.setToBack",ORYX.CONFIG.EVENT_ARRANGEMENT_FORWARD="arrangement.setForward",ORYX.CONFIG.EVENT_ARRANGEMENT_BACKWARD="arrangement.setBackward",ORYX.CONFIG.EVENT_PROPWINDOW_PROP_CHANGED="propertyWindow.propertyChanged",ORYX.CONFIG.EVENT_LAYOUT_ROWS="layout.rows",ORYX.CONFIG.EVENT_LAYOUT_BPEL="layout.BPEL",ORYX.CONFIG.EVENT_LAYOUT_BPEL_VERTICAL="layout.BPEL.vertical",ORYX.CONFIG.EVENT_LAYOUT_BPEL_HORIZONTAL="layout.BPEL.horizontal",ORYX.CONFIG.EVENT_LAYOUT_BPEL_SINGLECHILD="layout.BPEL.singlechild",ORYX.CONFIG.EVENT_LAYOUT_BPEL_AUTORESIZE="layout.BPEL.autoresize",ORYX.CONFIG.EVENT_AUTOLAYOUT_LAYOUT="autolayout.layout",ORYX.CONFIG.EVENT_UNDO_EXECUTE="undo.execute",ORYX.CONFIG.EVENT_UNDO_ROLLBACK="undo.rollback",ORYX.CONFIG.EVENT_BUTTON_UPDATE="toolbar.button.update",ORYX.CONFIG.EVENT_LAYOUT="layout.dolayout",ORYX.CONFIG.EVENT_GLOSSARY_LINK_EDIT="glossary.link.edit",ORYX.CONFIG.EVENT_GLOSSARY_SHOW="glossary.show.info",ORYX.CONFIG.EVENT_GLOSSARY_NEW="glossary.show.new",ORYX.CONFIG.EVENT_DOCKERDRAG="dragTheDocker",ORYX.CONFIG.EVENT_CANVAS_SCROLL="canvas.scroll",ORYX.CONFIG.EVENT_SHOW_PROPERTYWINDOW="propertywindow.show",ORYX.CONFIG.EVENT_ABOUT_TO_SAVE="file.aboutToSave",ORYX.CONFIG.SELECTION_HIGHLIGHT_SIZE=5,ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR="#4444FF",ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR2="#9999FF",ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_CORNER="corner",ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_RECTANGLE="rectangle",ORYX.CONFIG.SELECTION_VALID_COLOR="#00FF00",ORYX.CONFIG.SELECTION_INVALID_COLOR="#FF0000",ORYX.CONFIG.DOCKER_DOCKED_COLOR="#00FF00",ORYX.CONFIG.DOCKER_UNDOCKED_COLOR="#FF0000",ORYX.CONFIG.DOCKER_SNAP_OFFSET=10,ORYX.CONFIG.EDIT_OFFSET_PASTE=10,ORYX.CONFIG.KEY_CODE_X=88,ORYX.CONFIG.KEY_CODE_C=67,ORYX.CONFIG.KEY_CODE_V=86,ORYX.CONFIG.KEY_CODE_DELETE=46,ORYX.CONFIG.KEY_CODE_META=224,ORYX.CONFIG.KEY_CODE_BACKSPACE=8,ORYX.CONFIG.KEY_CODE_LEFT=37,ORYX.CONFIG.KEY_CODE_RIGHT=39,ORYX.CONFIG.KEY_CODE_UP=38,ORYX.CONFIG.KEY_CODE_DOWN=40,ORYX.CONFIG.KEY_Code_enter=12,ORYX.CONFIG.KEY_Code_left=37,ORYX.CONFIG.KEY_Code_right=39,ORYX.CONFIG.KEY_Code_top=38,ORYX.CONFIG.KEY_Code_bottom=40,ORYX.CONFIG.META_KEY_META_CTRL="metactrl",ORYX.CONFIG.META_KEY_ALT="alt",ORYX.CONFIG.META_KEY_SHIFT="shift",ORYX.CONFIG.KEY_ACTION_DOWN="down",ORYX.CONFIG.KEY_ACTION_UP="up",ORYX.CONFIG.FORM_ROW_WIDTH=350,ORYX.CONFIG.FORM_GROUP_MARGIN=5,ORYX.CONFIG.FORM_GROUP_EMPTY_HEIGHT=100,ORYX.CONFIG.FORM_ELEMENT_ID_PREFIX="http://b3mn.org/stencilset/xforms",ORYX.CONFIG.FORM_ELEMENT_TYPE_ROOT="http://b3mn.org/stencilset/xforms#XForm",ORYX.CONFIG.FORM_ELEMENT_TYPE_GROUP="http://b3mn.org/stencilset/xforms#Group",ORYX.CONFIG.FORM_ELEMENT_TYPE_REPEATING_GROUP="http://b3mn.org/stencilset/xforms#RepeatingGroup",ORYX.CONFIG.FORM_ELEMENT_TYPE_LABEL_FIELD="http://b3mn.org/stencilset/xforms#LabelField";var ORYX_LOGLEVEL_TRACE=5,ORYX_LOGLEVEL_DEBUG=4,ORYX_LOGLEVEL_INFO=3,ORYX_LOGLEVEL_WARN=2,ORYX_LOGLEVEL_ERROR=1,ORYX_LOGLEVEL_FATAL=0,ORYX_LOGLEVEL=3,ORYX_CONFIGURATION_DELAY=100,ORYX_CONFIGURATION_WAIT_ATTEMPTS=10;if(!ORYX)var ORYX={};if(ORYX=Object.extend(ORYX,{PATH:ORYX.CONFIG.ROOT_PATH,URLS:[],alreadyLoaded:[],configrationRetries:0,Version:"0.1.1",availablePlugins:[],Log:{__appenders:[{append:function(e){"undefined"!=typeof console&&void 0!==console.log&&console.log(e)}}],trace:function(){ORYX_LOGLEVEL_TRACE<=ORYX_LOGLEVEL&&ORYX.Log.__log("TRACE",arguments)},debug:function(){ORYX_LOGLEVEL_DEBUG<=ORYX_LOGLEVEL&&ORYX.Log.__log("DEBUG",arguments)},info:function(){ORYX_LOGLEVEL_INFO<=ORYX_LOGLEVEL&&ORYX.Log.__log("INFO",arguments)},warn:function(){ORYX_LOGLEVEL_WARN<=ORYX_LOGLEVEL&&ORYX.Log.__log("WARN",arguments)},error:function(){ORYX_LOGLEVEL_ERROR<=ORYX_LOGLEVEL&&ORYX.Log.__log("ERROR",arguments)},fatal:function(){ORYX_LOGLEVEL_FATAL<=ORYX_LOGLEVEL&&ORYX.Log.__log("FATAL",arguments)},__log:function(e,t){t[0]=(new Date).getTime()+" "+e+" "+t[0];var i=printf.apply(null,t);ORYX.Log.__appenders.each(function(e){e.append(i)})},addAppender:function(e){ORYX.Log.__appenders.push(e)}},load:function(){if(ORYX.Log.debug("Oryx begins loading procedure."),"undefined"==typeof Prototype||"undefined"==typeof Element||void 0===Element.Methods||parseFloat(Prototype.Version.split(".")[0]+"."+Prototype.Version.split(".")[1])<1.5)throw"Application requires the Prototype JavaScript framework >= 1.5.3";ORYX.Log.debug("Prototype > 1.5 found."),ORYX._load()},_load:function(){ORYX.loadPlugins()},loadPlugins:function(){ORYX.CONFIG.PLUGINS_ENABLED?ORYX._loadPlugins():ORYX.Log.warn("Ignoring plugins, loading Core only."),init()},_loadPlugins:function(){var e=ORYX.CONFIG.PLUGINS_CONFIG;ORYX.Log.debug("Loading plugin configuration from '%0'.",e),new Ajax.Request(e,{asynchronous:!1,method:"get",onSuccess:function(e){ORYX.Log.info("Plugin configuration file loaded.");var t=e.responseXML,c=[];$A(t.getElementsByTagName("properties")).each(function(e){$A(e.childNodes).each(function(e){var t=new Hash,i=$A(e.attributes);i.each(function(e){t[e.nodeName]=e.nodeValue}),0<i.length&&c.push(t)})});var i=t.getElementsByTagName("plugin");$A(i).each(function(e){var t=new Hash;if($A(e.attributes).each(function(e){t[e.nodeName]=e.nodeValue}),t.name)if(t.source){var i=e.getElementsByTagName("property"),n=[];$A(i).each(function(e){var t=new Hash,i=$A(e.attributes);i.each(function(e){t[e.nodeName]=e.nodeValue}),0<i.length&&n.push(t)}),n=n.concat(c),t.properties=n;var s,o=e.getElementsByTagName("requires");$A(o).each(function(e){var t=$A(e.attributes).find(function(e){return"namespace"==e.name});t&&t.nodeValue&&(s||(s={namespaces:[]}),s.namespaces.push(t.nodeValue))}),s&&(t.requires=s);var a,r=e.getElementsByTagName("notUsesIn");$A(r).each(function(e){var t=$A(e.attributes).find(function(e){return"namespace"==e.name});t&&t.nodeValue&&(a||(a={namespaces:[]}),a.namespaces.push(t.nodeValue))}),a&&(t.notUsesIn=a);var h=ORYX.PATH+ORYX.CONFIG.PLUGINS_FOLDER+t.source;ORYX.Log.debug("Requireing '%0'",h),ORYX.Log.info("Plugin '%0' successfully loaded.",t.name),ORYX.availablePlugins.push(t)}else ORYX.Log.error("Plugin with name '%0' doesn't provide a source attribute.",t.name);else ORYX.Log.error("A plugin is not providing a name. Ingnoring this plugin.")})},onFailure:this._loadPluginsOnFails})},_loadPluginsOnFails:function(e){ORYX.Log.error("Plugin configuration file not available.")}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.EditPathHandler=Clazz.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.x=0,this.y=0,this.oldX=0,this.oldY=0,this.deltaWidth=1,this.deltaHeight=1,this.d=""},init:function(e,t,i,n,s,o){this.x=e,this.y=t,this.oldX=i,this.oldY=n,this.deltaWidth=s,this.deltaHeight=o,this.d=""},editPointsAbs:function(e){if(e instanceof Array){for(var t,i,n=[],s=0;s<e.length;s++)t=(parseFloat(e[s])-this.oldX)*this.deltaWidth+this.x,s++,i=(parseFloat(e[s])-this.oldY)*this.deltaHeight+this.y,n.push(t),n.push(i);return n}},editPointsRel:function(e){if(e instanceof Array){for(var t,i,n=[],s=0;s<e.length;s++)t=parseFloat(e[s])*this.deltaWidth,s++,i=parseFloat(e[s])*this.deltaHeight,n.push(t),n.push(i);return n}},arcAbs:function(e,t,i,n,s,o,a){var r=this.editPointsAbs([o,a]),h=this.editPointsRel([e,t]);this.d=this.d.concat(" A"+h[0]+" "+h[1]+" "+i+" "+n+" "+s+" "+r[0]+" "+r[1]+" ")},arcRel:function(e,t,i,n,s,o,a){var r=this.editPointsRel([e,t,o,a]);this.d=this.d.concat(" a"+r[0]+" "+r[1]+" "+i+" "+n+" "+s+" "+r[2]+" "+r[3]+" ")},curvetoCubicAbs:function(e,t,i,n,s,o){var a=this.editPointsAbs([e,t,i,n,s,o]);this.d=this.d.concat(" C"+a[0]+" "+a[1]+" "+a[2]+" "+a[3]+" "+a[4]+" "+a[5]+" ")},curvetoCubicRel:function(e,t,i,n,s,o){var a=this.editPointsRel([e,t,i,n,s,o]);this.d=this.d.concat(" c"+a[0]+" "+a[1]+" "+a[2]+" "+a[3]+" "+a[4]+" "+a[5]+" ")},linetoHorizontalAbs:function(e){var t=this.editPointsAbs([e,0]);this.d=this.d.concat(" H"+t[0]+" ")},linetoHorizontalRel:function(e){var t=this.editPointsRel([e,0]);this.d=this.d.concat(" h"+t[0]+" ")},linetoAbs:function(e,t){var i=this.editPointsAbs([e,t]);this.d=this.d.concat(" L"+i[0]+" "+i[1]+" ")},linetoRel:function(e,t){var i=this.editPointsRel([e,t]);this.d=this.d.concat(" l"+i[0]+" "+i[1]+" ")},movetoAbs:function(e,t){var i=this.editPointsAbs([e,t]);this.d=this.d.concat(" M"+i[0]+" "+i[1]+" ")},movetoRel:function(e,t){var i;i=""===this.d?this.editPointsAbs([e,t]):this.editPointsRel([e,t]),this.d=this.d.concat(" m"+i[0]+" "+i[1]+" ")},curvetoQuadraticAbs:function(e,t,i,n){var s=this.editPointsAbs([e,t,i,n]);this.d=this.d.concat(" Q"+s[0]+" "+s[1]+" "+s[2]+" "+s[3]+" ")},curvetoQuadraticRel:function(e,t,i,n){var s=this.editPointsRel([e,t,i,n]);this.d=this.d.concat(" q"+s[0]+" "+s[1]+" "+s[2]+" "+s[3]+" ")},curvetoCubicSmoothAbs:function(e,t,i,n){var s=this.editPointsAbs([e,t,i,n]);this.d=this.d.concat(" S"+s[0]+" "+s[1]+" "+s[2]+" "+s[3]+" ")},curvetoCubicSmoothRel:function(e,t,i,n){var s=this.editPointsRel([e,t,i,n]);this.d=this.d.concat(" s"+s[0]+" "+s[1]+" "+s[2]+" "+s[3]+" ")},curvetoQuadraticSmoothAbs:function(e,t){var i=this.editPointsAbs([e,t]);this.d=this.d.concat(" T"+i[0]+" "+i[1]+" ")},curvetoQuadraticSmoothRel:function(e,t){var i=this.editPointsRel([e,t]);this.d=this.d.concat(" t"+i[0]+" "+i[1]+" ")},linetoVerticalAbs:function(e){var t=this.editPointsAbs([0,e]);this.d=this.d.concat(" V"+t[1]+" ")},linetoVerticalRel:function(e){var t=this.editPointsRel([0,e]);this.d=this.d.concat(" v"+t[1]+" ")},closePath:function(){this.d=this.d.concat(" z")}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.MinMaxPathHandler=Clazz.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.minX=void 0,this.minY=void 0,this.maxX=void 0,this.maxY=void 0,this._lastAbsX=void 0,this._lastAbsY=void 0},calculateMinMax:function(e){if(e instanceof Array)for(var t,i,n=0;n<e.length;n++)t=parseFloat(e[n]),n++,i=parseFloat(e[n]),this.minX=void 0!==this.minX?Math.min(this.minX,t):t,this.maxX=void 0!==this.maxX?Math.max(this.maxX,t):t,this.minY=void 0!==this.minY?Math.min(this.minY,i):i,this.maxY=void 0!==this.maxY?Math.max(this.maxY,i):i,this._lastAbsX=t,this._lastAbsY=i},arcAbs:function(e,t,i,n,s,o,a){this.calculateMinMax([o,a])},arcRel:function(e,t,i,n,s,o,a){this.calculateMinMax([this._lastAbsX+o,this._lastAbsY+a])},curvetoCubicAbs:function(e,t,i,n,s,o){this.calculateMinMax([e,t,i,n,s,o])},curvetoCubicRel:function(e,t,i,n,s,o){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t,this._lastAbsX+i,this._lastAbsY+n,this._lastAbsX+s,this._lastAbsY+o])},linetoHorizontalAbs:function(e){this.calculateMinMax([e,this._lastAbsY])},linetoHorizontalRel:function(e){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY])},linetoAbs:function(e,t){this.calculateMinMax([e,t])},linetoRel:function(e,t){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t])},movetoAbs:function(e,t){this.calculateMinMax([e,t])},movetoRel:function(e,t){this._lastAbsX&&this._lastAbsY?this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t]):this.calculateMinMax([e,t])},curvetoQuadraticAbs:function(e,t,i,n){this.calculateMinMax([e,t,i,n])},curvetoQuadraticRel:function(e,t,i,n){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t,this._lastAbsX+i,this._lastAbsY+n])},curvetoCubicSmoothAbs:function(e,t,i,n){this.calculateMinMax([e,t,i,n])},curvetoCubicSmoothRel:function(e,t,i,n){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t,this._lastAbsX+i,this._lastAbsY+n])},curvetoQuadraticSmoothAbs:function(e,t){this.calculateMinMax([e,t])},curvetoQuadraticSmoothRel:function(e,t){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t])},linetoVerticalAbs:function(e){this.calculateMinMax([this._lastAbsX,e])},linetoVerticalRel:function(e){this.calculateMinMax([this._lastAbsX,this._lastAbsY+e])},closePath:function(){}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.PointsPathHandler=Clazz.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.points=[],this._lastAbsX=void 0,this._lastAbsY=void 0},addPoints:function(e){if(e instanceof Array)for(var t,i,n=0;n<e.length;n++)t=parseFloat(e[n]),n++,i=parseFloat(e[n]),this.points.push(t),this.points.push(i),this._lastAbsX=t,this._lastAbsY=i},arcAbs:function(e,t,i,n,s,o,a){this.addPoints([o,a])},arcRel:function(e,t,i,n,s,o,a){this.addPoints([this._lastAbsX+o,this._lastAbsY+a])},curvetoCubicAbs:function(e,t,i,n,s,o){this.addPoints([s,o])},curvetoCubicRel:function(e,t,i,n,s,o){this.addPoints([this._lastAbsX+s,this._lastAbsY+o])},linetoHorizontalAbs:function(e){this.addPoints([e,this._lastAbsY])},linetoHorizontalRel:function(e){this.addPoints([this._lastAbsX+e,this._lastAbsY])},linetoAbs:function(e,t){this.addPoints([e,t])},linetoRel:function(e,t){this.addPoints([this._lastAbsX+e,this._lastAbsY+t])},movetoAbs:function(e,t){this.addPoints([e,t])},movetoRel:function(e,t){this._lastAbsX&&this._lastAbsY?this.addPoints([this._lastAbsX+e,this._lastAbsY+t]):this.addPoints([e,t])},curvetoQuadraticAbs:function(e,t,i,n){this.addPoints([i,n])},curvetoQuadraticRel:function(e,t,i,n){this.addPoints([this._lastAbsX+i,this._lastAbsY+n])},curvetoCubicSmoothAbs:function(e,t,i,n){this.addPoints([i,n])},curvetoCubicSmoothRel:function(e,t,i,n){this.addPoints([this._lastAbsX+i,this._lastAbsY+n])},curvetoQuadraticSmoothAbs:function(e,t){this.addPoints([e,t])},curvetoQuadraticSmoothRel:function(e,t){this.addPoints([this._lastAbsX+e,this._lastAbsY+t])},linetoVerticalAbs:function(e){this.addPoints([this._lastAbsX,e])},linetoVerticalRel:function(e){this.addPoints([this._lastAbsX,this._lastAbsY+e])},closePath:function(){}}),NAMESPACE_ORYX="http://www.b3mn.org/oryx",NAMESPACE_SVG="http://www.w3.org/2000/svg/",!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.SVGMarker=Clazz.extend({construct:function(e){arguments.callee.$.construct.apply(this,arguments),this.id=void 0,this.element=e,this.refX=void 0,this.refY=void 0,this.markerWidth=void 0,this.markerHeight=void 0,this.oldRefX=void 0,this.oldRefY=void 0,this.oldMarkerWidth=void 0,this.oldMarkerHeight=void 0,this.optional=!1,this.enabled=!0,this.minimumLength=void 0,this.resize=!1,this.svgShapes=[],this._init()},_init:function(){if("[object SVGMarkerElement]"!=this.element)throw"SVGMarker: Argument is not an instance of SVGMarkerElement.";this.id=this.element.getAttributeNS(null,"id");var e=this.element.getAttributeNS(null,"refX");this.refX=e?parseFloat(e):0;var t=this.element.getAttributeNS(null,"refY");this.refY=t?parseFloat(t):0;var i=this.element.getAttributeNS(null,"markerWidth");this.markerWidth=i?parseFloat(i):3;var n=this.element.getAttributeNS(null,"markerHeight");this.markerHeight=n?parseFloat(n):3,this.oldRefX=this.refX,this.oldRefY=this.refY,this.oldMarkerWidth=this.markerWidth,this.oldMarkerHeight=this.markerHeight;var s=this.element.getAttributeNS(NAMESPACE_ORYX,"optional");s?(s=s.strip(),this.optional="yes"===s.toLowerCase()):this.optional=!1;var o=this.element.getAttributeNS(NAMESPACE_ORYX,"enabled");o?(o=o.strip(),this.enabled=!("no"===o.toLowerCase())):this.enabled=!0;var a=this.element.getAttributeNS(NAMESPACE_ORYX,"minimumLength");a&&(this.minimumLength=parseFloat(a));var r=this.element.getAttributeNS(NAMESPACE_ORYX,"resize");r?(r=r.strip(),this.resize="yes"===r.toLowerCase()):this.resize=!1},_getSVGShapes:function(e){if(e.hasChildNodes){var i=[],n=this;return $A(e.childNodes).each(function(t){try{var e=new ORYX.Core.SVG.SVGShape(t);i.push(e)}catch(e){i=i.concat(n._getSVGShapes(t))}}),i}},update:function(){this.oldRefX=this.refX,this.oldRefY=this.refY,this.oldMarkerWidth=this.markerWidth,this.oldMarkerHeight=this.markerHeight},toString:function(){return this.element?"SVGMarker "+this.element.id:"SVGMarker "+this.element}}),NAMESPACE_ORYX="http://www.b3mn.org/oryx",NAMESPACE_SVG="http://www.w3.org/2000/svg/",!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.SVGShape=Clazz.extend({construct:function(e){arguments.callee.$.construct.apply(this,arguments),this.type,this.element=e,this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.oldX=void 0,this.oldY=void 0,this.oldWidth=void 0,this.oldHeight=void 0,this.radiusX=void 0,this.radiusY=void 0,this.isHorizontallyResizable=!1,this.isVerticallyResizable=!1,this.anchorLeft=!1,this.anchorRight=!1,this.anchorTop=!1,this.anchorBottom=!1,this.allowDockers=!0,this.resizeMarkerMid=!1,this.editPathParser,this.editPathHandler,this.init()},init:function(){if(ORYX.Editor.checkClassType(this.element,SVGRectElement)||ORYX.Editor.checkClassType(this.element,SVGImageElement)){this.type="Rect";var e=this.element.getAttributeNS(null,"x");if(!e)throw"Missing attribute in element "+this.element;this.oldX=parseFloat(e);var t=this.element.getAttributeNS(null,"y");if(!t)throw"Missing attribute in element "+this.element;this.oldY=parseFloat(t);var i=this.element.getAttributeNS(null,"width");if(!i)throw"Missing attribute in element "+this.element;this.oldWidth=parseFloat(i);var n=this.element.getAttributeNS(null,"height");if(!n)throw"Missing attribute in element "+this.element;this.oldHeight=parseFloat(n)}else if(ORYX.Editor.checkClassType(this.element,SVGCircleElement)){this.type="Circle";var s=void 0,o=void 0;if(!(r=this.element.getAttributeNS(null,"cx")))throw"Missing attribute in element "+this.element;if(s=parseFloat(r),!(h=this.element.getAttributeNS(null,"cy")))throw"Missing attribute in element "+this.element;o=parseFloat(h);var a=this.element.getAttributeNS(null,"r");if(!a)throw"Missing attribute in element "+this.element;this.radiusX=parseFloat(a),this.oldX=s-this.radiusX,this.oldY=o-this.radiusX,this.oldWidth=2*this.radiusX,this.oldHeight=2*this.radiusX}else if(ORYX.Editor.checkClassType(this.element,SVGEllipseElement)){this.type="Ellipse";var r,h;s=void 0,o=void 0;if(!(r=this.element.getAttributeNS(null,"cx")))throw"Missing attribute in element "+this.element;if(s=parseFloat(r),!(h=this.element.getAttributeNS(null,"cy")))throw"Missing attribute in element "+this.element;o=parseFloat(h);var c=this.element.getAttributeNS(null,"rx");if(!c)throw"Missing attribute in element "+this.element;this.radiusX=parseFloat(c);var d=this.element.getAttributeNS(null,"ry");if(!d)throw"Missing attribute in element "+this.element;this.radiusY=parseFloat(d),this.oldX=s-this.radiusX,this.oldY=o-this.radiusY,this.oldWidth=2*this.radiusX,this.oldHeight=2*this.radiusY}else if(ORYX.Editor.checkClassType(this.element,SVGLineElement)){this.type="Line";var l=void 0,u=void 0,f=void 0,g=void 0,p=this.element.getAttributeNS(null,"x1");if(!p)throw"Missing attribute in element "+this.element;l=parseFloat(p);var O=this.element.getAttributeNS(null,"y1");if(!O)throw"Missing attribute in element "+this.element;u=parseFloat(O);var R=this.element.getAttributeNS(null,"x2");if(!R)throw"Missing attribute in element "+this.element;f=parseFloat(R);var S=this.element.getAttributeNS(null,"y2");if(!S)throw"Missing attribute in element "+this.element;g=parseFloat(S),this.oldX=Math.min(l,f),this.oldY=Math.min(u,g),this.oldWidth=Math.abs(l-f),this.oldHeight=Math.abs(u-g)}else if(ORYX.Editor.checkClassType(this.element,SVGPolylineElement)||ORYX.Editor.checkClassType(this.element,SVGPolygonElement)){this.type="Polyline";var m=[];if(this.element.points&&this.element.points.numberOfItems)for(var v=0,E=this.element.points.numberOfItems;v<E;v++)m.push(this.element.points.getItem(v).x),m.push(this.element.points.getItem(v).y);else{var b=this.element.getAttributeNS(null,"points");if(!b)throw"Missing attribute in element "+this.element;m=(m=(b=b.replace(/,/g," ")).split(" ")).without("")}if(!(m&&m.length&&1<m.length))throw"Missing attribute in element "+this.element;var C=parseFloat(m[0]),_=parseFloat(m[1]),N=parseFloat(m[0]),y=parseFloat(m[1]);for(v=0;v<m.length;v++)C=Math.min(C,parseFloat(m[v])),N=Math.max(N,parseFloat(m[v])),v++,_=Math.min(_,parseFloat(m[v])),y=Math.max(y,parseFloat(m[v]));this.oldX=C,this.oldY=_,this.oldWidth=N-C,this.oldHeight=y-_}else{if(!ORYX.Editor.checkClassType(this.element,SVGPathElement))throw"Element is not a shape.";this.type="Path",this.editPathParser=new PathParser,this.editPathHandler=new ORYX.Core.SVG.EditPathHandler,this.editPathParser.setHandler(this.editPathHandler);var Y=new PathParser,X=new ORYX.Core.SVG.MinMaxPathHandler;Y.setHandler(X),Y.parsePath(this.element),this.oldX=X.minX,this.oldY=X.minY,this.oldWidth=X.maxX-X.minX,this.oldHeight=X.maxY-X.minY,delete Y,delete X}var x=this.element.getAttributeNS(NAMESPACE_ORYX,"resize");x?((x=x.toLowerCase()).match(/horizontal/)?this.isHorizontallyResizable=!0:this.isHorizontallyResizable=!1,x.match(/vertical/)?this.isVerticallyResizable=!0:this.isVerticallyResizable=!1):(this.isHorizontallyResizable=!1,this.isVerticallyResizable=!1);var I=this.element.getAttributeNS(NAMESPACE_ORYX,"anchors");if(I){var A=(I=I.replace("/,/g"," ")).split(" ").without("");for(v=0;v<A.length;v++)switch(A[v].toLowerCase()){case"left":this.anchorLeft=!0;break;case"right":this.anchorRight=!0;break;case"top":this.anchorTop=!0;break;case"bottom":this.anchorBottom=!0}}if(ORYX.Editor.checkClassType(this.element,SVGPathElement)){var k=this.element.getAttributeNS(NAMESPACE_ORYX,"allowDockers");k&&("no"===k.toLowerCase()?this.allowDockers=!1:this.allowDockers=!0);var w=this.element.getAttributeNS(NAMESPACE_ORYX,"resizeMarker-mid");w&&("yes"===w.toLowerCase()?this.resizeMarkerMid=!0:this.resizeMarkerMid=!1)}this.x=this.oldX,this.y=this.oldY,this.width=this.oldWidth,this.height=this.oldHeight},update:function(){if(this.x!==this.oldX||this.y!==this.oldY||this.width!==this.oldWidth||this.height!==this.oldHeight){switch(this.type){case"Rect":this.x!==this.oldX&&this.element.setAttributeNS(null,"x",this.x),this.y!==this.oldY&&this.element.setAttributeNS(null,"y",this.y),this.width!==this.oldWidth&&this.element.setAttributeNS(null,"width",this.width),this.height!==this.oldHeight&&this.element.setAttributeNS(null,"height",this.height);break;case"Circle":this.radiusX=(this.width<this.height?this.width:this.height)/2,this.element.setAttributeNS(null,"cx",this.x+this.width/2),this.element.setAttributeNS(null,"cy",this.y+this.height/2),this.element.setAttributeNS(null,"r",this.radiusX);break;case"Ellipse":this.radiusX=this.width/2,this.radiusY=this.height/2,this.element.setAttributeNS(null,"cx",this.x+this.radiusX),this.element.setAttributeNS(null,"cy",this.y+this.radiusY),this.element.setAttributeNS(null,"rx",this.radiusX),this.element.setAttributeNS(null,"ry",this.radiusY);break;case"Line":this.x!==this.oldX&&this.element.setAttributeNS(null,"x1",this.x),this.y!==this.oldY&&this.element.setAttributeNS(null,"y1",this.y),this.x===this.oldX&&this.width===this.oldWidth||this.element.setAttributeNS(null,"x2",this.x+this.width),this.y===this.oldY&&this.height===this.oldHeight||this.element.setAttributeNS(null,"y2",this.y+this.height);break;case"Polyline":var e=this.element.getAttributeNS(null,"points");if(e&&(e=e.replace(/,/g," ").split(" ").without(""))&&e.length&&1<e.length){for(var t=0===this.oldWidth?0:this.width/this.oldWidth,i=0===this.oldHeight?0:this.height/this.oldHeight,n="",s=0;s<e.length;s++){var o=(parseFloat(e[s])-this.oldX)*t+this.x;s++,n+=o+" "+((parseFloat(e[s])-this.oldY)*i+this.y)+" "}this.element.setAttributeNS(null,"points",n)}break;case"Path":t=0===this.oldWidth?0:this.width/this.oldWidth,i=0===this.oldHeight?0:this.height/this.oldHeight;this.editPathHandler.init(this.x,this.y,this.oldX,this.oldY,t,i),this.editPathParser.parsePath(this.element),this.element.setAttributeNS(null,"d",this.editPathHandler.d)}this.oldX=this.x,this.oldY=this.y,this.oldWidth=this.width,this.oldHeight=this.height}delete this.visible,delete this.handler},isPointIncluded:function(e,t){if(!e||!t||!this.isVisible())return!1;switch(this.type){case"Rect":return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height;case"Circle":return ORYX.Core.Math.isPointInEllipse(e,t,this.x+this.width/2,this.y+this.height/2,this.radiusX,this.radiusX);case"Ellipse":return ORYX.Core.Math.isPointInEllipse(e,t,this.x+this.radiusX,this.y+this.radiusY,this.radiusX,this.radiusY);case"Line":return ORYX.Core.Math.isPointInLine(e,t,this.x,this.y,this.x+this.width,this.y+this.height);case"Polyline":var i=this.element.getAttributeNS(null,"points");return!!i&&(i=(i=i.replace(/,/g," ").split(" ").without("")).collect(function(e){return parseFloat(e)}),ORYX.Core.Math.isPointInPolygone(e,t,i));case"Path":if(!this.handler){var n=new PathParser;this.handler=new ORYX.Core.SVG.PointsPathHandler,n.setHandler(this.handler),n.parsePath(this.element)}return ORYX.Core.Math.isPointInPolygone(e,t,this.handler.points);default:return!1}},isVisible:function(e){if(void 0!==this.visible)return this.visible;e||(e=this.element);var t=!1;try{t=!!e.ownerSVGElement}catch(e){}if(t){if(ORYX.Editor.checkClassType(e,SVGGElement)&&e.className&&"me"==e.className.baseVal)return this.visible=!0,this.visible;var i=e.getAttributeNS(null,"fill"),n=e.getAttributeNS(null,"stroke");if(i&&"none"==i&&n&&"none"==n)this.visible=!1;else{var s=e.getAttributeNS(null,"display");this.visible=s?"none"!=s:this.isVisible(e.parentNode)}}else this.visible=!0;return this.visible},toString:function(){return this.element?"SVGShape "+this.element.id:"SVGShape "+this.element}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.Label=Clazz.extend({_characterSets:["%W","@","m","wDGMOQ?????#+=<>~^","ABCHKNRSUVXZ??????????&","bdghnopqux???????????ETY1234567890?????_????${}*????`???????????","aeksvyz?????FLP????????????????","c-",'rtJ"/()[]:;!|\\',"fjI., ","'","il"],_characterSetValues:[15,14,13,11,10,9,8,7,6,5,4,3],construct:function(e){if(arguments.callee.$.construct.apply(this,arguments),!e.textElement)throw"Label: No parameter textElement.";if(!ORYX.Editor.checkClassType(e.textElement,SVGTextElement))throw"Label: Parameter textElement is not an SVGTextElement.";this.invisibleRenderPoint=-5e3,this.node=e.textElement,this.node.setAttributeNS(null,"stroke-width","0pt"),this.node.setAttributeNS(null,"letter-spacing","-0.01px"),this.shapeId=e.shapeId,this.id,this.fitToElemId,this.edgePosition,this.x,this.y,this.oldX,this.oldY,this.isVisible=!0,this._text,this._verticalAlign,this._horizontalAlign,this._rotate,this._rotationPoint,this.anchorLeft,this.anchorRight,this.anchorTop,this.anchorBottom,this._isChanged=!0;var t=this.node.getAttributeNS(null,"id");t&&(this.id=t),this.fitToElemId=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"fittoelem"),this.fitToElemId&&(this.fitToElemId=this.shapeId+this.fitToElemId);var i=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"align");i&&(i=(i=(i=i.replace(/,/g," ")).split(" ")).without("")).each(function(e){switch(e){case"top":case"middle":case"bottom":this._verticalAlign||(this._originVerticalAlign=this._verticalAlign=e);break;case"left":case"center":case"right":this._horizontalAlign||(this._originHorizontalAlign=this._horizontalAlign=e)}}.bind(this)),this.edgePosition=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"edgePosition"),this.edgePosition&&(this.originEdgePosition=this.edgePosition=this.edgePosition.toLowerCase()),this.offsetTop=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"offsetTop")||ORYX.CONFIG.OFFSET_EDGE_LABEL_TOP,this.offsetTop&&(this.offsetTop=parseInt(this.offsetTop)),this.offsetBottom=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"offsetBottom")||ORYX.CONFIG.OFFSET_EDGE_LABEL_BOTTOM,this.offsetBottom&&(this.offsetBottom=parseInt(this.offsetBottom));var n=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"rotate");if(n)try{this._rotate=parseFloat(n)}catch(e){this._rotate=0}else this._rotate=0;var s=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"anchors");if(s)for(var o=(s=s.replace("/,/g"," ")).split(" ").without(""),a=0;a<o.length;a++)switch(o[a].toLowerCase()){case"left":this.originAnchorLeft=this.anchorLeft=!0;break;case"right":this.originAnchorRight=this.anchorRight=!0;break;case"top":this.originAnchorTop=this.anchorTop=!0;break;case"bottom":this.originAnchorBottom=this.anchorBottom=!0}this._verticalAlign||(this._verticalAlign="bottom"),this._horizontalAlign||(this._horizontalAlign="left");var r=this.node.getAttributeNS(null,"x");r&&(this.oldX=this.x=parseFloat(r));var h=this.node.getAttributeNS(null,"y");h&&(this.oldY=this.y=parseFloat(h)),this.text(this.node.textContent)},resetAnchorPosition:function(){this.anchorLeft=this.originAnchorLeft||!1,this.anchorRight=this.originAnchorRight||!1,this.anchorTop=this.originAnchorTop||!1,this.anchorBottom=this.originAnchorBottom||!1},isOriginAnchorLeft:function(){return this.originAnchorLeft||!1},isOriginAnchorRight:function(){return this.originAnchorRight||!1},isOriginAnchorTop:function(){return this.originAnchorTop||!1},isOriginAnchorBottom:function(){return this.originAnchorBottom||!1},isAnchorLeft:function(){return this.anchorLeft||!1},isAnchorRight:function(){return this.anchorRight||!1},isAnchorTop:function(){return this.anchorTop||!1},isAnchorBottom:function(){return this.anchorBottom||!1},getX:function(){try{var e=this.node.x.baseVal.getItem(0).value;switch(this.horizontalAlign()){case"left":return e;case"center":return e-this.getWidth()/2;case"right":return e-this.getWidth()}return this.node.getBBox().x}catch(e){return this.x}},setX:function(e){this.position?this.position.x=e:this.setOriginX(e)},getY:function(){try{return this.node.getBBox().y}catch(e){return this.y}},setY:function(e){this.position?this.position.y=e:this.setOriginY(e)},setOriginX:function(e){this.x=e},setOriginY:function(e){this.y=e},getWidth:function(){try{try{var e,t=this.node.childNodes;if(0==t.length)e=this.node.getBBox().width;else for(var i=0,n=t.length;i<n;++i){var s=t[i].getComputedTextLength();(void 0===e||e<s)&&(e=s)}return e+(e%2==0?0:1)}catch(e){return this.node.getBBox().width}}catch(e){return 0}},getOriginUpperLeft:function(){var e=this.x,t=this.y;switch(this._horizontalAlign){case"center":e-=this.getWidth()/2;break;case"right":e-=this.getWidth()}switch(this._verticalAlign){case"middle":t-=this.getHeight()/2;break;case"bottom":t-=this.getHeight()}return{x:e,y:t}},getHeight:function(){try{return this.node.getBBox().height}catch(e){return 0}},getCenter:function(){var e={x:this.getX(),y:this.getY()};return e.x+=this.getWidth()/2,e.y+=this.getHeight()/2,e},setPosition:function(e){e&&void 0!==e.x&&void 0!==e.y?this.position=e:delete this.position,this.position&&(delete this._referencePoint,delete this.edgePosition),this._isChanged=!0,this.update()},getPosition:function(){return this.position},setReferencePoint:function(e){e?this._referencePoint=e:delete this._referencePoint,this._referencePoint&&delete this.position},getReferencePoint:function(){return this._referencePoint||void 0},changed:function(){this._isChanged=!0},registerOnChange:function(e){this.changeCallbacks||(this.changeCallbacks=[]),e instanceof Function&&!this.changeCallbacks.include(e)&&this.changeCallbacks.push(e)},unregisterOnChange:function(e){this.changeCallbacks&&e instanceof Function&&this.changeCallbacks.include(e)&&(this.changeCallbacks=this.changeCallbacks.without(e))},isUpdating:function(){return!!this._isUpdating},getOriginEdgePosition:function(){return this.originEdgePosition},getEdgePosition:function(){return this.edgePosition||null},setEdgePosition:function(e){["starttop","startmiddle","startbottom","midtop","midbottom","endtop","endbottom"].include(e)?(this.edgePosition=e,delete this.position,delete this._referencePoint):delete this.edgePosition},update:function(e){var t=this.x,i=this.y;if(this.position&&(t=this.position.x,i=this.position.y),t=Math.floor(t),i=Math.floor(i),this._isChanged||t!==this.oldX||i!==this.oldY||!0===e)if(this.isVisible){this._isChanged=!1,this._isUpdating=!0,this.node.setAttributeNS(null,"x",t),this.node.setAttributeNS(null,"y",i),this.node.removeAttributeNS(null,"fill-opacity"),this.oldX=t,this.oldY=i,this.position||this.getReferencePoint()?this.node.removeAttributeNS(null,"transform"):void 0!==this._rotate&&(this._rotationPoint?this.node.setAttributeNS(null,"transform","rotate("+this._rotate+" "+Math.floor(this._rotationPoint.x)+" "+Math.floor(this._rotationPoint.y)+")"):this.node.setAttributeNS(null,"transform","rotate("+this._rotate+" "+Math.floor(t)+" "+Math.floor(i)+")"));for(var n=this._text.split("\n");""==n.last();)n.pop();this.node.ownerDocument&&((this.fitToElemId||this._textHasChanged)&&(this.node.textContent="",n.each(function(e,t){var i=this.node.ownerDocument.createElementNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan");i.textContent=e.trim(),this.fitToElemId&&(i.setAttributeNS(null,"x",this.invisibleRenderPoint),i.setAttributeNS(null,"y",this.invisibleRenderPoint)),""===i.textContent&&(i.textContent=" "),this.node.appendChild(i)}.bind(this)),delete this._textHasChanged,delete this.indices),this.isVisible&&this.fitToElemId&&this.node.setAttributeNS(null,"visibility","hidden"),this.fitToElemId?window.setTimeout(this._checkFittingToReferencedElem.bind(this),0):window.setTimeout(this._positionText.bind(this),0))}else this.node.textContent=""},_checkFittingToReferencedElem:function(){try{var e=$A(this.node.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan")),t=[],i=this.node.ownerDocument.getElementById(this.fitToElemId);if(i){for(var n=i.getBBox(),s=this.getFontSize(),o=0;o<e.length;o++){var a=e[o],r=this._getRenderedTextLength(a,void 0,void 0,s),h=0!=this._rotate&&this._rotate%180!=0&&this._rotate%90==0?n.height:n.width;if(h<r){for(var c=0,d=0,l=this.getTrimmedTextLength(a.textContent),u=0;u<l;u++){if(h-2<this._getRenderedTextLength(a,c,u-c,s)){var f=this.node.ownerDocument.createElementNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan");d<=c?(d=0==u?u:u-1,f.textContent=a.textContent.slice(c,d).trim()):f.textContent=a.textContent.slice(c,++d).trim(),f.setAttributeNS(null,"x",this.invisibleRenderPoint),f.setAttributeNS(null,"y",this.invisibleRenderPoint),t.push(f),c=d}else{var g=a.textContent.charAt(u);" "!=g&&"-"!=g&&"."!=g&&","!=g&&";"!=g&&":"!=g||(d=u)}}a.textContent=a.textContent.slice(c).trim()}t.push(a)}for(;this.node.hasChildNodes();)this.node.removeChild(this.node.childNodes[0]);for(;0<t.length;)this.node.appendChild(t.shift())}}catch(e){ORYX.Log.fatal("Error "+e)}window.setTimeout(this._positionText.bind(this),0)},_positionText:function(){try{var n=this.node.childNodes,s=this.getFontSize(this.node),o=[],a=this.x,r=this.y;this.position&&(a=this.position.x,r=this.position.y),a=Math.floor(a),r=Math.floor(r);var h=0,c=[],e=this.indices||$R(0,n.length-1).toArray(),d=e.length;switch(e.each(function(e){if(void 0!==e){var t=n[h++];if(""===t.textContent.trim())o.push(t);else{var i=0;switch(this._verticalAlign){case"bottom":i=-(d-e-1)*s;break;case"middle":i=-(d/2-e-1)*s,i-=ORYX.CONFIG.LABEL_LINE_DISTANCE/2;break;case"top":i=e*s,i+=s}t.setAttributeNS(null,"dy",Math.floor(i)),t.setAttributeNS(null,"x",a),t.setAttributeNS(null,"y",r),c.push(e)}}}.bind(this)),c.length=n.length,this.indices=this.indices||c,o.each(function(e){this.node.removeChild(e)}.bind(this)),this._horizontalAlign){case"left":this.node.setAttributeNS(null,"text-anchor","start");break;case"center":this.node.setAttributeNS(null,"text-anchor","middle");break;case"right":this.node.setAttributeNS(null,"text-anchor","end")}}catch(e){this._isChanged=!0}this.isVisible&&this.node.removeAttributeNS(null,"visibility"),delete this._isUpdating,(this.changeCallbacks||[]).each(function(e){e.apply(e)})},_getRenderedTextLength:function(e,t,i,n){return void 0===t?e.getComputedTextLength():e.getSubStringLength(t,i)},_estimateTextWidth:function(e,t){for(var i=0,n=0;n<e.length;n++)i+=this._estimateCharacterWidth(e.charAt(n));return i*(t/14)},_estimateCharacterWidth:function(e){for(var t=0;t<this._characterSets.length;t++)if(0<=this._characterSets[t].indexOf(e))return this._characterSetValues[t];return 9},getReferencedElementWidth:function(){var e=this.node.ownerDocument.getElementById(this.fitToElemId);if(e){var t=e.getBBox();if(t)return 0!=this._rotate&&this._rotate%180!=0&&this._rotate%90==0?t.height:t.width}},text:function(){switch(arguments.length){case 0:return this._text;case 1:var e=this._text;arguments[0]?(this._text=arguments[0].toString(),null!=this._text&&null!=this._text&&(this._text=this._text.replace(/ {2,}/g," "))):this._text="",e!==this._text&&(this._isChanged=!0,this._textHasChanged=!0)}},getOriginVerticalAlign:function(){return this._originVerticalAlign},verticalAlign:function(){switch(arguments.length){case 0:return this._verticalAlign;case 1:if(["top","middle","bottom"].member(arguments[0])){var e=this._verticalAlign;this._verticalAlign=arguments[0],this._verticalAlign!==e&&(this._isChanged=!0)}}},getOriginHorizontalAlign:function(){return this._originHorizontalAlign},horizontalAlign:function(){switch(arguments.length){case 0:return this._horizontalAlign;case 1:if(["left","center","right"].member(arguments[0])){var e=this._horizontalAlign;this._horizontalAlign=arguments[0],this._horizontalAlign!==e&&(this._isChanged=!0)}}},rotate:function(){switch(arguments.length){case 0:return this._rotate;case 1:this._rotate!=arguments[0]&&(this._rotate=arguments[0],this._rotationPoint=void 0,this._isChanged=!0);case 2:this._rotate==arguments[0]&&this._rotationPoint&&this._rotationPoint.x==arguments[1].x&&this._rotationPoint.y==arguments[1].y||(this._rotate=arguments[0],this._rotationPoint=arguments[1],this._isChanged=!0)}},hide:function(){this.isVisible&&(this.isVisible=!1,this._isChanged=!0)},show:function(){this.isVisible||(this.isVisible=!0,this._isChanged=!0,this._textHasChanged=!0)},getInheritedFontSize:function(e){if(e&&e.getAttributeNS){var t=e.getAttributeNS(null,"font-size");return t?parseFloat(t):ORYX.Editor.checkClassType(e,SVGSVGElement)?void 0:this.getInheritedFontSize(e.parentNode)}},getFontSize:function(e){var t=this.node.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan"),i=this.getInheritedFontSize(this.node);return i||(i=t[0]&&/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&3<=new Number(RegExp.$1)?t[0].getExtentOfChar(0).height:ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT)<=0&&(i=ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT),i&&this.node.setAttribute("oryx:fontSize",i),i},getTrimmedTextLength:function(e){for(e=e.strip().gsub("  "," ");e.length>(e=e.gsub("  "," ")).length;);return e.length},getOffsetBottom:function(){return this.offsetBottom},getOffsetTop:function(){return this.offsetTop},deserialize:function(e,t){if(e&&void 0!==e.x&&void 0!==e.y){if(this.setPosition({x:e.x,y:e.y}),void 0!==e.distance){var i=t.dockers[e.from],n=t.dockers[e.to];i&&n&&this.setReferencePoint({dirty:!0,distance:e.distance,intersection:{x:e.x,y:e.y},orientation:e.orientation,segment:{from:i,fromIndex:e.from,fromPosition:i.bounds.center(),to:n,toIndex:e.to,toPosition:n.bounds.center()}})}e.left&&(this.anchorLeft=!0),e.right&&(this.anchorRight=!0),e.top&&(this.anchorTop=!0),e.bottom&&(this.anchorBottom=!0),e.valign&&this.verticalAlign(e.valign),e.align&&this.horizontalAlign(e.align)}else e&&void 0!==e.edge&&this.setEdgePosition(e.edge)},serialize:function(){if(this.getEdgePosition())return this.getOriginEdgePosition()!==this.getEdgePosition()?{edge:this.getEdgePosition()}:null;if(this.position){var e={x:this.position.x,y:this.position.y};return this.isAnchorLeft()&&this.isAnchorLeft()!==this.isOriginAnchorLeft()&&(e.left=!0),this.isAnchorRight()&&this.isAnchorRight()!==this.isOriginAnchorRight()&&(e.right=!0),this.isAnchorTop()&&this.isAnchorTop()!==this.isOriginAnchorTop()&&(e.top=!0),this.isAnchorBottom()&&this.isAnchorBottom()!==this.isOriginAnchorBottom()&&(e.bottom=!0),this.getOriginVerticalAlign()!==this.verticalAlign()&&(e.valign=this.verticalAlign()),this.getOriginHorizontalAlign()!==this.horizontalAlign()&&(e.align=this.horizontalAlign()),e}if(this.getReferencePoint()){var t=this.getReferencePoint();return{distance:t.distance,x:t.intersection.x,y:t.intersection.y,from:t.segment.fromIndex,to:t.segment.toIndex,orientation:t.orientation,valign:this.verticalAlign(),align:this.horizontalAlign()}}return null},toString:function(){return"Label "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Math||(ORYX.Core.Math={}),ORYX.Core.Math.midPoint=function(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}},ORYX.Core.Math.isPointInLine=function(e,t,i,n,s,o,a){if(a=a?Math.abs(a):1,Math.abs(i-s)<=a&&Math.abs(e-i)<=a&&t-Math.max(n,o)<=a&&Math.min(n,o)-t<=a)return!0;if(Math.abs(n-o)<=a&&Math.abs(t-n)<=a&&e-Math.max(i,s)<=a&&Math.min(i,s)-e<=a)return!0;if(e>Math.max(i,s)||e<Math.min(i,s))return!1;if(t>Math.max(n,o)||t<Math.min(n,o))return!1;var r=(n-o)/(i-s);return Math.abs(t-(r*e+n-r*i))<a},ORYX.Core.Math.isPointInEllipse=function(e,t,i,n,s,o){if(void 0===i||void 0===n||void 0===s||void 0===o)throw"ORYX.Core.Math.isPointInEllipse needs a ellipse with these properties: x, y, radiusX, radiusY";var a=(e-i)/s,r=(t-n)/o;return a*a+r*r<1},ORYX.Core.Math.isPointInPolygone=function(e,t,i){if(arguments.length<3)throw"ORYX.Core.Math.isPointInPolygone needs two arguments";var n=i.length-1;i[0]===i[n-1]&&i[1]===i[n]||(i.push(i[0]),i.push(i[1]));for(var s,o,a,r,h,c=0,d=0;d<i.length-3;)if(s=i[d],h=(t-(o=i[++d]))*((a=i[++d])-s)-(e-s)*((r=i[d+1])-o),t<=o!=t<=r&&(c+=0<=r-o?0<=h:h<=0),!h&&Math.min(s,a)<=e&&e<=Math.max(s,a)&&Math.min(o,r)<=t&&t<=Math.max(o,r))return!0;return!!(c%2)},ORYX.Core.Math.distancePointLinie=function(e,t,i,n){var s=ORYX.Core.Math.getPointOfIntersectionPointLine(e,t,i,n);return s?ORYX.Core.Math.getDistancePointToPoint(i,s):null},ORYX.Core.Math.getDistancePointToPoint=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},ORYX.Core.Math.getDistanceBetweenTwoPoints=function(e,t,i){return ORYX.Core.Math.getDistancePointToPoint(i,e)/ORYX.Core.Math.getDistancePointToPoint(e,t)},ORYX.Core.Math.pointIsLeftOfLine=function(e,t,i){var n=ORYX.Core.Math.getVector(e,t),s=ORYX.Core.Math.getVector(e,i);return 0<n.x*s.y-s.x*n.y},ORYX.Core.Math.getPointBetweenTwoPoints=function(e,t,i){return 0===(i=Math.max(Math.min(i||0,1),0))?e:1===i?t:{x:e.x+(t.x-e.x)*i,y:e.y+(t.y-e.y)*i}},ORYX.Core.Math.getVector=function(e,t){return{x:t.x-e.x,y:t.y-e.y}},ORYX.Core.Math.getIdentityVector=function(e){2==arguments.length&&(e=ORYX.Core.Math.getVector(e,arguments[1]));var t=Math.sqrt(e.x*e.x+e.y*e.y);return{x:e.x/(t||1),y:e.y/(t||1)}},ORYX.Core.Math.getOrthogonalIdentityVector=function(e,t){var i=1==arguments.length?e:ORYX.Core.Math.getIdentityVector(e,t);return{x:i.y,y:-i.x}},ORYX.Core.Math.getPointOfIntersectionPointLine=function(e,t,i,n){var s=Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2);if(0!=s){var o=((i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y))/s;if(!n||0<=o&&o<=1)return pointOfIntersection=new Object,pointOfIntersection.x=e.x+o*(t.x-e.x),pointOfIntersection.y=e.y+o*(t.y-e.y),pointOfIntersection}},ORYX.Core.Math.getTranslatedPoint=function(e,t){return{x:t.a*e.x+t.c*e.y+1*t.e,y:t.b*e.x+t.d*e.y+1*t.f}},ORYX.Core.Math.getInverseMatrix=function(e){var t=ORYX.Core.Math.getDeterminant(e),i=e;return{a:t*(1*i.d-0*i.f),b:t*(0*i.f-1*i.b),c:t*(0*i.e-1*i.c),d:t*(1*i.a-0*i.e),e:t*(i.c*i.f-i.e*i.d),f:t*(i.e*i.b-i.a*i.f)}},ORYX.Core.Math.getDeterminant=function(e){return e.a*e.d*1+e.c*e.f*0+e.e*e.b*0-e.e*e.d*0-e.c*e.b*1-e.a*e.f*0},ORYX.Core.Math.getTranslatedBoundingBox=function(e){var t=e.getCTM(),i=e.getBBox(),n=ORYX.Core.Math.getTranslatedPoint({x:i.x,y:i.y},t),s=ORYX.Core.Math.getTranslatedPoint({x:i.x,y:i.y+i.height},t),o=ORYX.Core.Math.getTranslatedPoint({x:i.x+i.width,y:i.y},t),a=ORYX.Core.Math.getTranslatedPoint({x:i.x+i.width,y:i.y+i.height},t),r={x:Math.min(n.x,s.x,o.x,a.x),y:Math.min(n.y,s.y,o.y,a.y)},h=Math.max(n.x,s.x,o.x,a.x),c=Math.max(n.y,s.y,o.y,a.y);return{x:r.x,y:r.y,width:h-r.x,height:c-r.y}},ORYX.Core.Math.getAngle=function(e,t){if(e.x==t.x&&e.y==t.y)return 0;var i=180*Math.asin(Math.sqrt(Math.pow(e.y-t.y,2))/Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(e.y-t.y,2)))/Math.PI;return t.x>=e.x&&t.y<=e.y?i:t.x<e.x&&t.y<=e.y?180-i:t.x<e.x&&t.y>e.y?180+i:360-i},new function(){var O=2,R=8,S=4,m=1;function v(e,t,i,n,s,o){var a=0;return o<t?a|=R:t<n&&(a|=S),s<e?a|=O:e<i&&(a|=m),a}ORYX.Core.Math.isRectOverLine=function(e,t,i,n,s,o,a,r){return!!ORYX.Core.Math.clipLineOnRect.apply(ORYX.Core.Math,arguments)},ORYX.Core.Math.clipLineOnRect=function(e,t,i,n,s,o,a,r){var h,c,d,l=0,u=!1,f=!1;h=v(e,t,s,o,a,r),c=v(i,n,s,o,a,r);do{if(0==(h|c))f=u=!0;else if(0<(h&c))f=!0;else{var g=0,p=0;0<((d=0!=h?h:c)&R)?(g=e+(i-e)*(r-t)/(n-t),p=r):0<(d&S)?(g=e+(i-e)*(o-t)/(n-t),p=o):0<(d&O)?(p=t+(n-t)*(a-e)/(i-e),g=a):0<(d&m)&&(p=t+(n-t)*(s-e)/(i-e),g=s),d==h?h=v(e=g,t=p,s,o,a,r):c=v(i=g,n=p,s,o,a,r)}l++}while(1!=f&&l<5e3);return u?{a:{x:e,y:t},b:{x:i,y:n}}:null}},!ORYX)var ORYX={};function _evenMoreEvilHack(e,t){if(window.ActiveXObject){var i=new ActiveXObject("MSXML.DomDocument");return i.loadXML(e),i}if(window.XMLHttpRequest){var n=new XMLHttpRequest;return n.open("GET","data:"+(t||"application/xml")+";charset=utf-8,"+encodeURIComponent(e),!1),n.overrideMimeType&&n.overrideMimeType(t),n.send(null),n.responseXML}}function _evilSafariHack(e){var t="data:text/xml;charset=utf-8,"+encodeURIComponent(e),i=null,n=new XMLHttpRequest;return n.open("GET",t),n.onload=function(){i=n.responseXML},n.send(null),i}if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.Stencil={construct:function(e,i,t,n,s,o){if(arguments.callee.$.construct.apply(this,arguments),!e)throw"Stencilset seems corrupt.";if(!i)throw"Stencil does not provide namespace.";if(!t)throw"Stencil does not provide SVG source.";if(!n)throw"Fatal internal error loading stencilset.";if(this._source=t,this._jsonStencil=e,this._stencilSet=n,this._namespace=i,this._propertyPackages=s,o&&!this._jsonStencil.position&&(this._jsonStencil.position=o),this._view,this._properties=new Hash,!this._jsonStencil.type||"edge"!==this._jsonStencil.type&&"node"!==this._jsonStencil.type)throw"ORYX.Core.StencilSet.Stencil(construct): Type is not defined.";if(!this._jsonStencil.id||""===this._jsonStencil.id)throw"ORYX.Core.StencilSet.Stencil(construct): Id is not defined.";if(!this._jsonStencil.title||""===this._jsonStencil.title)throw"ORYX.Core.StencilSet.Stencil(construct): Title is not defined.";this._jsonStencil.description||(this._jsonStencil.description=""),this._jsonStencil.groups||(this._jsonStencil.groups=[]),this._jsonStencil.roles||(this._jsonStencil.roles=[]),this._jsonStencil.roles.push(this._jsonStencil.id),this._jsonStencil.roles.each(function(e,t){this._jsonStencil.roles[t]=i+e}.bind(this)),this._jsonStencil.roles=this._jsonStencil.roles.uniq(),this._jsonStencil.id=i+this._jsonStencil.id,this.postProcessProperties(),this._jsonStencil.serialize||(this._jsonStencil.serialize={}),this._jsonStencil.deserialize||(this._jsonStencil.deserialize={}),this._jsonStencil.layout||(this._jsonStencil.layout=[]);var a=t+"view/"+e.view;if(this._jsonStencil.view.trim().match(/</)){var r=(new DOMParser).parseFromString(this._jsonStencil.view,"text/xml");if(!ORYX.Editor.checkClassType(r.documentElement,SVGSVGElement))throw"ORYX.Core.StencilSet.Stencil(_loadSVGOnSuccess): The response is not a SVG document.";this._view=r.documentElement}else new Ajax.Request(a,{asynchronous:!1,method:"get",onSuccess:this._loadSVGOnSuccess.bind(this),onFailure:this._loadSVGOnFailure.bind(this)})},postProcessProperties:function(){this._jsonStencil.propertyPackages&&this._jsonStencil.propertyPackages instanceof Array&&this._jsonStencil.propertyPackages.each(function(e){var t=this._propertyPackages[e];t&&t.each(function(e){var t=new ORYX.Core.StencilSet.Property(e,this._namespace,this);this._properties[t.prefix()+"-"+t.id()]=t}.bind(this))}.bind(this)),this._jsonStencil.properties&&this._jsonStencil.properties instanceof Array&&this._jsonStencil.properties.each(function(e){var t=new ORYX.Core.StencilSet.Property(e,this._namespace,this);this._properties[t.prefix()+"-"+t.id()]=t}.bind(this))},equals:function(e){return this.id()===e.id()},stencilSet:function(){return this._stencilSet},type:function(){return this._jsonStencil.type},namespace:function(){return this._namespace},id:function(){return this._jsonStencil.id},idWithoutNs:function(){return this.id().replace(this.namespace(),"")},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonStencil,"title")},description:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonStencil,"description")},groups:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonStencil,"groups")},position:function(){return isNaN(this._jsonStencil.position)?0:this._jsonStencil.position},view:function(){return this._view.cloneNode(!0)||this._view},icon:function(){return this._jsonStencil.icon},fixedAspectRatio:function(){return!0===this._jsonStencil.fixedAspectRatio},hasMultipleRepositoryEntries:function(){return 0<this.getRepositoryEntries().length},getRepositoryEntries:function(){return this._jsonStencil.repositoryEntries?$A(this._jsonStencil.repositoryEntries):$A([])},properties:function(){return this._properties.values()},property:function(e){return this._properties[e]},roles:function(){return this._jsonStencil.roles},defaultAlign:function(){return this._jsonStencil.defaultAlign?this._jsonStencil.defaultAlign:"east"},serialize:function(e,t){return this._jsonStencil.serialize},deserialize:function(e,t){return this._jsonStencil.deserialize},layout:function(e){return this._jsonStencil.layout},addProperty:function(e,t){if(e&&t){var i=new ORYX.Core.StencilSet.Property(e,t,this);this._properties[i.prefix()+"-"+i.id()]=i}},removeProperty:function(t){if(t){var e=this._properties.values().find(function(e){return t==e.id()});e&&delete this._properties[e.prefix()+"-"+e.id()]}},_loadSVGOnSuccess:function(e){var t;if(t=e.responseXML,!ORYX.Editor.checkClassType(t.documentElement,SVGSVGElement))throw"ORYX.Core.StencilSet.Stencil(_loadSVGOnSuccess): The response is not a SVG document.";this._view=t.documentElement},_loadSVGOnFailure:function(e){throw"ORYX.Core.StencilSet.Stencil(_loadSVGOnFailure): Loading SVG document failed."},toString:function(){return"Stencil "+this.title()+" ("+this.id()+")"}},ORYX.Core.StencilSet.Stencil=Clazz.extend(ORYX.Core.StencilSet.Stencil),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.Property=Clazz.extend({construct:function(e,t,i){arguments.callee.$.construct.apply(this,arguments),this._jsonProp=e||ORYX.Log.error("Parameter jsonProp is not defined."),this._namespace=t||ORYX.Log.error("Parameter namespace is not defined."),this._stencil=i||ORYX.Log.error("Parameter stencil is not defined."),this._items={},this._complexItems={},this._hidden=!1,e.id=e.id||ORYX.Log.error("ORYX.Core.StencilSet.Property(construct): Id is not defined."),e.id=e.id.toLowerCase(),e.type?e.type=e.type.toLowerCase():(ORYX.Log.info("Type is not defined for stencil '%0', id '%1'. Falling back to 'String'.",i,e.id),e.type="string"),e.prefix=e.prefix||"oryx",e.title=e.title||"",e.value=e.value||"",e.description=e.description||"",e.readonly=e.readonly||!1,e.optional=!1!==e.optional,this._jsonProp.refToView?this._jsonProp.refToView instanceof Array||(this._jsonProp.refToView=[this._jsonProp.refToView]):this._jsonProp.refToView=[];var n=this.getMinForType(e.type);void 0===e.min||null===e.min?e.min=n:e.min<n&&(e.min=n);var s=this.getMaxForType(e.type);if(void 0===e.max||null===e.max?e.max=s:e.max>s&&(e.min=s),e.fillOpacity||(e.fillOpacity=!1),"number"!=typeof e.lightness?e.lightness=1:e.lightness=Math.max(0,Math.min(1,e.lightness)),e.strokeOpacity||(e.strokeOpacity=!1),void 0!==e.length&&null!==e.length||(e.length=Number.MAX_VALUE),e.wrapLines||(e.wrapLines=!1),e.dateFormat||(e.dateFormat=ORYX.I18N.PropertyWindow.dateFormat||"m/d/y"),e.fill||(e.fill=!1),e.stroke||(e.stroke=!1),e.inverseBoolean||(e.inverseBoolean=!1),e.directlyEditable||0==e.directlyEditable||(e.directlyEditable=!0),!1!==e.visible&&(e.visible=!0),!0!==e.isList&&(e.isList=!1,e.list&&e.list instanceof Array||(e.list=[])),e.category||(e.popular?e.category="popular":e.category="others"),e.alwaysAppearInMultiselect||(e.alwaysAppearInMultiselect=!1),e.type===ORYX.CONFIG.TYPE_CHOICE){if(!(e.items&&e.items instanceof Array))throw"ORYX.Core.StencilSet.Property(construct): No property items defined.";e.items.each(function(e){this._items[e.value.toLowerCase()]=new ORYX.Core.StencilSet.PropertyItem(e,t,this)}.bind(this))}else e.type!==ORYX.CONFIG.TYPE_COMPLEX&&e.type!=ORYX.CONFIG.TYPE_MULTIPLECOMPLEX||e.complexItems&&e.complexItems instanceof Array&&e.complexItems.each(function(e){this._complexItems[e.id.toLowerCase()]=new ORYX.Core.StencilSet.ComplexPropertyItem(e,t,this)}.bind(this))},getMinForType:function(e){return e.toLowerCase()==ORYX.CONFIG.TYPE_INTEGER?-Math.pow(2,31):1-Number.MAX_VALUE},getMaxForType:function(e){return e.toLowerCase()==ORYX.CONFIG.TYPE_INTEGER?Math.pow(2,31)-1:Number.MAX_VALUE},equals:function(e){return this._namespace===e.namespace()&&this.id()===e.id()},namespace:function(){return this._namespace},stencil:function(){return this._stencil},id:function(){return this._jsonProp.id},prefix:function(){return this._jsonProp.prefix},type:function(){return this._jsonProp.type},inverseBoolean:function(){return this._jsonProp.inverseBoolean},category:function(){return this._jsonProp.category},setCategory:function(e){this._jsonProp.category=e},directlyEditable:function(){return this._jsonProp.directlyEditable},visible:function(){return this._jsonProp.visible},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonProp,"title")},value:function(){return this._jsonProp.value},readonly:function(){return this._jsonProp.readonly},optional:function(){return this._jsonProp.optional},description:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonProp,"description")},refToView:function(){return this._jsonProp.refToView},min:function(){return this._jsonProp.min},max:function(){return this._jsonProp.max},fillOpacity:function(){return this._jsonProp.fillOpacity},strokeOpacity:function(){return this._jsonProp.strokeOpacity},length:function(){return this._jsonProp.length?this._jsonProp.length:Number.MAX_VALUE},wrapLines:function(){return this._jsonProp.wrapLines},dateFormat:function(){return this._jsonProp.dateFormat},fill:function(){return this._jsonProp.fill},lightness:function(){return this._jsonProp.lightness},stroke:function(){return this._jsonProp.stroke},items:function(){return $H(this._items).values()},item:function(e){return e?this._items[e.toLowerCase()]:null},toString:function(){return"Property "+this.title()+" ("+this.id()+")"},complexItems:function(){return $H(this._complexItems).values()},complexItem:function(e){return e?this._complexItems[e.toLowerCase()]:null},complexAttributeToView:function(){return this._jsonProp.complexAttributeToView||""},isList:function(){return!!this._jsonProp.isList},getListItems:function(){return this._jsonProp.list},linkableType:function(){return this._jsonProp.linkableType||""},alwaysAppearInMultiselect:function(){return this._jsonProp.alwaysAppearInMultiselect},popular:function(){return this._jsonProp.popular||!1},setPopular:function(){this._jsonProp.popular=!0},hide:function(){this._hidden=!0},isHidden:function(){return this._hidden}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.PropertyItem=Clazz.extend({construct:function(e,t,i){if(arguments.callee.$.construct.apply(this,arguments),!e)throw"ORYX.Core.StencilSet.PropertyItem(construct): Parameter jsonItem is not defined.";if(!t)throw"ORYX.Core.StencilSet.PropertyItem(construct): Parameter namespace is not defined.";if(!i)throw"ORYX.Core.StencilSet.PropertyItem(construct): Parameter property is not defined.";if(this._jsonItem=e,this._namespace=t,this._property=i,!e.value)throw"ORYX.Core.StencilSet.PropertyItem(construct): Value is not defined.";this._jsonItem.refToView?this._jsonItem.refToView instanceof Array||(this._jsonItem.refToView=[this._jsonItem.refToView]):this._jsonItem.refToView=[]},equals:function(e){return this.property().equals(e.property())&&this.value()===e.value()},namespace:function(){return this._namespace},property:function(){return this._property},value:function(){return this._jsonItem.value},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonItem,"title")},refToView:function(){return this._jsonItem.refToView},icon:function(){return this._jsonItem.icon?this.property().stencil()._source+"icons/"+this._jsonItem.icon:""},toString:function(){return"PropertyItem "+this.property()+" ("+this.value()+")"}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.ComplexPropertyItem=Clazz.extend({construct:function(e,t,i){if(arguments.callee.$.construct.apply(this,arguments),!e)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Parameter jsonItem is not defined.";if(!t)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Parameter namespace is not defined.";if(!i)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Parameter property is not defined.";if(this._jsonItem=e,this._namespace=t,this._property=i,this._items=new Hash,this._complexItems=new Hash,!e.name)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Name is not defined.";if(!e.type)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Type is not defined.";if(e.type=e.type.toLowerCase(),e.type===ORYX.CONFIG.TYPE_CHOICE){if(!(e.items&&e.items instanceof Array))throw"ORYX.Core.StencilSet.Property(construct): No property items defined.";e.items.each(function(e){this._items[e.value]=new ORYX.Core.StencilSet.PropertyItem(e,t,this)}.bind(this))}else if(e.type===ORYX.CONFIG.TYPE_COMPLEX){if(!(e.complexItems&&e.complexItems instanceof Array))throw"ORYX.Core.StencilSet.Property(construct): No property items defined.";e.complexItems.each(function(e){this._complexItems[e.id]=new ORYX.Core.StencilSet.ComplexPropertyItem(e,t,this)}.bind(this))}},equals:function(e){return this.property().equals(e.property())&&this.name()===e.name()},namespace:function(){return this._namespace},property:function(){return this._property},name:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonItem,"name")},id:function(){return this._jsonItem.id},type:function(){return this._jsonItem.type},optional:function(){return this._jsonItem.optional},width:function(){return this._jsonItem.width},value:function(){return this._jsonItem.value},items:function(){return this._items.values()},complexItems:function(){return this._complexItems.values()},disable:function(){return this._jsonItem.disable}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.Rules={construct:function(){arguments.callee.$.construct.apply(this,arguments),this._stencilSets=[],this._stencils=[],this._containerStencils=[],this._cachedConnectSET=new Hash,this._cachedConnectSE=new Hash,this._cachedConnectTE=new Hash,this._cachedCardSE=new Hash,this._cachedCardTE=new Hash,this._cachedContainPC=new Hash,this._cachedMorphRS=new Hash,this._connectionRules=new Hash,this._cardinalityRules=new Hash,this._containmentRules=new Hash,this._morphingRules=new Hash,this._layoutRules=new Hash},initializeRules:function(t){var e=this._stencilSets.find(function(e){return e.namespace()==t.namespace()});if(e){var n=this._stencilSets.clone();return(n=n.without(e)).push(t),this._stencilSets=[],this._stencils=[],this._containerStencils=[],this._cachedConnectSET=new Hash,this._cachedConnectSE=new Hash,this._cachedConnectTE=new Hash,this._cachedCardSE=new Hash,this._cachedCardTE=new Hash,this._cachedContainPC=new Hash,this._cachedMorphRS=new Hash,this._connectionRules=new Hash,this._cardinalityRules=new Hash,this._containmentRules=new Hash,this._morphingRules=new Hash,this._layoutRules=new Hash,void n.each(function(e){this.initializeRules(e)}.bind(this))}this._stencilSets.push(t);var s=new Hash(t.jsonRules()),o=t.namespace(),a=t.stencils();t.extensions().values().each(function(e){e.rules&&(e.rules.connectionRules&&(s.connectionRules=s.connectionRules.concat(e.rules.connectionRules)),e.rules.cardinalityRules&&(s.cardinalityRules=s.cardinalityRules.concat(e.rules.cardinalityRules)),e.rules.containmentRules&&(s.containmentRules=s.containmentRules.concat(e.rules.containmentRules)),e.rules.morphingRules&&(s.morphingRules=s.morphingRules.concat(e.rules.morphingRules))),e.stencils&&(a=a.concat(e.stencils))}),this._stencils=this._stencils.concat(t.stencils());var r=this._connectionRules;s.connectionRules&&s.connectionRules.each(function(s){this._isRoleOfOtherNamespace(s.role)?r[s.role]||(r[s.role]=new Hash):r[o+s.role]||(r[o+s.role]=new Hash),s.connects.each(function(e){var t,i,n=[];e.to&&(e.to instanceof Array||(e.to=[e.to]),e.to.each(function(e){this._isRoleOfOtherNamespace(e)?n.push(e):n.push(o+e)}.bind(this))),t=this._isRoleOfOtherNamespace(s.role)?s.role:o+s.role,i=this._isRoleOfOtherNamespace(e.from)?e.from:o+e.from,r[t][i]?r[t][i]=r[t][i].concat(n):r[t][i]=n}.bind(this))}.bind(this));var h=this._cardinalityRules;s.cardinalityRules&&s.cardinalityRules.each(function(e){var t;if(t=this._isRoleOfOtherNamespace(e.role)?e.role:o+e.role,!h[t])for(i in h[t]={},e)h[t][i]=e[i];var n=new Hash;e.outgoingEdges&&e.outgoingEdges.each(function(e){this._isRoleOfOtherNamespace(e.role)?n[e.role]=e:n[o+e.role]=e}.bind(this)),h[t].outgoingEdges=n;var s=new Hash;e.incomingEdges&&e.incomingEdges.each(function(e){this._isRoleOfOtherNamespace(e.role)?s[e.role]=e:s[o+e.role]=e}.bind(this)),h[t].incomingEdges=s}.bind(this));var c=this._containmentRules;s.containmentRules&&s.containmentRules.each(function(e){var t;this._isRoleOfOtherNamespace(e.role)?t=e.role:(this._containerStencils.push(o+e.role),t=o+e.role),c[t]||(c[t]=[]),(e.contains||[]).each(function(e){this._isRoleOfOtherNamespace(e)?c[t].push(e):c[t].push(o+e)}.bind(this))}.bind(this));var d=this._morphingRules;s.morphingRules&&s.morphingRules.each(function(e){var i;i=this._isRoleOfOtherNamespace(e.role)?e.role:o+e.role,d[i]||(d[i]=[]),e.preserveBounds||(e.preserveBounds=!1),e.baseMorphs.each(function(e){var t=this._getStencilById(o+e);t&&d[i].push(t)}.bind(this))}.bind(this));var l=this._layoutRules;if(s.layoutRules){var u=function(e){return{edgeRole:e.edgeRole||void 0,t:e.t||1,r:e.r||1,b:e.b||1,l:e.l||1}};s.layoutRules.each(function(e){var t;t=this._isRoleOfOtherNamespace(e.role)?e.role:o+e.role,l[t]||(l[t]={}),e.in&&(l[t].in=u(e.in)),e.ins&&(l[t].ins=(e.ins||[]).map(function(e){return u(e)})),e.out&&(l[t].out=u(e.out)),e.outs&&(l[t].outs=(e.outs||[]).map(function(e){return u(e)}))}.bind(this))}},_getStencilById:function(t){return this._stencils.find(function(e){return e.id()==t})},_cacheConnect:function(e){if(result=this._canConnect(e),e.sourceStencil&&e.targetStencil){(i=this._cachedConnectSET[e.sourceStencil.id()])||(i=new Hash,this._cachedConnectSET[e.sourceStencil.id()]=i);var t=i[e.edgeStencil.id()];t||(t=new Hash,i[e.edgeStencil.id()]=t),t[e.targetStencil.id()]=result}else if(e.sourceStencil){var i;(i=this._cachedConnectSE[e.sourceStencil.id()])||(i=new Hash,this._cachedConnectSE[e.sourceStencil.id()]=i),i[e.edgeStencil.id()]=result}else{var n=this._cachedConnectTE[e.targetStencil.id()];n||(n=new Hash,this._cachedConnectTE[e.targetStencil.id()]=n),n[e.edgeStencil.id()]=result}return result},_cacheCard:function(e){if(e.sourceStencil){var t=this._cachedCardSE[e.sourceStencil.id()];t||(t=new Hash,this._cachedCardSE[e.sourceStencil.id()]=t),null==(i=this._getMaximumNumberOfOutgoingEdge(e))&&(i=-1),t[e.edgeStencil.id()]=i}if(e.targetStencil){var i,n=this._cachedCardTE[e.targetStencil.id()];n||(n=new Hash,this._cachedCardTE[e.targetStencil.id()]=n),null==(i=this._getMaximumNumberOfIncomingEdge(e))&&(i=-1),n[e.edgeStencil.id()]=i}},_cacheContain:function(e){var t=[this._canContain(e),this._getMaximumOccurrence(e.containingStencil,e.containedStencil)];null==t[1]&&(t[1]=-1);var i=this._cachedContainPC[e.containingStencil.id()];return i||(i=new Hash,this._cachedContainPC[e.containingStencil.id()]=i),i[e.containedStencil.id()]=t},_cacheMorph:function(t){var e=this._cachedMorphRS[t];return e||(e=[],this._morphingRules.keys().include(t)&&(e=this._stencils.select(function(e){return e.roles().include(t)})),this._cachedMorphRS[t]=e),e},outgoingEdgeStencils:function(i){if(!i.sourceShape&&!i.sourceStencil)return[];i.sourceShape&&(i.sourceStencil=i.sourceShape.getStencil());var n=[];return this._stencils.each(function(e){if("edge"===e.type()){var t=Object.clone(i);t.edgeStencil=e,this.canConnect(t)&&n.push(e)}}.bind(this)),n},incomingEdgeStencils:function(i){if(!i.targetShape&&!i.targetStencil)return[];i.targetShape&&(i.targetStencil=i.targetShape.getStencil());var n=[];return this._stencils.each(function(e){if("edge"===e.type()){var t=Object.clone(i);t.edgeStencil=e,this.canConnect(t)&&n.push(e)}}.bind(this)),n},sourceStencils:function(i){if(!i||!i.edgeShape&&!i.edgeStencil)return[];i.targetShape&&(i.targetStencil=i.targetShape.getStencil()),i.edgeShape&&(i.edgeStencil=i.edgeShape.getStencil());var n=[];return this._stencils.each(function(e){var t=Object.clone(i);t.sourceStencil=e,this.canConnect(t)&&n.push(e)}.bind(this)),n},targetStencils:function(i){if(!i||!i.edgeShape&&!i.edgeStencil)return[];i.sourceShape&&(i.sourceStencil=i.sourceShape.getStencil()),i.edgeShape&&(i.edgeStencil=i.edgeShape.getStencil());var n=[];return this._stencils.each(function(e){var t=Object.clone(i);t.targetStencil=e,this.canConnect(t)&&n.push(e)}.bind(this)),n},canConnect:function(t){if(!t||!t.sourceShape&&!t.sourceStencil&&!t.targetShape&&!t.targetStencil||!t.edgeShape&&!t.edgeStencil)return!1;var e;if(t.sourceShape&&(t.sourceStencil=t.sourceShape.getStencil()),t.targetShape&&(t.targetStencil=t.targetShape.getStencil()),t.edgeShape&&(t.edgeStencil=t.edgeShape.getStencil()),t.sourceStencil&&t.targetStencil)e=(n=this._cachedConnectSET[t.sourceStencil.id()])&&(i=n[t.edgeStencil.id()])?null==(s=i[t.targetStencil.id()])?this._cacheConnect(t):s:this._cacheConnect(t);else if(t.sourceStencil){if(n=this._cachedConnectSE[t.sourceStencil.id()])e=null==(i=n[t.edgeStencil.id()])?this._cacheConnect(t):i;else e=this._cacheConnect(t)}else{var i;if(s=this._cachedConnectTE[t.targetStencil.id()])e=null==(i=s[t.edgeStencil.id()])?this._cacheConnect(t):i;else e=this._cacheConnect(t)}if(e){var n,s,o;if(t.sourceShape)(n=this._cachedCardSE[t.sourceStencil.id()])||(this._cacheCard(t),n=this._cachedCardSE[t.sourceStencil.id()]),null==(o=n[t.edgeStencil.id()])&&this._cacheCard(t),-1!=(o=n[t.edgeStencil.id()])&&(e=t.sourceShape.getOutgoingShapes().all(function(e){return!!(e.getStencil().id()!==t.edgeStencil.id()||t.edgeShape&&e===t.edgeShape)||0<--o}));if(t.targetShape)(s=this._cachedCardTE[t.targetStencil.id()])||(this._cacheCard(t),s=this._cachedCardTE[t.targetStencil.id()]),null==(o=s[t.edgeStencil.id()])&&this._cacheCard(t),-1!=(o=s[t.edgeStencil.id()])&&(e=t.targetShape.getIncomingShapes().all(function(e){return!!(e.getStencil().id()!==t.edgeStencil.id()||t.edgeShape&&e===t.edgeShape)||0<--o}))}return e},_canConnect:function(i){if(!i||!i.sourceShape&&!i.sourceStencil&&!i.targetShape&&!i.targetStencil||!i.edgeShape&&!i.edgeStencil)return!1;i.sourceShape&&(i.sourceStencil=i.sourceShape.getStencil()),i.targetShape&&(i.targetStencil=i.targetShape.getStencil()),i.edgeShape&&(i.edgeStencil=i.edgeShape.getStencil());var n=this._getConnectionRulesOfEdgeStencil(i.edgeStencil);return 0!==n.keys().length&&(i.sourceStencil?i.sourceStencil.roles().any(function(e){var t=n[e];return!!t&&(!i.targetStencil||t.any(function(e){return i.targetStencil.roles().member(e)}))}):n.values().any(function(t){return i.targetStencil.roles().any(function(e){return t.member(e)})}))},isContainer:function(e){return this._containerStencils.member(e.getStencil().id())},canContain:function(t){if(!t||!t.containingStencil&&!t.containingShape||!t.containedStencil&&!t.containedShape)return!1;if(t.containedShape&&(t.containedStencil=t.containedShape.getStencil()),t.containingShape&&(t.containingStencil=t.containingShape.getStencil()),"edge"==t.containedStencil.type())return!1;var e,i=this._cachedContainPC[t.containingStencil.id()];if(i&&(e=i[t.containedStencil.id()])||(e=this._cacheContain(t)),e[0]){if(-1==e[1])return!0;if(t.containingShape){var n=e[1];return t.containingShape.getChildShapes(!1).all(function(e){return e.getStencil().id()!==t.containedStencil.id()||0<--n})}return!0}return!1},_canContain:function(i){return!(!i||!i.containingStencil&&!i.containingShape||!i.containedStencil&&!i.containedShape)&&(i.containedShape&&(i.containedStencil=i.containedShape.getStencil()),i.containingShape&&(i.containingStencil=i.containingShape.getStencil()),i.containingStencil.roles().any(function(e){var t=this._containmentRules[e];return!!t&&t.any(function(e){return i.containedStencil.roles().member(e)})}.bind(this)))},morphStencils:function(e){if(!e.stencil&&!e.shape)return[];e.shape&&(e.stencil=e.shape.getStencil());var t=[];e.stencil.roles().each(function(e){this._cacheMorph(e).each(function(e){t.push(e)})}.bind(this));var i=this.baseMorphs();return t=t.uniq().sort(function(e,t){return i.include(e)&&!i.include(t)?-1:i.include(t)&&!i.include(e)?1:0})},baseMorphs:function(){var t=[];return this._morphingRules.each(function(e){e.value.each(function(e){t.push(e)})}),t},containsMorphingRules:function(){return this._stencilSets.any(function(e){return!!e.jsonRules().morphingRules})},connectMorph:function(e){if(!e||!e.sourceShape&&!e.sourceStencil&&!e.targetShape&&!e.targetStencil)return!1;e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil()),e.targetShape&&(e.targetStencil=e.targetShape.getStencil());var t=this.incomingEdgeStencils(e),i=this.outgoingEdgeStencils(e),n=t.select(function(e){return i.member(e)}),s=this.baseMorphs().select(function(e){return n.member(e)});return 0<s.size()?s[0]:0<n.size()?n[0]:null},showInShapeMenu:function(i){return this._stencilSets.any(function(t){return t.jsonRules().morphingRules.any(function(e){return i.roles().include(t.namespace()+e.role)&&!1!==e.showInShapeMenu})})},preserveBounds:function(i){return this._stencilSets.any(function(t){return t.jsonRules().morphingRules.any(function(e){return i.roles().include(t.namespace()+e.role)&&e.preserveBounds})})},getLayoutingRules:function(e,o){if(e&&e instanceof ORYX.Core.Shape){var a={in:{},out:{}},t=function(n,s){n&&n[s]&&["t","r","b","l"].each(function(e){a[s][e]=Math.max(n[s][e],a[s][e]||0)}),n&&n[s+"s"]instanceof Array&&["t","r","b","l"].each(function(e){var t,i=n[s+"s"].find(function(e){return!e.edgeRole});o instanceof ORYX.Core.Edge&&(t=n[s+"s"].find(function(e){return this._hasRole(o,e.edgeRole)}.bind(this))),a[s][e]=Math.max(t?t[e]:i[e],a[s][e]||0)}.bind(this))}.bind(this);return e.getStencil().roles().each(function(e){this._layoutRules[e]&&(t(this._layoutRules[e],"in"),t(this._layoutRules[e],"out"))}.bind(this)),["in","out"].each(function(t){["t","r","b","l"].each(function(e){a[t][e]=void 0!==a[t][e]?a[t][e]:1})}),a}},_hasRole:function(e,t){if(e instanceof ORYX.Core.Shape&&t)return e.getStencil().roles().any(function(e){return e==t})||e.getStencil().id()==e.getStencil().namespace()+t},_stencilsWithRole:function(t){return this._stencils.findAll(function(e){return!!e.roles().member(t)})},_edgesWithRole:function(t){return this._stencils.findAll(function(e){return!(!e.roles().member(t)||"edge"!==e.type())})},_nodesWithRole:function(t){return this._stencils.findAll(function(e){return!(!e.roles().member(t)||"node"!==e.type())})},_getMaximumOccurrence:function(e,t){var i;return t.roles().each(function(e){var t=this._cardinalityRules[e];t&&t.maximumOccurrence&&(i=i?Math.min(i,t.maximumOccurrence):t.maximumOccurrence)}.bind(this)),i},_getMaximumNumberOfOutgoingEdge:function(t){return!!(t&&t.sourceStencil&&t.edgeStencil)&&(t.sourceStencil.roles().each(function(e){var i=this._cardinalityRules[e];i&&i.outgoingEdges&&t.edgeStencil.roles().each(function(e){var t=i.outgoingEdges[e];t&&t.maximum&&(n=n?Math.min(n,t.maximum):t.maximum)})}.bind(this)),n);var n},_getMaximumNumberOfIncomingEdge:function(t){return!!(t&&t.targetStencil&&t.edgeStencil)&&(t.targetStencil.roles().each(function(e){var i=this._cardinalityRules[e];i&&i.incomingEdges&&t.edgeStencil.roles().each(function(e){var t=i.incomingEdges[e];t&&t.maximum&&(n=n?Math.min(n,t.maximum):t.maximum)})}.bind(this)),n);var n},_getConnectionRulesOfEdgeStencil:function(e){var t=new Hash;return e.roles().each(function(e){this._connectionRules[e]&&this._connectionRules[e].each(function(e){t[e.key]?t[e.key]=t[e.key].concat(e.value):t[e.key]=e.value})}.bind(this)),t},_isRoleOfOtherNamespace:function(e){return 0<e.indexOf("#")},toString:function(){return"Rules"}},ORYX.Core.StencilSet.Rules=Clazz.extend(ORYX.Core.StencilSet.Rules),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.StencilSet=Clazz.extend({construct:function(e,t,i){if(arguments.callee.$.construct.apply(this,arguments),!e)throw"ORYX.Core.StencilSet.StencilSet(construct): Parameter 'source' is not defined.";if(e.endsWith("/")&&(e=e.substr(0,e.length-1)),this._extensions=new Hash,this._source=e,this._baseUrl=e.substring(0,e.lastIndexOf("/")+1),this._jsonObject={},this._stencils=new Hash,this._availableStencils=new Hash,ORYX.CONFIG.BACKEND_SWITCH?(this._baseUrl="editor/stencilsets/bpmn2.0/",this._source="stencilsets/bpmn2.0/bpmn2.0.json",new Ajax.Request("../flow-editor/editor-app/stencilsets/stencilset.json",{asynchronous:!1,method:"get",onSuccess:this._init.bind(this),onFailure:this._cancelInit.bind(this)})):new Ajax.Request(e,{asynchronous:!1,method:"get",onSuccess:this._init.bind(this),onFailure:this._cancelInit.bind(this)}),this.errornous)throw"Loading stencil set "+e+" failed."},findRootStencilName:function(){var e=this._stencils.values().find(function(e){return e._jsonStencil.mayBeRoot});return e||(ORYX.Log.warn("Did not find any stencil that may be root. Taking a guess."),e=this._stencils.values()[0]),e.id()},equals:function(e){return this.namespace()===e.namespace()},stencils:function(e,i,t){if(e&&i){for(var n=this._availableStencils.values(),s=[e],o=[],a=[];0<s.size();){var r=s.pop();o.push(r);for(var h=n.findAll(function(e){var t={containingStencil:r,containedStencil:e};return i.canContain(t)}),c=0;c<h.size();c++)o.member(h[c])||s.push(h[c]);a=a.concat(h).uniq()}a=a.sortBy(function(e){return n.indexOf(e)}),t&&(a=a.sortBy(function(e){return e.groups().first()}));var d=n.findAll(function(e){return"edge"==e.type()});return a=a.concat(d)}return t?this._availableStencils.values().sortBy(function(e){return e.groups().first()}):this._availableStencils.values()},nodes:function(){return this._availableStencils.values().findAll(function(e){return"node"===e.type()})},edges:function(){return this._availableStencils.values().findAll(function(e){return"edge"===e.type()})},stencil:function(e){return this._stencils[e]},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonObject,"title")},description:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonObject,"description")},namespace:function(){return this._jsonObject?this._jsonObject.namespace:null},jsonRules:function(){return this._jsonObject?this._jsonObject.rules:null},source:function(){return this._source},extensions:function(){return this._extensions},addExtension:function(e){new Ajax.Request(e,{method:"GET",asynchronous:!1,onSuccess:function(e){this.addExtensionDirectly(e.responseText)}.bind(this),onFailure:function(e){ORYX.Log.debug("Loading stencil set extension file failed. The request returned an error."+e)}.bind(this),onException:function(e){ORYX.Log.debug("Loading stencil set extension file failed. The request returned an error."+e)}.bind(this)})},addExtensionDirectly:function(str){try{if(eval("var jsonExtension = "+str),jsonExtension.extends.endsWith("#")||(jsonExtension.extends+="#"),jsonExtension.extends==this.namespace()){this._extensions[jsonExtension.namespace]=jsonExtension;var defaultPosition=this._stencils.keys().size();if(jsonExtension.stencils&&$A(jsonExtension.stencils).each(function(e){defaultPosition++;var t=new ORYX.Core.StencilSet.Stencil(e,this.namespace(),this._baseUrl,this,void 0,defaultPosition);this._stencils[t.id()]=t,this._availableStencils[t.id()]=t}.bind(this)),jsonExtension.properties){var stencils=this._stencils.values();stencils.each(function(i){var n=i.roles();jsonExtension.properties.each(function(t){t.roles.any(function(e){return e=jsonExtension.extends+e,!!n.member(e)&&(t.properties.each(function(e){i.addProperty(e,jsonExtension.namespace)}),!0)})})}.bind(this))}jsonExtension.removeproperties&&jsonExtension.removeproperties.each(function(e){var t=this.stencil(jsonExtension.extends+e.stencil);t&&e.properties.each(function(e){t.removeProperty(e)})}.bind(this)),jsonExtension.removestencils&&$A(jsonExtension.removestencils).each(function(e){delete this._availableStencils[jsonExtension.extends+e]}.bind(this))}}catch(e){ORYX.Log.debug("StencilSet.addExtension: Something went wrong when initialising the stencil set extension. "+e)}},removeExtension:function(e){var s=this._extensions[e];if(s){if(s.stencils&&$A(s.stencils).each(function(e){var t=new ORYX.Core.StencilSet.Stencil(e,this.namespace(),this._baseUrl,this);delete this._stencils[t.id()],delete this._availableStencils[t.id()]}.bind(this)),s.properties)this._stencils.values().each(function(i){var n=i.roles();s.properties.each(function(t){t.roles.any(function(e){return e=s.extends+e,!!n.member(e)&&(t.properties.each(function(e){i.removeProperty(e.id)}),!0)})})}.bind(this));s.removeproperties&&s.removeproperties.each(function(e){var i=this.stencil(s.extends+e.stencil);if(i){var n=$A(this._jsonObject.stencils).find(function(e){return e.id==i.id()});e.properties.each(function(t){var e=$A(n.properties).find(function(e){return e.id==t});i.addProperty(e,this.namespace())}.bind(this))}}.bind(this)),s.removestencils&&$A(s.removestencils).each(function(e){var t=s.extends+e;this._availableStencils[t]=this._stencils[t]}.bind(this))}delete this._extensions[e]},__handleStencilset:function(response){try{this._jsonObject=JSON.parse(response.response)}catch(e){throw"Stenciset corrupt: "+e}if(!this._jsonObject)throw"Error evaluating stencilset. It may be corrupt.";with(this._jsonObject){if(!namespace||""===namespace)throw"Namespace definition missing in stencilset.";if(!(stencils instanceof Array))throw"Stencilset corrupt.";namespace.endsWith("#")||(namespace+="#"),title||(title=""),description||(description="")}},_init:function(e){this.__handleStencilset(e);var i=new Hash;this._jsonObject.propertyPackages&&$A(this._jsonObject.propertyPackages).each(function(e){i[e.name]=e.properties}.bind(this));var n=0;$A(this._jsonObject.stencils).each(function(e){n++;var t=new ORYX.Core.StencilSet.Stencil(e,this.namespace(),this._baseUrl,this,i,n);this._stencils[t.id()]=t,this._availableStencils[t.id()]=t}.bind(this))},_cancelInit:function(e){this.errornous=!0},toString:function(){return"StencilSet "+this.title()+" ("+this.namespace()+")"}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet._stencilSetsByNamespace=new Hash,ORYX.Core.StencilSet._stencilSetsByUrl=new Hash,ORYX.Core.StencilSet._StencilSetNSByEditorInstance=new Hash,ORYX.Core.StencilSet._rulesByEditorInstance=new Hash,ORYX.Core.StencilSet.stencilSets=function(e){var t=ORYX.Core.StencilSet._StencilSetNSByEditorInstance[e],i=new Hash;return t&&t.each(function(e){var t=ORYX.Core.StencilSet.stencilSet(e);i[t.namespace()]=t}),i},ORYX.Core.StencilSet.stencilSet=function(e){ORYX.Log.trace("Getting stencil set %0",e);var t=e.split("#",1);return 1===t.length?(ORYX.Log.trace("Getting stencil set %0",t[0]),ORYX.Core.StencilSet._stencilSetsByNamespace[t[0]+"#"]):void 0},ORYX.Core.StencilSet.stencil=function(e){ORYX.Log.trace("Getting stencil for %0",e);var t=ORYX.Core.StencilSet.stencilSet(e);return t?t.stencil(e):void ORYX.Log.trace("Cannot fild stencil for %0",e)},ORYX.Core.StencilSet.rules=function(e){return ORYX.Core.StencilSet._rulesByEditorInstance[e]||(ORYX.Core.StencilSet._rulesByEditorInstance[e]=new ORYX.Core.StencilSet.Rules),ORYX.Core.StencilSet._rulesByEditorInstance[e]},ORYX.Core.StencilSet.loadStencilSet=function(e,t,i){stencilSet=new ORYX.Core.StencilSet.StencilSet(e,t,i),ORYX.Core.StencilSet._stencilSetsByNamespace[stencilSet.namespace()]=stencilSet,ORYX.Core.StencilSet._stencilSetsByUrl[e]=stencilSet;var n=stencilSet.namespace();if(ORYX.Core.StencilSet._StencilSetNSByEditorInstance[i]?ORYX.Core.StencilSet._StencilSetNSByEditorInstance[i].push(n):ORYX.Core.StencilSet._StencilSetNSByEditorInstance[i]=[n],ORYX.Core.StencilSet._rulesByEditorInstance[i])ORYX.Core.StencilSet._rulesByEditorInstance[i].initializeRules(stencilSet);else{var s=new ORYX.Core.StencilSet.Rules;s.initializeRules(stencilSet),ORYX.Core.StencilSet._rulesByEditorInstance[i]=s}},ORYX.Core.StencilSet.getTranslation=function(e,t){var i=ORYX.I18N.Language.toLowerCase(),n=e[t+"_"+i];return n||((n=e[t+"_"+i.substr(0,2)])||e[t])},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Command=Clazz.extend({construct:function(){},execute:function(){throw"Command.execute() has to be implemented!"},rollback:function(){throw"Command.rollback() has to be implemented!"}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Bounds={construct:function(){this._changedCallbacks=[],this.a={},this.b={},this.set.apply(this,arguments),this.suspendChange=!1,this.changedWhileSuspend=!1},_changed:function(t){this.suspendChange?this.changedWhileSuspend=!0:(this._changedCallbacks.each(function(e){e(this,t)}.bind(this)),this.changedWhileSuspend=!1)},registerCallback:function(e){this._changedCallbacks.member(e)||this._changedCallbacks.push(e)},unregisterCallback:function(e){this._changedCallbacks=this._changedCallbacks.without(e)},set:function(){var e=!1;switch(arguments.length){case 1:this.a.x!==arguments[0].a.x&&(e=!0,this.a.x=arguments[0].a.x),this.a.y!==arguments[0].a.y&&(e=!0,this.a.y=arguments[0].a.y),this.b.x!==arguments[0].b.x&&(e=!0,this.b.x=arguments[0].b.x),this.b.y!==arguments[0].b.y&&(e=!0,this.b.y=arguments[0].b.y);break;case 2:var t=Math.min(arguments[0].x,arguments[1].x),i=Math.min(arguments[0].y,arguments[1].y),n=Math.max(arguments[0].x,arguments[1].x),s=Math.max(arguments[0].y,arguments[1].y);this.a.x!==t&&(e=!0,this.a.x=t),this.a.y!==i&&(e=!0,this.a.y=i),this.b.x!==n&&(e=!0,this.b.x=n),this.b.y!==s&&(e=!0,this.b.y=s);break;case 4:t=Math.min(arguments[0],arguments[2]),i=Math.min(arguments[1],arguments[3]),n=Math.max(arguments[0],arguments[2]),s=Math.max(arguments[1],arguments[3]);this.a.x!==t&&(e=!0,this.a.x=t),this.a.y!==i&&(e=!0,this.a.y=i),this.b.x!==n&&(e=!0,this.b.x=n),this.b.y!==s&&(e=!0,this.b.y=s)}e&&this._changed(!0)},moveTo:function(){var e=this.upperLeft();switch(arguments.length){case 1:this.moveBy({x:arguments[0].x-e.x,y:arguments[0].y-e.y});break;case 2:this.moveBy({x:arguments[0]-e.x,y:arguments[1]-e.y})}},moveBy:function(){var e=!1;switch(arguments.length){case 1:var t=arguments[0];0===t.x&&0===t.y||(e=!0,this.a.x+=t.x,this.b.x+=t.x,this.a.y+=t.y,this.b.y+=t.y);break;case 2:var i=arguments[0],n=arguments[1];0===i&&0===n||(e=!0,this.a.x+=i,this.b.x+=i,this.a.y+=n,this.b.y+=n)}e&&this._changed()},include:function(e){if(void 0===this.a.x&&void 0===this.a.y&&void 0===this.b.x&&void 0===this.b.y)return e;var t=Math.min(this.a.x,e.a.x),i=Math.min(this.a.y,e.a.y),n=Math.max(this.b.x,e.b.x),s=Math.max(this.b.y,e.b.y);this.set(t,i,n,s)},extend:function(e){0===e.x&&0===e.y||(this.b.x+=e.x,this.b.y+=e.y,this._changed(!0))},widen:function(e){0!==e&&(this.suspendChange=!0,this.moveBy({x:-e,y:-e}),this.extend({x:2*e,y:2*e}),this.suspendChange=!1,this.changedWhileSuspend&&this._changed(!0))},upperLeft:function(){var e={};return e.x=this.a.x,e.y=this.a.y,e},lowerRight:function(){var e={};return e.x=this.b.x,e.y=this.b.y,e},width:function(){return this.b.x-this.a.x},height:function(){return this.b.y-this.a.y},center:function(){var e={};return e.x=(this.a.x+this.b.x)/2,e.y=(this.a.y+this.b.y)/2,e},midPoint:function(){var e={};return e.x=(this.b.x-this.a.x)/2,e.y=(this.b.y-this.a.y)/2,e},centerMoveTo:function(){var e=this.center();switch(arguments.length){case 1:this.moveBy(arguments[0].x-e.x,arguments[0].y-e.y);break;case 2:this.moveBy(arguments[0]-e.x,arguments[1]-e.y)}},isIncluded:function(e,t){var i,n;switch(arguments.length){case 1:i=e.x,n=e.y,t=0;break;case 2:e.x&&e.y?(i=e.x,n=e.y,t=Math.abs(t)):(i=e,n=t,t=0);break;case 3:i=e,n=t,t=Math.abs(arguments[2]);break;default:throw"isIncluded needs one, two or three arguments"}var s=this.upperLeft(),o=this.lowerRight();return i>=s.x-t&&i<=o.x+t&&n>=s.y-t&&n<=o.y+t},clone:function(){return new ORYX.Core.Bounds(this)},toString:function(){return"( "+this.a.x+" | "+this.a.y+" )/( "+this.b.x+" | "+this.b.y+" )"},serializeForERDF:function(){return this.a.x+","+this.a.y+","+this.b.x+","+this.b.y}},ORYX.Core.Bounds=Clazz.extend(ORYX.Core.Bounds),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.UIObject={construct:function(e){this.isChanged=!0,this.isResized=!0,this.isVisible=!0,this.isSelectable=!1,this.isResizable=!1,this.isMovable=!1,this.id=ORYX.Editor.provideId(),this.parent=void 0,this.node=void 0,this.children=[],this.bounds=new ORYX.Core.Bounds,this._changedCallback=this._changed.bind(this),this.bounds.registerCallback(this._changedCallback),e&&e.eventHandlerCallback&&(this.eventHandlerCallback=e.eventHandlerCallback)},_changed:function(e,t){this.isChanged=!0,this.bounds==e&&(this.isResized=t||this.isResized)},update:function(){this.isChanged&&(this.refresh(),this.isChanged=!1,this.children.each(function(e){e.update()}))},refresh:function(){},getChildren:function(){return this.children.clone()},getParents:function(){for(var e=[],t=this.parent;t;)e.push(t),t=t.parent;return e},isParent:function(e){for(var t=this;t;){if(t===e)return!0;t=t.parent}return!1},getId:function(){return this.id},getChildById:function(i,n){return this.children.find(function(e){if(e.getId()===i)return e;if(n){var t=e.getChildById(i,n);if(t)return t}})},add:function(e){this.children.member(e)?ORYX.Log.info("add: ORYX.Core.UIObject is already a child of this object."):(e.parent&&e.remove(e),this.children.push(e),e.parent=this,e.node=this.node.appendChild(e.node),e.bounds.registerCallback(this._changedCallback))},remove:function(e){this.children.member(e)?(this.children=this._uiObjects.without(e),e.parent=void 0,e.node=this.node.removeChild(e.node),e.bounds.unregisterCallback(this._changedCallback)):ORYX.Log.info("remove: ORYX.Core.UIObject is not a child of this object.")},absoluteBounds:function(){if(this.parent){var e=this.absoluteXY();return new ORYX.Core.Bounds(e.x,e.y,e.x+this.bounds.width(),e.y+this.bounds.height())}return this.bounds.clone()},absoluteXY:function(){if(this.parent){var e=this.parent.absoluteXY();return(t={}).x=e.x+this.bounds.upperLeft().x,t.y=e.y+this.bounds.upperLeft().y,t}var t;return(t={}).x=this.bounds.upperLeft().x,t.y=this.bounds.upperLeft().y,t},absoluteCenterXY:function(){if(this.parent){var e=this.parent.absoluteXY();return(t={}).x=e.x+this.bounds.center().x,t.y=e.y+this.bounds.center().y,t}var t;return(t={}).x=this.bounds.center().x,t.y=this.bounds.center().y,t},hide:function(){this.node.setAttributeNS(null,"display","none"),this.isVisible=!1,this.children.each(function(e){e.hide()})},show:function(){this.node.setAttributeNS(null,"display","inherit"),this.isVisible=!0,this.children.each(function(e){e.show()})},addEventHandlers:function(e){e.addEventListener(ORYX.CONFIG.EVENT_MOUSEDOWN,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEOVER,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEOUT,this._delegateEvent.bind(this),!1),e.addEventListener("click",this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_DBLCLICK,this._delegateEvent.bind(this),!1)},_delegateEvent:function(e){this.eventHandlerCallback&&this.eventHandlerCallback(e,this)},toString:function(){return"UIObject "+this.id}},ORYX.Core.UIObject=Clazz.extend(ORYX.Core.UIObject),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.AbstractShape=ORYX.Core.UIObject.extend({construct:function(e,t,i){arguments.callee.$.construct.apply(this,arguments),this.resourceId=ORYX.Editor.provideId(),this._stencil=t,this._stencil._jsonStencil.superId&&(stencilId=this._stencil.id(),superStencilId=stencilId.substring(0,stencilId.indexOf("#")+1)+t._jsonStencil.superId,stencilSet=this._stencil.stencilSet(),this._stencil=stencilSet.stencil(superStencilId)),this.properties=new Hash,this.propertiesChanged=new Hash,this.hiddenProperties=new Hash,this._stencil.properties().each(function(e){var t=e.prefix()+"-"+e.id();this.properties[t]=e.value(),this.propertiesChanged[t]=!0}.bind(this)),t._jsonStencil.superId&&t.properties().each(function(e){var t=e.prefix()+"-"+e.id(),i=e.value(),n=this.properties[t];this.properties[t]=i,this.propertiesChanged[t]=!0,this._delegateEvent({type:ORYX.CONFIG.EVENT_PROPERTY_CHANGED,name:t,value:i,oldValue:n})}.bind(this))},layout:function(){},getStencil:function(){return this._stencil},getChildShapeByResourceId:function(t){return t=ERDF.__stripHashes(t),this.getChildShapes(!0).find(function(e){return e.resourceId==t})},getChildShapes:function(t,i){var n=[];return this.children.each(function(e){e instanceof ORYX.Core.Shape&&e.isVisible&&(i&&i(e),n.push(e),t&&(n=n.concat(e.getChildShapes(t,i))))}),n},hasChildShape:function(t){return this.getChildShapes().any(function(e){return e===t||e.hasChildShape(t)})},getChildNodes:function(t,i){var n=[];return this.children.each(function(e){e instanceof ORYX.Core.Node&&e.isVisible&&(i&&i(e),n.push(e)),e instanceof ORYX.Core.Shape&&t&&(n=n.concat(e.getChildNodes(t,i)))}),n},getChildEdges:function(t,i){var n=[];return this.children.each(function(e){e instanceof ORYX.Core.Edge&&e.isVisible&&(i&&i(e),n.push(e)),e instanceof ORYX.Core.Shape&&t&&(n=n.concat(e.getChildEdges(t,i)))}),n},getAbstractShapesAtPosition:function(){var s,o;switch(arguments.length){case 1:s=arguments[0].x,o=arguments[0].y;break;case 2:s=arguments[0],o=arguments[1];break;default:throw"getAbstractShapesAtPosition needs 1 or 2 arguments!"}if(this.isPointIncluded(s,o)){var t=[];return t.push(this),[this.getChildNodes(),this.getChildEdges()].each(function(e){var n=new Hash;e.each(function(e){if(e.isVisible){var t=e.getAbstractShapesAtPosition(s,o);if(0<t.length){var i=$A(e.node.parentNode.childNodes).indexOf(e.node);n[i]=t}}}),n.keys().sort().each(function(e){t=t.concat(n[e])})}),t}return[]},setProperty:function(e,t,i){var n=this.properties[e];n===t&&!0!==i||(this.properties[e]=t,this.propertiesChanged[e]=!0,this._changed(),this._isInSetProperty||(this._isInSetProperty=!0,this._delegateEvent({type:ORYX.CONFIG.EVENT_PROPERTY_CHANGED,elements:[this],name:e,value:t,oldValue:n}),delete this._isInSetProperty))},isPropertyChanged:function(){return this.propertiesChanged.any(function(e){return e.value})},setHiddenProperty:function(e,t){void 0!==t?this.hiddenProperties[e]!==t&&(this.hiddenProperties[e]=t):delete this.hiddenProperties[e]},isPointIncluded:function(e,t,i){return(i||this.absoluteBounds()).isIncluded(e,t)},serialize:function(){var n=[];return n.push({name:"type",prefix:"oryx",value:this.getStencil().id(),type:"literal"}),this.hiddenProperties.each(function(e){n.push({name:e.key.replace("oryx-",""),prefix:"oryx",value:e.value,type:"literal"})}.bind(this)),this.getStencil().properties().each(function(e){var t=e.prefix(),i=e.id();n.push({name:i,prefix:t,value:this.properties[t+"-"+i],type:"literal"})}.bind(this)),n},deserialize:function(e){(e=e.sort(function(e,t){return e=Number(this.properties.keys().member(e.prefix+"-"+e.name)),(t=Number(this.properties.keys().member(t.prefix+"-"+t.name)))<e?1:e<t?-1:0}.bind(this))).each(function(e){var t=e.name,i=e.prefix,n=e.value;switch("Object"===Object.prototype.toString.call(n)&&(n=JSON.stringify(n)),i+"-"+t){case"raziel-parent":if(!this.parent)break;var s=this.getCanvas().getChildShapeByResourceId(n);s&&s.add(this);break;default:var o=this.getStencil().property(i+"-"+t);o&&o.isList()&&"string"==typeof n&&(!(n||"").strip()||n.startsWith("[")||n.startsWith("]")||(n='["'+n.strip()+'"]'),n=((n||"").strip()||"[]").evalJSON()),this.properties.keys().member(i+"-"+t)?this.setProperty(i+"-"+t,n):"bounds"!==t&&"parent"!==t&&"target"!==t&&"dockers"!==t&&"docker"!==t&&"outgoing"!==t&&"incoming"!==t&&this.setHiddenProperty(i+"-"+t,n)}}.bind(this))},toString:function(){return"ORYX.Core.AbstractShape "+this.id},toJSON:function(){var e={resourceId:this.resourceId,properties:jQuery.extend({},this.properties,this.hiddenProperties).inject({},function(e,t){var i=t[0],n=t[1];if(this.getStencil().property(i)&&this.getStencil().property(i).type()===ORYX.CONFIG.TYPE_COMPLEX&&"String"===Object.prototype.toString.call(n))try{n=JSON.parse(n)}catch(e){}else if(n instanceof Date&&this.getStencil().property(i))try{n=n.format(this.getStencil().property(i).dateFormat())}catch(e){}return e[i=i.replace(/^[\w_]+-/,"")]=n,e}.bind(this)),stencil:{id:this.getStencil().idWithoutNs()},childShapes:this.getChildShapes().map(function(e){return e.toJSON()})};return this.getOutgoingShapes&&(e.outgoing=this.getOutgoingShapes().map(function(e){return{resourceId:e.resourceId}})),this.bounds&&(e.bounds={lowerRight:this.bounds.lowerRight(),upperLeft:this.bounds.upperLeft()}),this.dockers&&(e.dockers=this.dockers.map(function(e){var t=e.getDockedShape()&&e.referencePoint?e.referencePoint:e.bounds.center();return t.getDocker=function(){return e},t})),jQuery.extend(e,ORYX.Core.AbstractShape.JSONHelper),e.getShape=function(){return this}.bind(this),e}}),ORYX.Core.AbstractShape.JSONHelper={eachChild:function(i,n,s){if(this.childShapes){var o=[];this.childShapes.each(function(e){e.eachChild instanceof Function||jQuery.extend(e,ORYX.Core.AbstractShape.JSONHelper);var t=i(e,this);t&&o.push(t),n&&e.eachChild(i,n,s)}.bind(this)),s&&(this.childShapes=o)}},getShape:function(){return null},getChildShapes:function(t){var i=this.childShapes;return t&&this.eachChild(function(e){e.getChildShapes instanceof Function||jQuery.extend(e,ORYX.Core.AbstractShape.JSONHelper),i=i.concat(e.getChildShapes(t))},!0),i},serialize:function(){return JSON.stringify(this)}},!ORYX)var ORYX={};ORYX.Core||(ORYX.Core={}),ORYX.Core.Canvas=ORYX.Core.AbstractShape.extend({zoomLevel:1,construct:function(e,t,i){arguments.callee.$.construct.apply(this,arguments),e&&e.width&&e.height?(this.facade=i,this.resourceId=e.id,this.nodes=[],this.edges=[],this.colHighlightState=0,this.colHighlightEnabled=!1,this.rootNode=ORYX.Editor.graft("http://www.w3.org/2000/svg",e.parentNode,["svg",{id:this.id,width:e.width,height:e.height},["defs",{}]]),this.rootNode.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.rootNode.setAttribute("xmlns:svg","http://www.w3.org/2000/svg"),this._htmlContainer=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",e.parentNode,["div",{id:"oryx_canvas_htmlContainer",style:"position:absolute; top:5px"}]),this.underlayNode=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.rootNode,["svg",{id:"underlay-container"}]),this.columnHightlight1=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.underlayNode,["rect",{x:0,width:ORYX.CONFIG.FORM_ROW_WIDTH+35,height:"100%",style:"fill: #fff6d5",visibility:"hidden"}]),this.columnHightlight2=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.underlayNode,["rect",{x:ORYX.CONFIG.FORM_ROW_WIDTH+35,width:ORYX.CONFIG.FORM_ROW_WIDTH+25,height:"100%",style:"fill: #fff6d5",visibility:"hidden"}]),this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.rootNode,["g",{},["g",{class:"stencils"},["g",{class:"me"}],["g",{class:"children"}],["g",{class:"edge"}]],["g",{class:"svgcontainer"}]]),this.node.setAttributeNS(null,"stroke","none"),this.node.setAttributeNS(null,"font-family","Verdana, sans-serif"),this.node.setAttributeNS(null,"font-size-adjust","none"),this.node.setAttributeNS(null,"font-style","normal"),this.node.setAttributeNS(null,"font-variant","normal"),this.node.setAttributeNS(null,"font-weight","normal"),this.node.setAttributeNS(null,"line-heigth","normal"),this.node.setAttributeNS(null,"font-size",ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT),this.bounds.set(0,0,e.width,e.height),this.addEventHandlers(this.rootNode.parentNode),this.rootNode.oncontextmenu=function(){return!1}):ORYX.Log.fatal("Canvas is missing mandatory parameters options.width and options.height.")},focus:function(){try{this.focusEl||(this.focusEl=jQuery("body").append(jQuery('<a href="#" class="x-grid3-focus x-grid3-focus-canvas"/>')),this.focusEl.swallowEvent("click",!0)),this.focusEl.focus.defer(1,this.focusEl),this.focusEl.blur.defer(3,this.focusEl)}catch(e){}},setHightlightState:function(e){this.colHighlightEnabled&&this.colHighlightState!=e&&(0==e?(this.columnHightlight1.setAttribute("visibility","hidden"),this.columnHightlight2.setAttribute("visibility","hidden")):1==e?(this.columnHightlight1.setAttribute("visibility","visible"),this.columnHightlight2.setAttribute("visibility","hidden")):2==e?(this.columnHightlight1.setAttribute("visibility","hidden"),this.columnHightlight2.setAttribute("visibility","visible")):3==e&&(this.columnHightlight1.setAttribute("visibility","visible"),this.columnHightlight2.setAttribute("visibility","visible")),this.colHighlightState=e)},setHightlightStateBasedOnX:function(e){e>ORYX.CONFIG.FORM_ROW_WIDTH+30?this.setHightlightState(2):this.setHightlightState(1)},update:function(){this.nodes.each(function(e){this._traverseForUpdate(e)}.bind(this));var e=this.getStencil().layout();e&&e.each(function(e){e.shape=this,e.forceExecution=!0,e.target=this.rootNode,this._delegateEvent(e)}.bind(this)),this.nodes.invoke("_update"),this.edges.invoke("_update",!0)},_traverseForUpdate:function(e){var t=e.isChanged;return e.getChildNodes(!1,function(e){this._traverseForUpdate(e)&&(t=!0)}.bind(this)),!!t&&(e.layout(),!0)},layout:function(){},getChildNodes:function(t,i){if(t||i){var n=[];return this.nodes.each(function(e){i&&i(e),n.push(e),t&&e instanceof ORYX.Core.Shape&&(n=n.concat(e.getChildNodes(t,i)))}),n}return this.nodes.clone()},add:function(e,t,i){e instanceof ORYX.Core.UIObject?this.children.member(e)?ORYX.Log.warn("add: ORYX.Core.UIObject is already a child of this object."):(e.parent&&e.parent.remove(e,!0),null!=t?this.children.splice(t,0,e):this.children.push(e),e.parent=this,e instanceof ORYX.Core.Shape?e instanceof ORYX.Core.Edge?(e.addMarkers(this.rootNode.getElementsByTagNameNS(NAMESPACE_SVG,"defs")[0]),e.node=this.node.childNodes[0].childNodes[2].appendChild(e.node),this.edges.push(e)):(e.node=this.node.childNodes[0].childNodes[1].appendChild(e.node),this.nodes.push(e)):e.node=this.node.appendChild(e.node),e.bounds.registerCallback(this._changedCallback),this.eventHandlerCallback&&!0!==i&&this.eventHandlerCallback({type:ORYX.CONFIG.EVENT_SHAPEADDED,shape:e})):ORYX.Log.fatal("add: Parameter is not of type ORYX.Core.UIObject.")},remove:function(e,t){if(this.children.member(e)){var i=e.parent;this.children=this.children.without(e),e.parent=void 0,e instanceof ORYX.Core.Shape?e instanceof ORYX.Core.Edge?(e.removeMarkers(),e.node=this.node.childNodes[0].childNodes[2].removeChild(e.node),this.edges=this.edges.without(e)):(e.node=this.node.childNodes[0].childNodes[1].removeChild(e.node),this.nodes=this.nodes.without(e)):e.node=this.node.removeChild(e.node),this.eventHandlerCallback&&!0!==t&&this.eventHandlerCallback({type:ORYX.CONFIG.EVENT_SHAPEREMOVED,shape:e,parent:i}),e.bounds.unregisterCallback(this._changedCallback)}else ORYX.Log.warn("remove: ORYX.Core.UIObject is not a child of this object.")},addShapeObjects:function(e,s){if(e){this.initializingShapes=!0;var n=function(e,t){var i=ORYX.Core.StencilSet.stencil(this.getStencil().namespace()+e.stencil.id),n=new("node"==i.type()?ORYX.Core.Node:ORYX.Core.Edge)({eventHandlerCallback:s},i,this.facade);return n.resourceId=e.resourceId,n.node.id="svg-"+e.resourceId,e.parent="#"+(e.parent&&e.parent.resourceId||t.resourceId),this.add(n),{json:e,object:n}}.bind(this),o=function(t){var i=[];return t.childShapes&&t.childShapes.constructor==String&&(t.childShapes=JSON.parse(t.childShapes)),t.childShapes.each(function(e){i.push(n(e,t)),i=i.concat(o(e))}),i}.bind(this),t=o({childShapes:e,resourceId:this.resourceId});return t.each(function(e){var t=[];for(field in e.json.properties)t.push({prefix:"oryx",name:field,value:e.json.properties[field]});if(e.json.outgoing.each(function(e){t.push({prefix:"raziel",name:"outgoing",value:"#"+e.resourceId})}),e.object instanceof ORYX.Core.Edge){var i=e.json.target||e.json.outgoing[0];i&&t.push({prefix:"raziel",name:"target",value:"#"+i.resourceId})}e.json.bounds&&t.push({prefix:"oryx",name:"bounds",value:e.json.bounds.upperLeft.x+","+e.json.bounds.upperLeft.y+","+e.json.bounds.lowerRight.x+","+e.json.bounds.lowerRight.y}),e.json.dockers&&t.push({prefix:"oryx",name:"dockers",value:e.json.dockers.inject("",function(e,t){return e+t.x+" "+t.y+" "})+" #"}),t.push({prefix:"raziel",name:"parent",value:e.json.parent}),e.__properties=t}.bind(this)),t.each(function(e){e.object instanceof ORYX.Core.Node&&e.object.deserialize(e.__properties,e.json)}),t.each(function(e){e.object instanceof ORYX.Core.Edge&&(e.object.deserialize(e.__properties,e.json),e.object._oldBounds=e.object.bounds.clone(),e.object._update())}),delete this.initializingShapes,t.pluck("object")}},updateSize:function(){var i=0,n=0;this.getChildShapes(!0,function(e){var t=e.bounds;i=Math.max(i,t.lowerRight().x+100),n=Math.max(n,t.lowerRight().y+100)}),(this.bounds.width()<i||this.bounds.height()<n)&&this.setSize({width:Math.max(this.bounds.width(),i),height:Math.max(this.bounds.height(),n)})},getRootNode:function(){return this.rootNode},getUnderlayNode:function(){return this.underlayNode},getSvgContainer:function(){return this.node.childNodes[1]},getHTMLContainer:function(){return this._htmlContainer},getShapesWithSharedParent:function(i){return!i||i.length<1?[]:1==i.length?i:i.findAll(function(e){for(var t=e.parent;t;){if(i.member(t))return!1;t=t.parent}return!0})},setSize:function(e,t){e&&e.width&&e.height&&(this.rootNode.parentNode&&(this.rootNode.parentNode.style.width=e.width+"px",this.rootNode.parentNode.style.height=e.height+"px"),this.rootNode.setAttributeNS(null,"width",e.width),this.rootNode.setAttributeNS(null,"height",e.height),t||this.bounds.set({a:{x:0,y:0},b:{x:e.width/this.zoomLevel,y:e.height/this.zoomLevel}}))},getSVGRepresentation:function(e){var s,o,a,r,t=this.getRootNode().cloneNode(!0);this._removeInvisibleElements(t),this.getChildShapes(!0).each(function(e){var t=e.absoluteBounds(),i=t.upperLeft(),n=t.lowerRight();null==s?(s=i.x,o=i.y,a=n.x,r=n.y):(s=Math.min(s,i.x),o=Math.min(o,i.y),a=Math.max(a,n.x),r=Math.max(r,n.y))});var i,n;null==s?n=i=0:(i=a,n=r,25-s),t.setAttributeNS(null,"width",i+50),t.setAttributeNS(null,"height",n+50),t.childNodes[1].removeAttributeNS(null,"transform");try{var h=t.childNodes[1].childNodes[1];h.parentNode.removeChild(h)}catch(e){}return e&&($A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan")).each(function(e){e.textContent=e.textContent.escapeHTML()}),$A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"text")).each(function(e){0==e.childNodes.length&&(e.textContent=e.textContent.escapeHTML())})),$A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"image")).each(function(e){var t=e.getAttributeNS("http://www.w3.org/1999/xlink","href");t.match("^(http|https)://")||(t=window.location.protocol+"//"+window.location.host+t,e.setAttributeNS("http://www.w3.org/1999/xlink","href",t))}),$A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"a")).each(function(e){e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",(e.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").escapeHTML())}),t},_removeInvisibleElements:function(e){for(var t=0;t<e.childNodes.length;){var i=e.childNodes[t];i.getAttributeNS&&"hidden"===i.getAttributeNS(null,"visibility")?e.removeChild(i):(this._removeInvisibleElements(i),t++)}},_delegateEvent:function(e){!this.eventHandlerCallback||e.target!=this.rootNode&&e.target!=this.rootNode.parentNode||this.eventHandlerCallback(e,this)},toString:function(){return"Canvas "+this.id},toJSON:function(){var e=arguments.callee.$.toJSON.apply(this,arguments);return e.stencilset={url:this.getStencil().stencilSet().source(),namespace:this.getStencil().stencilSet().namespace()},e}});var idCounter=0,ID_PREFIX="resource";function init(){if(ORYX.Log.debug("Querying editor instances"),ORYX.Editor.setMissingClasses(),window.onOryxResourcesLoaded)window.onOryxResourcesLoaded();else{var e="./service/model/"+window.location.search.substring(4)+"/json";ORYX.Editor.createByUrl(e)}}if(!ORYX)var ORYX={};if(ORYX.Editor={DOMEventListeners:new Hash,selection:[],zoomLevel:1,construct:function(e){this._eventsQueue=[],this.loadedPlugins=[],this.pluginsData=[];var t=this.modelMetaData=e;if(this.id=t.modelId,e.model&&(t=e.model),this.id||(this.id=t.id,this.id||(this.id=ORYX.Editor.provideId())),this.fullscreen=!1!==e.fullscreen,this._initEventListener(),ORYX.CONFIG.BACKEND_SWITCH){var i=(t.stencilset.namespace||t.stencilset.url).replace("#","%23");ORYX.Core.StencilSet.loadStencilSet(i,this.modelMetaData,this.id)}else{i=t.stencilset.url;ORYX.Core.StencilSet.loadStencilSet(i,this.modelMetaData,this.id)}this._createCanvas(t.stencil?t.stencil.id:null,t.properties),this._generateGUI();var n=!1,s=!1,o=function(){n&&s&&this._finishedLoading()}.bind(this);window.setTimeout(function(){this.loadPlugins(),n=!0,o()}.bind(this),100),window.setTimeout(function(){this.loadSerialized(t,!0),this.getCanvas().update(),s=!0,o()}.bind(this),200)},_finishedLoading:function(){this.handleEvents({type:ORYX.CONFIG.EVENT_LOADED})},_initEventListener:function(){document.documentElement.addEventListener(ORYX.CONFIG.EVENT_KEYDOWN,this.catchKeyDownEvents.bind(this),!1),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_KEYUP,this.catchKeyUpEvents.bind(this),!1),this._keydownEnabled=!0,this._keyupEnabled=!0,this.DOMEventListeners[ORYX.CONFIG.EVENT_MOUSEDOWN]=[],this.DOMEventListeners[ORYX.CONFIG.EVENT_MOUSEUP]=[],this.DOMEventListeners[ORYX.CONFIG.EVENT_MOUSEOVER]=[],this.DOMEventListeners[ORYX.CONFIG.EVENT_MOUSEOUT]=[],this.DOMEventListeners[ORYX.CONFIG.EVENT_SELECTION_CHANGED]=[],this.DOMEventListeners[ORYX.CONFIG.EVENT_MOUSEMOVE]=[]},_generateGUI:function(){ORYX.CONFIG.WINDOW_HEIGHT;var e=this.getCanvas().rootNode.parentNode;jQuery("#canvasSection").append(e),e.parentNode.setAttributeNS(null,"align","center"),e.setAttributeNS(null,"align","left"),this.getCanvas().setSize({width:ORYX.CONFIG.CANVAS_WIDTH,height:ORYX.CONFIG.CANVAS_HEIGHT})},getAvailablePlugins:function(){var e=ORYX.availablePlugins.clone();return e.each(function(e){this.loadedPlugins.find(function(e){return e.type==this.name}.bind(e))?e.engaged=!0:e.engaged=!1}.bind(this)),e},loadScript:function(e,t){var i=document.createElement("script");i.type="text/javascript",i.readyState?i.onreadystatechange=function(){"loaded"!=i.readyState&&"complete"!=i.readyState||(i.onreadystatechange=null,t())}:i.onload=function(){t()},i.src=e,document.getElementsByTagName("head")[0].appendChild(i)},activatePluginByName:function(name,callback,loadTry){var match=this.getAvailablePlugins().find(function(e){return e.name==name});if(!match||match.engaged&&"false"!==match.engaged)callback(!1,match?"NOTFOUND":"YETACTIVATED");else{var loadedStencilSetsNamespaces=this.getStencilSets().keys(),facade=this._getPluginFacade(),newPlugin,me=this;if(ORYX.Log.debug("Initializing plugin '%0'",match.name),match.requires&&match.requires.namespaces&&!match.requires.namespaces.any(function(e){return 0<=loadedStencilSetsNamespaces.indexOf(e)}))callback(!1,"REQUIRESTENCILSET"),ORYX.Log.info("Plugin need a stencilset which is not loaded'",match.name);else if(match.notUsesIn&&match.notUsesIn.namespaces&&match.notUsesIn.namespaces.any(function(e){return 0<=loadedStencilSetsNamespaces.indexOf(e)}))callback(!1,"NOTUSEINSTENCILSET"),ORYX.Log.info("Plugin need a stencilset which is not loaded'",match.name);else try{var className=eval(match.name),newPlugin=new className(facade,match);newPlugin.type=match.name,newPlugin.registryChanged&&newPlugin.registryChanged(me.pluginsData),newPlugin.onSelectionChanged&&me.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,newPlugin.onSelectionChanged.bind(newPlugin)),this.loadedPlugins.push(newPlugin),this.loadedPlugins.each(function(e){e.registryChanged&&e.registryChanged(this.pluginsData)}.bind(me)),callback(!0)}catch(e){if(ORYX.Log.warn("Plugin %0 is not available",match.name),loadTry)return void callback(!1,"INITFAILED");this.loadScript("plugins/scripts/"+match.source,this.activatePluginByName.bind(this,match.name,callback,!0))}}},loadPlugins:function(){var me=this,newPlugins=[],loadedStencilSetsNamespaces=this.getStencilSets().keys(),facade=this._getPluginFacade();ORYX.MashupAPI&&ORYX.MashupAPI.loadablePlugins&&ORYX.MashupAPI.loadablePlugins instanceof Array&&(ORYX.availablePlugins=$A(ORYX.availablePlugins).findAll(function(e){return ORYX.MashupAPI.loadablePlugins.include(e.name)}),ORYX.MashupAPI.loadablePlugins.each(function(t){ORYX.availablePlugins.find(function(e){return e.name==t})||ORYX.availablePlugins.push({name:t})})),ORYX.availablePlugins.each(function(value){if(ORYX.Log.debug("Initializing plugin '%0'",value.name),value.requires&&value.requires.namespaces&&!value.requires.namespaces.any(function(e){return 0<=loadedStencilSetsNamespaces.indexOf(e)})||value.notUsesIn&&value.notUsesIn.namespaces&&value.notUsesIn.namespaces.any(function(e){return 0<=loadedStencilSetsNamespaces.indexOf(e)})||!value.engaged&&void 0!==value.engaged)ORYX.Log.info("Plugin need a stencilset which is not loaded'",value.name);else try{var className=eval(value.name);if(className){var plugin=new className(facade,value);plugin.type=value.name,newPlugins.push(plugin),plugin.engaged=!0}}catch(e){ORYX.Log.warn("Plugin %0 is not available %1",value.name,e)}}),newPlugins.each(function(e){e.registryChanged&&e.registryChanged(me.pluginsData),e.onSelectionChanged&&me.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,e.onSelectionChanged.bind(e))}),this.loadedPlugins=newPlugins,this.registerPluginsOnKeyEvents(),this.setSelection()},_createCanvas:function(e,t){e?-1===e.search(/^http/)&&(e=this.getStencilSets().values()[0].namespace()+e):e=this.getStencilSets().values()[0].findRootStencilName();var i=ORYX.Core.StencilSet.stencil(e);i||ORYX.Log.fatal("Initialisation failed, because the stencil with the type %0 is not part of one of the loaded stencil sets.",e);var n=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",null,["div"]);if(n.addClassName("ORYX_Editor"),this._canvas=new ORYX.Core.Canvas({width:ORYX.CONFIG.CANVAS_WIDTH,height:ORYX.CONFIG.CANVAS_HEIGHT,eventHandlerCallback:this.handleEvents.bind(this),id:this.id,parentNode:n},i,this._getPluginFacade()),t){var s=[];for(field in t)s.push({prefix:"oryx",name:field,value:t[field]});this._canvas.deserialize(s)}},_getPluginFacade:function(){return this._pluginFacade||(this._pluginFacade={activatePluginByName:this.activatePluginByName.bind(this),getAvailablePlugins:this.getAvailablePlugins.bind(this),offer:this.offer.bind(this),getStencilSets:this.getStencilSets.bind(this),getStencilSetExtensionDefinition:function(){return Object.clone(this.ss_extensions_def||{})}.bind(this),getRules:this.getRules.bind(this),loadStencilSet:this.loadStencilSet.bind(this),createShape:this.createShape.bind(this),deleteShape:this.deleteShape.bind(this),getSelection:this.getSelection.bind(this),setSelection:this.setSelection.bind(this),updateSelection:this.updateSelection.bind(this),getCanvas:this.getCanvas.bind(this),importJSON:this.importJSON.bind(this),getJSON:this.getJSON.bind(this),getSerializedJSON:this.getSerializedJSON.bind(this),executeCommands:this.executeCommands.bind(this),isExecutingCommands:this.isExecutingCommands.bind(this),registerOnEvent:this.registerOnEvent.bind(this),unregisterOnEvent:this.unregisterOnEvent.bind(this),raiseEvent:this.handleEvents.bind(this),enableEvent:this.enableEvent.bind(this),disableEvent:this.disableEvent.bind(this),eventCoordinates:this.eventCoordinates.bind(this),eventCoordinatesXY:this.eventCoordinatesXY.bind(this),getModelMetaData:this.getModelMetaData.bind(this)}),this._pluginFacade},isExecutingCommands:function(){return!!this.commandExecuting},executeCommands:function(e){if(this.commandStack||(this.commandStack=[]),this.commandStackExecuted||(this.commandStackExecuted=[]),this.commandStack=[].concat(this.commandStack).concat(e),!this.commandExecuting){for(this.commandExecuting=!0;0<this.commandStack.length;){var t=this.commandStack.shift();t.execute(),this.commandStackExecuted.push(t)}this.handleEvents({type:ORYX.CONFIG.EVENT_EXECUTE_COMMANDS,commands:this.commandStackExecuted}),delete this.commandStack,delete this.commandStackExecuted,delete this.commandExecuting,this.updateSelection()}},getJSON:function(){delete Array.prototype.toJSON;var e=this.getCanvas().toJSON();return e.ssextensions=this.getStencilSets().values()[0].extensions().keys().findAll(function(e){return!e.endsWith("/meta#")}),e},getSerializedJSON:function(){return JSON.stringify(this.getJSON())},importJSON:function(e,t){try{e=this.renewResourceIds(e)}catch(e){throw e}if(e.stencilset.namespace&&e.stencilset.namespace!==this.getCanvas().getStencil().stencilSet().namespace())return alert(String.format(ORYX.I18N.JSONImport.wrongSS,e.stencilset.namespace,this.getCanvas().getStencil().stencilSet().namespace())),null;var i=new(ORYX.Core.Command.extend({construct:function(e,t,i,n){this.jsonObject=e,this.noSelection=i,this.facade=n,this.shapes,this.connections=[],this.parents=new Hash,this.selection=this.facade.getSelection(),this.loadSerialized=t},execute:function(){this.shapes?(this.shapes.each(function(e){this.parents[e.id].add(e)}.bind(this)),this.connections.each(function(e){e[0].setDockedShape(e[1]),e[0].setReferencePoint(e[2]),e[0].update()})):(this.shapes=this.loadSerialized(this.jsonObject),this.shapes.each(function(e){if(e.getDockers){var t=e.getDockers();t&&(0<t.length&&this.connections.push([t.first(),t.first().getDockedShape(),t.first().referencePoint]),1<t.length&&this.connections.push([t.last(),t.last().getDockedShape(),t.last().referencePoint]))}this.parents[e.id]=e.parent}.bind(this))),this.facade.getCanvas().update(),this.noSelection?this.facade.updateSelection():this.facade.setSelection(this.shapes),this.facade.getCanvas().updateSize()},rollback:function(){var t=this.facade.getSelection();this.shapes.each(function(e){t=t.without(e),this.facade.deleteShape(e)}.bind(this)),this.facade.getCanvas().update(),this.facade.setSelection(t)}}))(e,this.loadSerialized.bind(this),t,this._getPluginFacade());return this.executeCommands([i]),i.shapes.clone()},renewResourceIds:function(e){if("String"===Object.prototype.toString.call(e))try{var i=e;e=JSON.parse(e)}catch(e){throw new SyntaxError(e.message)}else i=JSON.stringify(e);var t=function(e){return e?e.map(function(e){return t(e.childShapes).concat(e.resourceId)}).flatten():[]};return t(e.childShapes).each(function(e){var t=ORYX.Editor.provideId();i=i.replace(new RegExp(e,"g"),t)}),JSON.parse(i)},loadSerialized:function(e,t){this.getCanvas();if(this.loadSSExtensions(e.ssextensions),!0===t){var i=this.getExtensionForMetaData();i&&this.loadSSExtension(i)}var n=this.getCanvas().addShapeObjects(e.childShapes,this.handleEvents.bind(this));if(e.properties)for(key in e.properties){var s=e.properties[key],o=this.getCanvas().getStencil().property("oryx-"+key);"string"==typeof s||o&&o.isList()||(s=JSON.stringify(s)),this.getCanvas().setProperty("oryx-"+key,s)}return this.getCanvas().updateSize(),this.selection=[null],this.setSelection([]),n},getExtensionForMetaData:function(){if(!(this.ss_extensions_def&&this.ss_extensions_def.extensions instanceof Array))return null;var t=this.getStencilSets(),e=this.ss_extensions_def.extensions.find(function(e){return!!t[e.extends]&&e.namespace.endsWith("/meta#")});return e&&e.namespace||null},loadSSExtensions:function(e){e&&e.each(function(e){this.loadSSExtension(e)}.bind(this))},loadSSExtension:function(t){if(this.ss_extensions_def){var e=this.ss_extensions_def.extensions.find(function(e){return e.namespace==t});if(!e)return;var i=this.getStencilSets()[e.extends];if(!i)return;(e.definition||"").startsWith("/")?i.addExtension(e.definition):i.addExtension(ORYX.CONFIG.SS_EXTENSIONS_FOLDER+e.definition),this.getRules().initializeRules(i),this._getPluginFacade().raiseEvent({type:ORYX.CONFIG.EVENT_STENCIL_SET_LOADED})}},disableEvent:function(e){if(e==ORYX.CONFIG.EVENT_KEYDOWN&&(this._keydownEnabled=!1),e==ORYX.CONFIG.EVENT_KEYUP&&(this._keyupEnabled=!1),this.DOMEventListeners.keys().member(e)){var t=this.DOMEventListeners.remove(e);this.DOMEventListeners["disable_"+e]=t}},enableEvent:function(e){if(e==ORYX.CONFIG.EVENT_KEYDOWN&&(this._keydownEnabled=!0),e==ORYX.CONFIG.EVENT_KEYUP&&(this._keyupEnabled=!0),this.DOMEventListeners.keys().member("disable_"+e)){var t=this.DOMEventListeners.remove("disable_"+e);this.DOMEventListeners[e]=t}},registerOnEvent:function(e,t){this.DOMEventListeners.keys().member(e)||(this.DOMEventListeners[e]=[]),this.DOMEventListeners[e].push(t)},unregisterOnEvent:function(e,t){this.DOMEventListeners.keys().member(e)&&(this.DOMEventListeners[e]=this.DOMEventListeners[e].without(t))},getSelection:function(){return this.selection||[]},getStencilSets:function(){return ORYX.Core.StencilSet.stencilSets(this.id)},getRules:function(){return ORYX.Core.StencilSet.rules(this.id)},loadStencilSet:function(e){try{ORYX.Core.StencilSet.loadStencilSet(e,this.modelMetaData,this.id),this.handleEvents({type:ORYX.CONFIG.EVENT_STENCIL_SET_LOADED})}catch(e){ORYX.Log.warn("Requesting stencil set file failed. ("+e+")")}},offer:function(e){this.pluginsData.member(e)||this.pluginsData.push(e)},registerPluginsOnKeyEvents:function(){this.pluginsData.each(function(i){i.keyCodes&&i.keyCodes.each(function(e){var t="key.event";t+="."+e.keyAction,e.metaKeys&&(-1<e.metaKeys.indexOf(ORYX.CONFIG.META_KEY_META_CTRL)&&(t+="."+ORYX.CONFIG.META_KEY_META_CTRL),-1<e.metaKeys.indexOf(ORYX.CONFIG.META_KEY_ALT)&&(t+="."+ORYX.CONFIG.META_KEY_ALT),-1<e.metaKeys.indexOf(ORYX.CONFIG.META_KEY_SHIFT)&&(t+="."+ORYX.CONFIG.META_KEY_SHIFT)),e.keyCode&&(t+="."+e.keyCode),ORYX.Log.debug("Register Plugin on Key Event: %0",t),!0===i.toggle&&i.buttonInstance?this.registerOnEvent(t,function(){i.buttonInstance.toggle(!i.buttonInstance.pressed),i.functionality.call(i,i.buttonInstance,i.buttonInstance.pressed)}):this.registerOnEvent(t,i.functionality)}.bind(this))}.bind(this))},isEqual:function(e,t){return e===t||e.length===t.length&&e.all(function(e){return t.include(e)})},isDirty:function(e){return e.any(function(e){return e.isPropertyChanged()})},setSelection:function(e,t,i){e||(e=[]),e instanceof Array||(e=[e]),(e=e.findAll(function(e){return e&&e instanceof ORYX.Core.Shape}))[0]instanceof ORYX.Core.Canvas&&(e=[]),(i||!this.isEqual(this.selection,e)||this.isDirty(e))&&(this.selection=e,this._subSelection=t,this.handleEvents({type:ORYX.CONFIG.EVENT_SELECTION_CHANGED,elements:e,subSelection:t,force:!!i}))},updateSelection:function(){this.setSelection(this.selection,this._subSelection,!0)},getCanvas:function(){return this._canvas},createShape:function(e){if(e&&e.serialize&&e.serialize instanceof Array){var t=e.serialize.find(function(e){return e.prefix+"-"+e.name=="oryx-type"}),i=ORYX.Core.StencilSet.stencil(t.value);if("node"==i.type())var n=new ORYX.Core.Node({eventHandlerCallback:this.handleEvents.bind(this)},i,this._getPluginFacade());else n=new ORYX.Core.Edge({eventHandlerCallback:this.handleEvents.bind(this)},i,this._getPluginFacade());return this.getCanvas().add(n),n.deserialize(e.serialize),n}if(!e||!e.type||!e.namespace)throw"To create a new shape you have to give an argument with type and namespace";var s=this.getCanvas(),o=e.type,a=ORYX.Core.StencilSet.stencilSet(e.namespace);n="node"==a.stencil(o).type()?new ORYX.Core.Node({eventHandlerCallback:this.handleEvents.bind(this)},a.stencil(o),this._getPluginFacade()):new ORYX.Core.Edge({eventHandlerCallback:this.handleEvents.bind(this)},a.stencil(o),this._getPluginFacade()),e.template&&(n._jsonStencil.properties=e.template._jsonStencil.properties,n.postProcessProperties()),e.parent&&n instanceof ORYX.Core.Node?e.parent.add(n):s.add(n);var r,h=e.position?e.position:{x:100,y:200};if(e.connectingType&&e.connectedShape&&!(n instanceof ORYX.Core.Edge)){(r=new ORYX.Core.Edge({eventHandlerCallback:this.handleEvents.bind(this)},a.stencil(e.connectingType))).dockers.first().setDockedShape(e.connectedShape);var c=e.connectedShape.getDefaultMagnet(),d=c?c.bounds.center():e.connectedShape.bounds.midPoint();r.dockers.first().setReferencePoint(d),r.dockers.last().setDockedShape(n),r.dockers.last().setReferencePoint(n.getDefaultMagnet().bounds.center()),s.add(r)}if(n instanceof ORYX.Core.Edge&&e.connectedShape){n.dockers.first().setDockedShape(e.connectedShape),e.connectedShape instanceof ORYX.Core.Node?(n.dockers.first().setReferencePoint(e.connectedShape.getDefaultMagnet().bounds.center()),n.dockers.last().bounds.centerMoveTo(h)):n.dockers.first().setReferencePoint(e.connectedShape.bounds.midPoint());var l=n.dockers.first(),u=n.dockers.last();if(l.getDockedShape()&&u.getDockedShape()){var f=l.getAbsoluteReferencePoint();u.getAbsoluteReferencePoint();n.createDocker().bounds.centerMoveTo({x:f.x+(endPont.x-f.x)/2,y:f.y+(endPont.y-f.y)/2})}}else{var g=n.bounds;n instanceof ORYX.Core.Node&&1==n.dockers.length&&(g=n.dockers.first().bounds),g.centerMoveTo(h);var p=g.upperLeft();g.moveBy(-Math.min(p.x,0),-Math.min(p.y,0));var O=g.lowerRight();g.moveBy(-Math.max(O.x-s.bounds.width(),0),-Math.max(O.y-s.bounds.height(),0))}return n instanceof ORYX.Core.Edge&&n._update(!1),n instanceof ORYX.Core.Edge||e.dontUpdateSelection||this.setSelection([n]),r&&r.alignDockers,n.alignDockers&&n.alignDockers(),n},deleteShape:function(i){i&&i.parent&&(i.parent.remove(i),i.getOutgoingShapes().each(function(e){var t=e.getDockers().first();t&&t.getDockedShape()==i&&t.setDockedShape(void 0)}),i.getIncomingShapes().each(function(e){var t=e.getDockers().last();t&&t.getDockedShape()==i&&t.setDockedShape(void 0)}),i.getDockers().each(function(e){e.setDockedShape(void 0)}))},getModelMetaData:function(){return this.modelMetaData},_executeEventImmediately:function(t){this.DOMEventListeners.keys().member(t.event.type)&&this.DOMEventListeners[t.event.type].each(function(e){e(t.event,t.arg)}.bind(this))},_executeEvents:function(){for(this._queueRunning=!0;0<this._eventsQueue.length;){var e=this._eventsQueue.shift();this._executeEventImmediately(e)}this._queueRunning=!1},handleEvents:function(e,t){switch(ORYX.Log.trace("Dispatching event type %0 on %1",e.type,t),e.type){case ORYX.CONFIG.EVENT_MOUSEDOWN:this._handleMouseDown(e,t);break;case ORYX.CONFIG.EVENT_MOUSEMOVE:this._handleMouseMove(e,t);break;case ORYX.CONFIG.EVENT_MOUSEUP:this._handleMouseUp(e,t);break;case ORYX.CONFIG.EVENT_MOUSEOVER:this._handleMouseHover(e,t);break;case ORYX.CONFIG.EVENT_MOUSEOUT:this._handleMouseOut(e,t)}return e.forceExecution?this._executeEventImmediately({event:e,arg:t}):this._eventsQueue.push({event:e,arg:t}),this._queueRunning||this._executeEvents(),!1},isValidEvent:function(e){try{var t=["INPUT","TEXTAREA"].include(e.target.tagName.toUpperCase()),i=e.target.className.include("x-grid3-focus")&&!e.target.className.include("x-grid3-focus-canvas");return!t&&!i}catch(e){return!1}},catchKeyUpEvents:function(e){if(this._keyupEnabled&&(e||(e=window.event),this.isValidEvent(e))){var t=this.createKeyCombEvent(e,ORYX.CONFIG.KEY_ACTION_UP);ORYX.Log.debug("Key Event to handle: %0",t),this.handleEvents({type:t,event:e})}},catchKeyDownEvents:function(e){if(this._keydownEnabled&&(e||(e=window.event),this.isValidEvent(e))){var t=this.createKeyCombEvent(e,ORYX.CONFIG.KEY_ACTION_DOWN);ORYX.Log.debug("Key Event to handle: %0",t),this.handleEvents({type:t,event:e})}},createKeyCombEvent:function(e,t){var i=e.which||e.keyCode,n="key.event";return t&&(n+="."+t),(e.ctrlKey||e.metaKey)&&(n+="."+ORYX.CONFIG.META_KEY_META_CTRL),e.altKey&&(n+="."+ORYX.CONFIG.META_KEY_ALT),e.shiftKey&&(n+="."+ORYX.CONFIG.META_KEY_SHIFT),n+"."+i},_handleMouseDown:function(e,t){this.getCanvas().focus();var i=e.currentTarget,n=t,s=null!=n&&n.isSelectable,o=null!=n&&n.isMovable,a=e.shiftKey||e.ctrlKey,r=0===this.selection.length,h=this.selection.member(n);if(s&&r)this.setSelection([n]),ORYX.Log.trace("Rule #1 applied for mouse down on %0",i.id);else if(!s||r||a||h)if(s&&a&&!h){(c=this.selection.clone()).push(n),this.setSelection(c),ORYX.Log.trace("Rule #4 applied for mouse down on %0",i.id)}else if(s&&h&&a){var c=this.selection.clone();this.setSelection(c.without(n)),ORYX.Log.trace("Rule #6 applied for mouse down on %0",n.id)}else{if(!s&&!o)return this.setSelection([]),void ORYX.Log.trace("Rule #2 applied for mouse down on %0",i.id);s||!o||n instanceof ORYX.Core.Controls.Docker?s&&h&&!a&&(this._subSelection=this._subSelection!=n?n:void 0,this.setSelection(this.selection,this._subSelection),ORYX.Log.trace("Rule #8 applied for mouse down on %0",i.id)):ORYX.Log.trace("Rule #7 applied for mouse down on %0",i.id)}else this.setSelection([n]),ORYX.Log.trace("Rule #3 applied for mouse down on %0",i.id)},_handleMouseMove:function(e,t){},_handleMouseUp:function(e,t){this.getCanvas(),this.eventCoordinates(e)},_handleMouseHover:function(e,t){},_handleMouseOut:function(e,t){},eventCoordinates:function(e){var t=this.getCanvas(),i=t.node.ownerSVGElement.createSVGPoint();i.x=e.clientX,i.y=e.clientY;var n=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)&&0<=navigator.userAgent.indexOf("MSIE")){var s=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==s&&(n=s/100)}1!==n&&(i.x=i.x*n,i.y=i.y*n);var o=t.node.getScreenCTM();return i.matrixTransform(o.inverse())},eventCoordinatesXY:function(e,t){var i=this.getCanvas(),n=i.node.ownerSVGElement.createSVGPoint();n.x=e,n.y=t;var s=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)&&0<=navigator.userAgent.indexOf("MSIE")){var o=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==o&&(s=o/100)}1!==s&&(n.x=n.x*s,n.y=n.y*s);var a=i.node.getScreenCTM();return n.matrixTransform(a.inverse())}},ORYX.Editor=Clazz.extend(ORYX.Editor),ORYX.Editor.createByUrl=function(e){new Ajax.Request(e,{method:"GET",onSuccess:function(e){var t=JSON.parse(e.responseText);new ORYX.Editor(t)}.bind(this)})},ORYX.Editor.graft=function(e,t,i,n){var s;if(n=n||t&&t.ownerDocument||document,void 0===i)throw"Can't graft an undefined value";if(i.constructor==String)s=n.createTextNode(i);else for(var o=0;o<i.length;o++){if(0===o&&i[o].constructor==String){var a;if(a=i[o].match(/^([a-z][a-z0-9]*)\.([^\s\.]+)$/i)){(s=n.createElementNS(e,a[1])).setAttributeNS(null,"class",a[2]);continue}if(a=i[o].match(/^([a-z][a-z0-9]*)$/i)){s=n.createElementNS(e,a[1]);continue}(s=n.createElementNS(e,"span")).setAttribute(null,"class","namelessFromLOL")}if(void 0===i[o])throw"Can't graft an undefined value in a list!";if(i[o].constructor==String||i[o].constructor==Array)this.graft(e,s,i[o],n);else if(i[o].constructor==Number)this.graft(e,s,i[o].toString(),n);else if(i[o].constructor==Object)for(var r in i[o])s.setAttributeNS(null,r,i[o][r])}return t&&t.appendChild&&t.appendChild(s),s},ORYX.Editor.provideId=function(){for(var e=[],t=0;t<36;t++)e[t]=Math.floor(16*Math.random());e[14]=4,e[19]=3&e[19]|8;for(t=0;t<36;t++)e[t]="0123456789ABCDEF"[e[t]];return e[8]=e[13]=e[18]=e[23]="-","oryx_"+e.join("")},ORYX.Editor.resizeFix=function(){ORYX.Editor._resizeFixTimeout||(ORYX.Editor._resizeFixTimeout=window.setTimeout(function(){window.resizeBy(1,1),window.resizeBy(-1,-1),ORYX.Editor._resizefixTimeout=null},100))},ORYX.Editor.Cookie={callbacks:[],onChange:function(e,t){this.callbacks.push(e),this.start(t)},start:function(e){if(!this.pe){var t=document.cookie;this.pe=new PeriodicalExecuter(function(){t!=document.cookie&&(t=document.cookie,this.callbacks.each(function(e){e(this.getParams())}.bind(this)))}.bind(this),(e||1e4)/1e3)}},stop:function(){this.pe&&(this.pe.stop(),this.pe=null)},getParams:function(){var t={};return document.cookie.split("; ").each(function(e){t[e.split("=")[0]]=e.split("=")[1]}),t},toString:function(){return document.cookie}},ORYX.Editor.SVGClassElementsAreAvailable=!0,ORYX.Editor.setMissingClasses=function(){try{SVGElement}catch(e){ORYX.Editor.SVGClassElementsAreAvailable=!1,SVGSVGElement=document.createElementNS("http://www.w3.org/2000/svg","svg").toString(),SVGGElement=document.createElementNS("http://www.w3.org/2000/svg","g").toString(),SVGPathElement=document.createElementNS("http://www.w3.org/2000/svg","path").toString(),SVGTextElement=document.createElementNS("http://www.w3.org/2000/svg","text").toString(),SVGRectElement=document.createElementNS("http://www.w3.org/2000/svg","rect").toString(),SVGImageElement=document.createElementNS("http://www.w3.org/2000/svg","image").toString(),SVGCircleElement=document.createElementNS("http://www.w3.org/2000/svg","circle").toString(),SVGEllipseElement=document.createElementNS("http://www.w3.org/2000/svg","ellipse").toString(),SVGLineElement=document.createElementNS("http://www.w3.org/2000/svg","line").toString(),SVGPolylineElement=document.createElementNS("http://www.w3.org/2000/svg","polyline").toString(),SVGPolygonElement=document.createElementNS("http://www.w3.org/2000/svg","polygon").toString()}},ORYX.Editor.checkClassType=function(e,t){return ORYX.Editor.SVGClassElementsAreAvailable?e instanceof t:e==t},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),new function(){ORYX.Core.UIEnableDrag=function(e,t,i){var n=(this.uiObj=t).bounds.upperLeft(),s=t.node.getScreenCTM();this.faktorXY={x:s.a,y:s.d},this.scrollNode=t.node.ownerSVGElement.parentNode.parentNode,this.offSetPosition={x:Event.pointerX(e)-n.x*this.faktorXY.x,y:Event.pointerY(e)-n.y*this.faktorXY.y},this.offsetScroll={x:this.scrollNode.scrollLeft,y:this.scrollNode.scrollTop},this.dragCallback=ORYX.Core.UIDragCallback.bind(this),this.disableCallback=ORYX.Core.UIDisableDrag.bind(this),this.movedCallback=i?i.movedCallback:void 0,this.upCallback=i?i.upCallback:void 0,document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.disableCallback,!0),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.dragCallback,!1)},ORYX.Core.UIDragCallback=function(e){var t={x:Event.pointerX(e)-this.offSetPosition.x,y:Event.pointerY(e)-this.offSetPosition.y};t.x-=this.offsetScroll.x-this.scrollNode.scrollLeft,t.y-=this.offsetScroll.y-this.scrollNode.scrollTop,t.x/=this.faktorXY.x,t.y/=this.faktorXY.y,this.uiObj.bounds.moveTo(t),this.movedCallback&&this.movedCallback(e)},ORYX.Core.UIDisableDrag=function(e){document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.dragCallback,!1),document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.disableCallback,!0),this.upCallback&&this.upCallback(e),this.upCallback=void 0,this.movedCallback=void 0,Event.stop(e)},ORYX.Core.MoveDockersCommand=ORYX.Core.Command.extend({construct:function(e){this.dockers=$H(e),this.edges=$H({})},execute:function(){this.changes?this.executeAgain():(this.changes=$H({}),this.dockers.values().each(function(e){var t=e.docker.parent;t&&(this.changes[t.getId()]||(this.changes[t.getId()]={edge:t,oldDockerPositions:t.dockers.map(function(e){return e.bounds.center()})}),e.docker.bounds.moveBy(e.offset),this.edges[t.getId()]=t,e.docker.update())}.bind(this)),this.edges.each(function(e){this.updateEdge(e.value),this.changes[e.value.getId()]&&(this.changes[e.value.getId()].dockerPositions=e.value.dockers.map(function(e){return e.bounds.center()}))}.bind(this)))},updateEdge:function(e){e._update(!0),[e.getOutgoingShapes(),e.getIncomingShapes()].flatten().invoke("_update",[!0])},executeAgain:function(){this.changes.values().each(function(n){this.removeAllDocker(n.edge),n.dockerPositions.each(function(e,t){if(0!=t&&t!=n.dockerPositions.length-1){var i=n.edge.createDocker(void 0,e);i.bounds.centerMoveTo(e),i.update()}}.bind(this)),this.updateEdge(n.edge)}.bind(this))},rollback:function(){this.changes.values().each(function(n){this.removeAllDocker(n.edge),n.oldDockerPositions.each(function(e,t){if(0!=t&&t!=n.oldDockerPositions.length-1){var i=n.edge.createDocker(void 0,e);i.bounds.centerMoveTo(e),i.update()}}.bind(this)),this.updateEdge(n.edge)}.bind(this))},removeAllDocker:function(t){t.dockers.slice(1,t.dockers.length-1).each(function(e){t.removeDocker(e)})}})},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Shape={construct:function(e,t,i){arguments.callee.$.construct.apply(this,arguments),this.facade=i,this.dockers=[],this.magnets=[],this._defaultMagnet,this.incoming=[],this.outgoing=[],this.nodes=[],this._dockerChangedCallback=this._dockerChanged.bind(this),this._labels=new Hash,this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["g",{id:"svg-"+this.resourceId},["g",{class:"stencils"},["g",{class:"me"}],["g",{class:"children",style:"overflow:hidden"}],["g",{class:"edge"}]],["g",{class:"controls"},["g",{class:"dockers"}],["g",{class:"magnets"}]]])},update:function(){},_update:function(){},refresh:function(){if(arguments.callee.$.refresh.apply(this,arguments),this.node.ownerDocument){this.propertiesChanged.each(function(e){if(e.value){var u=this.properties[e.key],f=this.getStencil().property(e.key);if(null!=f)if(this.propertiesChanged[e.key]=!1,f.type()==ORYX.CONFIG.TYPE_CHOICE){f.refToView().each(function(e){if(""!==e){var t=this._labels[this.id+e];t&&f.item(u)&&t.text(f.item(u).title())}}.bind(this));var n=new Hash;f.items().each(function(i){i.refToView().each(function(e){if(""!=e){var t=this.node.ownerDocument.getElementById(this.id+e);t&&(n[t.id]&&u!=i.value()||(t.setAttributeNS(null,"display",u==i.value()?"inherit":"none"),n[t.id]=t),ORYX.Editor.checkClassType(t,SVGImageElement)&&t.setAttributeNS("http://www.w3.org/1999/xlink","href",t.getAttributeNS("http://www.w3.org/1999/xlink","href")))}}.bind(this))}.bind(this))}else f.refToView().each(function(e){if(""!==e){var t=this.id+e;if(f.type()!==ORYX.CONFIG.TYPE_KISBPM_MULTIINSTANCE){if("cancelactivity"===f.type()){var i=this.node.ownerDocument.getElementById(this.id+"frame"),n=this.node.ownerDocument.getElementById(this.id+"frame2");"true"===u?(i.setAttributeNS(null,"display","inherit"),n.setAttributeNS(null,"display","inherit")):(i.setAttributeNS(null,"display","none"),n.setAttributeNS(null,"display","none"))}var s=this.node.ownerDocument.getElementById(t);if(!s||!s.ownerSVGElement){if(f.type()!==ORYX.CONFIG.TYPE_URL&&f.type()!==ORYX.CONFIG.TYPE_DIAGRAM_LINK)return;var o=this.node.ownerDocument.getElementsByTagNameNS("http://www.w3.org/2000/svg","a");if(!(s=$A(o).find(function(e){return e.getAttributeNS(null,"id")===t})))return}if(f.complexAttributeToView()){if(r=this._labels[t])try{propJson=u.evalJSON();var a=propJson[f.complexAttributeToView()];r.text(a||u)}catch(e){r.text(u)}}else switch(f.type()){case ORYX.CONFIG.TYPE_BOOLEAN:"string"==typeof u&&(u="true"===u),s.setAttributeNS(null,"display",u!==f.inverseBoolean()?"inherit":"none");break;case ORYX.CONFIG.TYPE_COLOR:f.fill()&&("stop"===s.tagName.toLowerCase()?(u&&(f.lightness()&&1!==f.lightness()&&(u=ORYX.Utils.adjustLightness(u,f.lightness())),s.setAttributeNS(null,"stop-color",u),"radialgradient"===s.parentNode.tagName.toLowerCase()&&ORYX.Utils.adjustGradient(s.parentNode,s)),"radialgradient"===s.parentNode.tagName.toLowerCase()&&$A(s.parentNode.getElementsByTagName("stop")).each(function(e){e.setAttributeNS(null,"stop-opacity",u?e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"default-stop-opacity")||1:0)}.bind(this))):s.setAttributeNS(null,"fill",u)),f.stroke()&&s.setAttributeNS(null,"stroke",u);break;case ORYX.CONFIG.TYPE_STRING:case ORYX.CONFIG.TYPE_EXPRESSION:case ORYX.CONFIG.TYPE_DATASOURCE:case ORYX.CONFIG.TYPE_INTEGER:(r=this._labels[t])&&r.text(u);break;case ORYX.CONFIG.TYPE_FLOAT:var r;if(f.fillOpacity()&&s.setAttributeNS(null,"fill-opacity",u),f.strokeOpacity()&&s.setAttributeNS(null,"stroke-opacity",u),!f.fillOpacity()&&!f.strokeOpacity())(r=this._labels[t])&&r.text(u);break;case ORYX.CONFIG.TYPE_FORM_LINK:if("pimg"==e){var h=s.getAttributeNodeNS("","onclick");h&&(u&&0<(""+u).length?h.textContent="window.location = '../service/editor?id="+u+"_form'":(newFormFacade=this.facade,h.textContent="displayNewFormDialog('"+this.resourceId+"');"))}else"linkIndicator"==e&&(u&&0<u.length?s.setAttributeNS(null,"display","inherit"):s.setAttributeNS(null,"display","none"));break;case ORYX.CONFIG.TYPE_URL:case ORYX.CONFIG.TYPE_DIAGRAM_LINK:var c=s.getAttributeNodeNS("http://www.w3.org/1999/xlink","xlink:href");c?c.textContent=u:s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u)}}else if("multiinstance"===e){var d=this.node.ownerDocument.getElementById(this.id+"parallel");d&&("Parallel"===u?d.setAttributeNS(null,"display","inherit"):d.setAttributeNS(null,"display","none"));var l=this.node.ownerDocument.getElementById(this.id+"sequential");l&&("Sequential"===u?l.setAttributeNS(null,"display","inherit"):l.setAttributeNS(null,"display","none"))}}}.bind(this))}}.bind(this)),this._labels.values().each(function(e){e.update()})}},layout:function(){var e=this.getStencil().layout();e&&e.each(function(e){e.shape=this,e.forceExecution=!0,this._delegateEvent(e)}.bind(this))},getLabels:function(){return this._labels.values()},getLabel:function(t){return t&&(this._labels.find(function(e){return e.key.endsWith(t)})||{}).value||null},hideLabels:function(){this.getLabels().invoke("hide")},showLabels:function(){var e=this.getLabels();e.invoke("show"),e.each(function(e){e.update()})},setOpacity:function(e,t){1!==(e=Math.max(Math.min("number"==typeof e?e:1,1),0))?(e=String(e),this.node.setAttributeNS(null,"fill-opacity",e),this.node.setAttributeNS(null,"stroke-opacity",e)):(this.node.removeAttributeNS(null,"fill-opacity"),this.node.removeAttributeNS(null,"stroke-opacity"))},getDockers:function(){return this.dockers},getMagnets:function(){return this.magnets},getDefaultMagnet:function(){return this._defaultMagnet?this._defaultMagnet:0<this.magnets.length?this.magnets[0]:void 0},getParentShape:function(){return this.parent},getIncomingShapes:function(e){return e&&this.incoming.each(e),this.incoming},getIncomingNodes:function(i){return this.incoming.select(function(e){var t=e instanceof ORYX.Core.Node;return t&&i&&i(e),t})},getOutgoingShapes:function(e){return e&&this.outgoing.each(e),this.outgoing},getOutgoingNodes:function(i){return this.outgoing.select(function(e){var t=e instanceof ORYX.Core.Node;return t&&i&&i(e),t})},getAllDockedShapes:function(e){var t=this.incoming.concat(this.outgoing);return e&&t.each(e),t},getCanvas:function(){return this.parent instanceof ORYX.Core.Canvas?this.parent:this.parent instanceof ORYX.Core.Shape?this.parent.getCanvas():void 0},getChildNodes:function(t,i){if(t||i){var n=[];return this.nodes.each(function(e){e.isVisible&&(i&&i(e),n.push(e),t&&e instanceof ORYX.Core.Shape&&(n=n.concat(e.getChildNodes(t,i))))}),n}return this.nodes.clone()},add:function(e,t,i){if(e instanceof ORYX.Core.UIObject&&!(e instanceof ORYX.Core.Edge))if(this.children.member(e))ORYX.Log.warn("add: ORYX.Core.UIObject is already a child of this object.");else{var n;if(e.parent&&e.parent.remove(e,!0),null!=t?this.children.splice(t,0,e):this.children.push(e),e.parent=this,e instanceof ORYX.Core.Node)n=this.node.childNodes[0].childNodes[1],this.nodes.push(e);else if(e instanceof ORYX.Core.Controls.Control){var s=this.node.childNodes[1];e instanceof ORYX.Core.Controls.Docker?(n=s.childNodes[0],2<=this.dockers.length?this.dockers.splice(void 0!==t?Math.min(t,this.dockers.length-1):this.dockers.length-1,0,e):this.dockers.push(e)):e instanceof ORYX.Core.Controls.Magnet?(n=s.childNodes[1],this.magnets.push(e)):n=s}else n=this.node;null!=t&&t<n.childNodes.length?e.node=n.insertBefore(e.node,n.childNodes[t]):e.node=n.appendChild(e.node),this._changed(),this.eventHandlerCallback&&!0!==i&&this.eventHandlerCallback({type:ORYX.CONFIG.EVENT_SHAPEADDED,shape:e})}else ORYX.Log.warn("add: Parameter is not of type ORYX.Core.UIObject.")},remove:function(e,t){if(this.children.member(e)){var i=e.parent;this.children=this.children.without(e),e.parent=void 0,e instanceof ORYX.Core.Shape?e instanceof ORYX.Core.Edge?(e.removeMarkers(),e.node=this.node.childNodes[0].childNodes[2].removeChild(e.node)):(e.node=this.node.childNodes[0].childNodes[1].removeChild(e.node),this.nodes=this.nodes.without(e)):e instanceof ORYX.Core.Controls.Control&&(e instanceof ORYX.Core.Controls.Docker?(e.node=this.node.childNodes[1].childNodes[0].removeChild(e.node),this.dockers=this.dockers.without(e)):e instanceof ORYX.Core.Controls.Magnet?(e.node=this.node.childNodes[1].childNodes[1].removeChild(e.node),this.magnets=this.magnets.without(e)):e.node=this.node.childNodes[1].removeChild(e.node)),this.eventHandlerCallback&&!0!==t&&this.eventHandlerCallback({type:ORYX.CONFIG.EVENT_SHAPEREMOVED,shape:e,parent:i}),this._changed()}else ORYX.Log.warn("remove: ORYX.Core.UIObject is not a child of this object.")},getIntersectionPoint:function(){var e,t,i,n,s,o,a,r;switch(arguments.length){case 2:e=arguments[0].x,t=arguments[0].y,i=arguments[1].x,n=arguments[1].y;break;case 4:e=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3];break;default:throw"getIntersectionPoints needs two or four arguments"}var h=this.absoluteBounds();if(this.isPointIncluded(e,t,h)?(s=e,o=t):(a=e,r=t),this.isPointIncluded(i,n,h)?(s=i,o=n):(a=i,r=n),s&&o&&a&&r){for(var c,d,l=0,u=0;;){l=Math.min(s,a)+(Math.max(s,a)-Math.min(s,a))/2,u=Math.min(o,r)+(Math.max(o,r)-Math.min(o,r))/2;this.isPointIncluded(l,u,h)?(s=l,o=u):(a=l,r=u);var f=Math.sqrt(Math.pow(s-a,2)+Math.pow(o-r,2));if(c=s+(a-s)/f,d=o+(r-o)/f,!this.isPointIncluded(c,d,h))break}return{x:c,y:d}}},isPointIncluded:function(){return!1},containsNode:function(e){for(var t=this.node.firstChild.firstChild;e;){if(e==t)return!0;e=e.parentNode}return!1},isPointOverOffset:function(){return this.isPointIncluded.apply(this,arguments)},_dockerChanged:function(){},createDocker:function(e,t){var i=new ORYX.Core.Controls.Docker({eventHandlerCallback:this.eventHandlerCallback});return i.bounds.registerCallback(this._dockerChangedCallback),t&&i.bounds.centerMoveTo(t),this.add(i,e),i},serialize:function(){var t=arguments.callee.$.serialize.apply(this);return t.push({name:"bounds",prefix:"oryx",value:this.bounds.serializeForERDF(),type:"literal"}),this.getOutgoingShapes().each(function(e){t.push({name:"outgoing",prefix:"raziel",value:"#"+ERDF.__stripHashes(e.resourceId),type:"resource"})}.bind(this)),t.push({name:"parent",prefix:"raziel",value:"#"+ERDF.__stripHashes(this.parent.resourceId),type:"resource"}),t},deserialize:function(e,t){arguments.callee.$.deserialize.apply(this,arguments);var i=e.find(function(e){return"oryx-bounds"==e.prefix+"-"+e.name});if(i){var n=i.value.replace(/,/g," ").split(" ").without("");this instanceof ORYX.Core.Edge?(this.dockers.first().isChanged||this.dockers.first().bounds.centerMoveTo(parseFloat(n[0]),parseFloat(n[1])),this.dockers.last().isChanged||this.dockers.last().bounds.centerMoveTo(parseFloat(n[2]),parseFloat(n[3]))):this.bounds.set(parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]))}t&&t.labels instanceof Array&&t.labels.each(function(e){var t=this.getLabel(e.ref);t&&t.deserialize(e,this)}.bind(this))},toJSON:function(){var e=arguments.callee.$.toJSON.apply(this,arguments),i=[],n=this.id;return this._labels.each(function(e){var t=e.value.serialize();t&&(t.ref=e.key.replace(n,""),i.push(t))}),0<i.length&&(e.labels=i),e},_init:function(e){this._adjustIds(e,0)},_adjustIds:function(e,t){if(e instanceof Element){var i=e.getAttributeNS(null,"id");i&&""!==i?e.setAttributeNS(null,"id",this.id+i):(e.setAttributeNS(null,"id",this.id+"_"+this.id+"_"+t),t++);var n=e.getAttributeNS(null,"fill");if(n&&n.include("url(#")&&(n=n.replace(/url\(#/g,"url(#"+this.id),e.setAttributeNS(null,"fill",n)),e.hasChildNodes())for(var s=0;s<e.childNodes.length;s++)t=this._adjustIds(e.childNodes[s],t)}return t},toString:function(){return"ORYX.Core.Shape "+this.getId()}},ORYX.Core.Shape=ORYX.Core.AbstractShape.extend(ORYX.Core.Shape),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Controls||(ORYX.Core.Controls={}),ORYX.Core.Controls.Control=ORYX.Core.UIObject.extend({toString:function(){return"Control "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Controls||(ORYX.Core.Controls={}),ORYX.Core.Controls.Docker=ORYX.Core.Controls.Control.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.isMovable=!0,this.bounds.set(0,0,16,16),this.referencePoint=void 0,this._dockedShapeBounds=void 0,this._dockedShape=void 0,this._oldRefPoint1=void 0,this._oldRefPoint2=void 0,this.anchorLeft,this.anchorRight,this.anchorTop,this.anchorBottom,this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["g"]),this._dockerNode=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["g",{"pointer-events":"all"},["circle",{cx:"8",cy:"8",r:"8",stroke:"none",fill:"none"}],["circle",{cx:"8",cy:"8",r:"3",stroke:"black",fill:"red","stroke-width":"1"}]]),this._referencePointNode=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["g",{"pointer-events":"none"},["circle",{cx:this.bounds.upperLeft().x,cy:this.bounds.upperLeft().y,r:3,fill:"red","fill-opacity":.4}]]),this.hide(),this.addEventHandlers(this._dockerNode),this._updateCallback=this._changed.bind(this)},update:function(){if(this._dockedShape){if(this._dockedShapeBounds&&this._dockedShape instanceof ORYX.Core.Node){var e=this._dockedShapeBounds.width(),t=this._dockedShapeBounds.height();e||(e=1),t||(t=1);var i=this._dockedShape.bounds.width()/e,n=this._dockedShape.bounds.height()/t;1===i&&1===n||(this.referencePoint.x*=i,this.referencePoint.y*=n),this._dockedShapeBounds=this._dockedShape.bounds.clone()}var s=this.parent.dockers.indexOf(this),o=1<this.parent.dockers.length?0===s?this.parent.dockers[s+1]:this.parent.dockers[s-1]:void 0,a=this.getDockedShape()?this.getAbsoluteReferencePoint():this.bounds.center(),r=o&&o.getDockedShape()?o.getAbsoluteReferencePoint():o?o.bounds.center():void 0;if(!r){var h=this._dockedShape.absoluteCenterXY(),c=this._dockedShape.bounds.width()*this._dockedShape.bounds.height();r={x:a.x+(h.x-a.x)*-c,y:a.y+(h.y-a.y)*-c}}var d=void 0;if((d=this._dockedShape.getIntersectionPoint(a,r))||(d=this.getAbsoluteReferencePoint()),this.parent&&this.parent.parent){var l=this.parent.parent.absoluteXY();d.x-=l.x,d.y-=l.y}this.bounds.centerMoveTo(d),this._oldRefPoint1=a,this._oldRefPoint2=r}arguments.callee.$.update.apply(this,arguments)},refresh:function(){arguments.callee.$.refresh.apply(this,arguments);var e,t=this.bounds.upperLeft();(this._dockerNode.setAttributeNS(null,"transform","translate("+t.x+", "+t.y+")"),(t=Object.clone(this.referencePoint))&&this._dockedShape)?(e=this.parent instanceof ORYX.Core.Edge?this._dockedShape.absoluteXY():this._dockedShape.bounds.upperLeft(),t.x+=e.x,t.y+=e.y):t=this.bounds.center();this._referencePointNode.setAttributeNS(null,"transform","translate("+t.x+", "+t.y+")")},setReferencePoint:function(e){this.referencePoint===e||this.referencePoint&&e&&this.referencePoint.x===e.x&&this.referencePoint.y===e.y||(this.referencePoint=e,this._changed())},getAbsoluteReferencePoint:function(){if(this.referencePoint&&this._dockedShape){var e=this._dockedShape.absoluteXY();return{x:this.referencePoint.x+e.x,y:this.referencePoint.y+e.y}}},setDockedShape:function(e){this._dockedShape&&(this._dockedShape.bounds.unregisterCallback(this._updateCallback),this===this.parent.dockers.first()?(this.parent.incoming=this.parent.incoming.without(this._dockedShape),this._dockedShape.outgoing=this._dockedShape.outgoing.without(this.parent)):this===this.parent.dockers.last()&&(this.parent.outgoing=this.parent.outgoing.without(this._dockedShape),this._dockedShape.incoming=this._dockedShape.incoming.without(this.parent))),this._dockedShape=e;var t=this._dockedShapeBounds=void 0;if(this._dockedShape){this===this.parent.dockers.first()?(this.parent.incoming.push(e),e.outgoing.push(this.parent)):this===this.parent.dockers.last()&&(this.parent.outgoing.push(e),e.incoming.push(this.parent));var i=this.bounds,n=e.absoluteXY();t={x:i.center().x-n.x,y:i.center().y-n.y},this._dockedShapeBounds=this._dockedShape.bounds.clone(),this._dockedShape.bounds.registerCallback(this._updateCallback),this.setDockerColor(ORYX.CONFIG.DOCKER_DOCKED_COLOR)}else this.setDockerColor(ORYX.CONFIG.DOCKER_UNDOCKED_COLOR);this.setReferencePoint(t),this._changed()},getDockedShape:function(){return this._dockedShape},isDocked:function(){return!!this._dockedShape},setDockerColor:function(e){this._dockerNode.lastChild.setAttributeNS(null,"fill",e)},preventHiding:function(e){this._preventHiding=Math.max(0,(this._preventHiding||0)+(e?1:-1))},hide:function(){if(this._preventHiding)return!1;this.node.setAttributeNS(null,"visibility","hidden"),this._referencePointNode.setAttributeNS(null,"visibility","hidden"),this.children.each(function(e){e.hide()})},show:function(){this.node.setAttributeNS(null,"visibility","visible"),this.getDockedShape()instanceof ORYX.Core.Edge?this._referencePointNode.setAttributeNS(null,"visibility","hidden"):this._referencePointNode.setAttributeNS(null,"visibility","visible"),this.children.each(function(e){e.show()})},toString:function(){return"Docker "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Controls||(ORYX.Core.Controls={}),ORYX.Core.Controls.Magnet=ORYX.Core.Controls.Control.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.anchorLeft,this.anchorRight,this.anchorTop,this.anchorBottom,this.bounds.set(0,0,16,16),this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["g",{"pointer-events":"all"},["circle",{cx:"8",cy:"8",r:"4",stroke:"none",fill:"red","fill-opacity":"0.3"}]]),this.hide()},update:function(){arguments.callee.$.update.apply(this,arguments)},_update:function(){arguments.callee.$.update.apply(this,arguments)},refresh:function(){arguments.callee.$.refresh.apply(this,arguments);var e=this.bounds.upperLeft();this.node.setAttributeNS(null,"transform","translate("+e.x+", "+e.y+")")},show:function(){arguments.callee.$.show.apply(this,arguments)},toString:function(){return"Magnet "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Node={construct:function(e,t,i){arguments.callee.$.construct.apply(this,arguments),this.isSelectable=!0,this.isMovable=!0,this._dockerUpdated=!1,this.facade=i,this._oldBounds=new ORYX.Core.Bounds,this._svgShapes=[],this.minimumSize=void 0,this.maximumSize=void 0,this.isHorizontallyResizable=!1,this.isVerticallyResizable=!1,this.dataId=void 0,this._init(this._stencil.view()),this.forcedHeight=-1},_update:function(){if(this.dockers.invoke("update"),this.isChanged){var s=this.bounds,o=this._oldBounds;if(this.isResized){var a=s.width()/o.width(),r=s.height()/o.height();this._svgShapes.each(function(e){var t;e.isHorizontallyResizable&&(e.width=e.oldWidth*a),e.isVerticallyResizable&&(e.height=e.oldHeight*r);var i=e.anchorLeft;e.anchorRight?(t=o.width()-(e.oldX+e.oldWidth),i?e.width=s.width()-e.x-t:e.x=s.width()-(t+e.width)):i||(e.x=a*e.oldX,e.isHorizontallyResizable||(e.x=e.x+e.width*a/2-e.width/2));var n=e.anchorTop;e.anchorBottom?(t=o.height()-(e.oldY+e.oldHeight),n?e.height=s.height()-e.y-t:e._isYLocked||(e.y=s.height()-(t+e.height))):n||(e.y=r*e.oldY,e.isVerticallyResizable||(e.y=e.y+e.height*r/2-e.height/2))});var e,t,i={x:0,y:0};this.isHorizontallyResizable||s.width()===o.width()||(i.x=o.width()-s.width()),this.isVerticallyResizable||s.height()===o.height()||(i.y=o.height()-s.height()),0===i.x&&0===i.y||s.extend(i),i={x:0,y:0},this.minimumSize&&(ORYX.Log.debug("Shape (%0)'s min size: (%1x%2)",this,this.minimumSize.width,this.minimumSize.height),0<(e=this.minimumSize.width-s.width())&&(i.x+=e),0<(t=this.minimumSize.height-s.height())&&(i.y+=t)),this.maximumSize&&(ORYX.Log.debug("Shape (%0)'s max size: (%1x%2)",this,this.maximumSize.width,this.maximumSize.height),0<(e=s.width()-this.maximumSize.width)&&(i.x-=e),0<(t=s.height()-this.maximumSize.height)&&(i.y-=t)),0===i.x&&0===i.y||s.extend(i);var n,h,c,d,l,u,f;a=s.width()/o.width(),r=s.height()/o.height();this.magnets.each(function(e){n=e.anchorLeft,h=e.anchorRight,c=e.anchorTop,d=e.anchorBottom,l=e.bounds.center(),u=n?l.x:h?s.width()-(o.width()-l.x):l.x*a,f=c?l.y:d?s.height()-(o.height()-l.y):l.y*r,l.x===u&&l.y===f||e.bounds.centerMoveTo(u,f)}),this.getLabels().each(function(e){e.isAnchorLeft()||(e.isAnchorRight()?e.setX(s.width()-(o.width()-e.oldX)):e.setX((e.position?e.position.x:e.x)*a)),e.isAnchorTop()||(e.isAnchorBottom()?e.setY(s.height()-(o.height()-e.oldY)):e.setY((e.position?e.position.y:e.y)*r)),e.position&&(e.isOriginAnchorLeft()||(e.isOriginAnchorRight()?e.setOriginX(s.width()-(o.width()-e.oldX)):e.setOriginX(e.x*a)),e.isOriginAnchorTop()||(e.isOriginAnchorBottom()?e.setOriginY(s.height()-(o.height()-e.oldY)):e.setOriginY(e.y*r)))});var g=this.dockers[0];g&&(g.bounds.unregisterCallback(this._dockerChangedCallback),this._dockerUpdated||(g.bounds.centerMoveTo(this.bounds.center()),this._dockerUpdated=!1),g.update(),g.bounds.registerCallback(this._dockerChangedCallback)),this.isResized=!1}this.refresh(),this.isChanged=!1,this._oldBounds=this.bounds.clone()}this.children.each(function(e){e instanceof ORYX.Core.Controls.Docker||e._update()}),0<this.dockers.length&&!this.dockers.first().getDockedShape()&&this.dockers.each(function(e){e.bounds.centerMoveTo(this.bounds.center())}.bind(this))},refresh:function(){arguments.callee.$.refresh.apply(this,arguments);var e=this.bounds.upperLeft().x,t=this.bounds.upperLeft().y;this.node.firstChild.setAttributeNS(null,"transform","translate("+e+", "+t+")"),this.node.childNodes[1].childNodes[1].setAttributeNS(null,"transform","translate("+e+", "+t+")"),this._svgShapes.each(function(e){e.update()})},_dockerChanged:function(){var e=this.dockers[0];this.bounds.centerMoveTo(e.bounds.center()),this._dockerUpdated=!0},_initSVGShapes:function(e){var t=[];try{var i=new ORYX.Core.SVG.SVGShape(e);t.push(i)}catch(e){}if(e.hasChildNodes())for(var n=0;n<e.childNodes.length;n++)t=t.concat(this._initSVGShapes(e.childNodes[n]));return t},isPointIncluded:function(e,t,i){var n=i&&i instanceof ORYX.Core.Bounds?i:this.absoluteBounds();if(!n.isIncluded(e,t))return!1;var s=n.upperLeft(),o=e-s.x,a=t-s.y,r=0;do{var h=this._svgShapes[r++].isPointIncluded(o,a)}while(!h&&r<this._svgShapes.length);return h},isPointOverOffset:function(e,t){if(arguments.callee.$.isPointOverOffset.apply(this,arguments)){var i=this.absoluteBounds();if(i.widen(-ORYX.CONFIG.BORDER_OFFSET),!i.isIncluded(e,t))return!0}return!1},serialize:function(){var i=arguments.callee.$.serialize.apply(this);this.dockers.each(function(e){if(e.getDockedShape()){var t=e.referencePoint;t=t||e.bounds.center(),i.push({name:"docker",prefix:"oryx",value:$H(t).values().join(","),type:"literal"})}}.bind(this));try{var e=this.getStencil().serialize();e.type&&(e.shape=this,e.data=i,e.result=void 0,e.forceExecution=!0,this._delegateEvent(e),e.result&&(i=e.result))}catch(e){}return i},deserialize:function(e){arguments.callee.$.deserialize.apply(this,arguments);try{var t=this.getStencil().deserialize();t.type&&(t.shape=this,t.data=e,t.result=void 0,t.forceExecution=!0,this._delegateEvent(t),t.result&&(e=t.result))}catch(e){}var i;if((e.findAll(function(e){return e.prefix+"-"+e.name=="raziel-outgoing"}).each(function(e){if(this.parent){var t=this.getCanvas().getChildShapeByResourceId(e.value);t&&(t instanceof ORYX.Core.Edge?(t.dockers.first().setDockedShape(this),t.dockers.first().setReferencePoint(t.dockers.first().bounds.center())):0<t.dockers.length&&t.dockers.first().setDockedShape(this))}}.bind(this)),1===this.dockers.length)&&(i=e.find(function(e){return e.prefix+"-"+e.name=="oryx-dockers"}))){var n=i.value.replace(/,/g," ").split(" ").without("").without("#");2===n.length&&this.dockers[0].getDockedShape()?this.dockers[0].setReferencePoint({x:parseFloat(n[0]),y:parseFloat(n[1])}):this.dockers[0].bounds.centerMoveTo(parseFloat(n[0]),parseFloat(n[1]))}},_init:function(e){arguments.callee.$._init.apply(this,arguments);var t=e.getElementsByTagName("g")[0],i=e.ownerDocument.createAttribute("title");i.nodeValue=this.getStencil().title(),t.setAttributeNode(i);var n=e.ownerDocument.createAttribute("id");n.nodeValue=this.id,t.setAttributeNode(n),t=this.node.childNodes[0].childNodes[0].appendChild(t),this.addEventHandlers(t.parentNode);var s=t.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"minimumSize");if(s){var o=(s=s.replace("/,/g"," ")).split(" ");1<(o=o.without("")).length?this.minimumSize={width:parseFloat(o[0]),height:parseFloat(o[1])}:this.minimumSize={width:1,height:1}}var a=t.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"maximumSize");if(a){var r=(a=a.replace("/,/g"," ")).split(" ");1<(r=r.without("")).length&&(this.maximumSize={width:parseFloat(r[0]),height:parseFloat(r[1])})}if(this.minimumSize&&this.maximumSize&&(this.minimumSize.width>this.maximumSize.width||this.minimumSize.height>this.maximumSize.height))throw this+": Minimum Size must be greater than maxiumSize.";this._svgShapes=this._initSVGShapes(t);var h={x:void 0,y:void 0},c={x:void 0,y:void 0},d=this;this._svgShapes.each(function(e){h.x=void 0!==h.x?Math.min(h.x,e.x):e.x,h.y=void 0!==h.y?Math.min(h.y,e.y):e.y,c.x=void 0!==c.x?Math.max(c.x,e.x+e.width):e.x+e.width,c.y=void 0!==c.y?Math.max(c.y,e.y+e.height):e.y+e.height,e.isHorizontallyResizable&&(d.isHorizontallyResizable=!0,d.isResizable=!0),e.isVerticallyResizable&&(d.isVerticallyResizable=!0,d.isResizable=!0),e.anchorTop&&e.anchorBottom&&(d.isVerticallyResizable=!0,d.isResizable=!0),e.anchorLeft&&e.anchorRight&&(d.isHorizontallyResizable=!0,d.isResizable=!0)}),this._svgShapes.each(function(e){e.x-=h.x,e.y-=h.y,e.update()});var l=h.x,u=h.y;c.x-=l,c.y-=u,h.x=0,(h.y=0)===c.x&&(c.x=1),0===c.y&&(c.y=1),this._oldBounds.set(h,c),this.bounds.set(h,c);var f=e.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_ORYX,"magnets");if(f&&0<f.length){f=$A(f[0].getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_ORYX,"magnet"));d=this;f.each(function(e){var t=new ORYX.Core.Controls.Magnet({eventHandlerCallback:d.eventHandlerCallback}),i=parseFloat(e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cx")),n=parseFloat(e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cy"));t.bounds.centerMoveTo({x:i-l,y:n-u});var s=e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"anchors");if(s){s=(s=s.replace("/,/g"," ")).split(" ").without("");for(var o=0;o<s.length;o++)switch(s[o].toLowerCase()){case"left":t.anchorLeft=!0;break;case"right":t.anchorRight=!0;break;case"top":t.anchorTop=!0;break;case"bottom":t.anchorBottom=!0}}if(d.add(t),!this._defaultMagnet){var a=e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"default");a&&"yes"===a.toLowerCase()&&(d._defaultMagnet=t)}})}else{var g=new ORYX.Core.Controls.Magnet;g.bounds.centerMoveTo(this.bounds.width()/2,this.bounds.height()/2),this.add(g)}var p=e.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_ORYX,"docker");if(p&&0<p.length){p=p[0];var O=this.createDocker(),R=parseFloat(p.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cx")),S=parseFloat(p.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cy"));O.bounds.centerMoveTo({x:R-l,y:S-u});var m=p.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"anchors");if(m){m=(m=m.replace("/,/g"," ")).split(" ").without("");for(var v=0;v<m.length;v++)switch(m[v].toLowerCase()){case"left":O.anchorLeft=!0;break;case"right":O.anchorRight=!0;break;case"top":O.anchorTop=!0;break;case"bottom":O.anchorBottom=!0}}}var E=t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"text");$A(E).each(function(e){var t=new ORYX.Core.SVG.Label({textElement:e,shapeId:this.id});t.x-=l,t.y-=u,(this._labels[t.id]=t).registerOnChange(this.layout.bind(this)),0==this._stencil.id().indexOf(ORYX.CONFIG.FORM_ELEMENT_ID_PREFIX)&&t.registerOnChange(this.fitToLabels.bind(this))}.bind(this))},fitToLabels:function(){var i=0;this.getLabels().each(function(e){var t=e.getY()+e.getHeight();i<t&&(i=t)});var e=this.bounds,t=!1;if(this.minimumSize){var n=this.minimumSize.height;i<n&&e.height()>n&&n>this.forcedHeight?(e.set(e.upperLeft().x,e.upperLeft().y,e.lowerRight().x,e.upperLeft().y+n),t=!0):n<i&&e.height()!=i&&i>this.forcedHeight?(e.set(e.upperLeft().x,e.upperLeft().y,e.lowerRight().x,e.upperLeft().y+i),t=!0):e.height()>this.forcedHeight&&0<this.forcedHeight&&(e.set(e.upperLeft().x,e.upperLeft().y,e.lowerRight().x,e.upperLeft().y+this.forcedHeight),t=!0)}if(t&&(null!=this.facade.getCanvas()&&this.facade.getCanvas().update(),this.facade.getSelection().member(this))){var s=this.facade.getSelection();this.facade.setSelection([]),this.facade.setSelection(s)}},createDocker:function(){var e=new ORYX.Core.Controls.Docker({eventHandlerCallback:this.eventHandlerCallback});return e.bounds.registerCallback(this._dockerChangedCallback),this.dockers.push(e),e.parent=this,e.bounds.registerCallback(this._changedCallback),e},toString:function(){return this._stencil.title()+" "+this.id}},ORYX.Core.Node=ORYX.Core.Shape.extend(ORYX.Core.Node),NAMESPACE_SVG="http://www.w3.org/2000/svg",NAMESPACE_ORYX="http://www.b3mn.org/oryx",!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Edge={construct:function(e,t,i){arguments.callee.$.construct.apply(this,arguments),this.isMovable=!0,this.isSelectable=!0,this._dockerUpdated=!1,this._markers=new Hash,this._paths=[],this._interactionPaths=[],this._dockersByPath=new Hash,this._markersByPath=new Hash,this.attachedNodePositionData=new Hash;var n=this.node.childNodes[0].childNodes[0];n=ORYX.Editor.graft("http://www.w3.org/2000/svg",n,["g",{"pointer-events":"painted"}]),this.addEventHandlers(n.parentNode),this._oldBounds=this.bounds.clone(),this._init(this._stencil.view()),t instanceof Array&&this.deserialize(t)},_update:function(e){if(this._dockerUpdated||this.isChanged||e){this.dockers.invoke("update");var n=this.bounds.upperLeft(),t=this._oldBounds.upperLeft(),i=0===this._oldBounds.width()?this.bounds.width():this._oldBounds.width(),s=0===this._oldBounds.height()?this.bounds.height():this._oldBounds.height(),b=n.x-t.x,C=n.y-t.y,_=this.bounds.width()/i||1,N=this.bounds.height()/s||1;if(this.dockers.each(function(e){if(e.bounds.unregisterCallback(this._dockerChangedCallback),!this._dockerUpdated&&(e.bounds.moveBy(b,C),1!==_||1!==N)){var t=e.bounds.upperLeft().x-n.x,i=e.bounds.upperLeft().y-n.y;e.bounds.moveTo(n.x+t*_,n.y+i*N)}e.update(),e.bounds.registerCallback(this._dockerChangedCallback)}.bind(this)),this._dockerUpdated){var o=this.dockers.first().bounds.center(),a=this.dockers.first().bounds.center();this.dockers.each(function(e){var t=e.bounds.center();o.x=Math.min(o.x,t.x),o.y=Math.min(o.y,t.y),a.x=Math.max(a.x,t.x),a.y=Math.max(a.y,t.y)}.bind(this)),this.bounds.set(Object.clone(o),Object.clone(a))}n=this.bounds.upperLeft(),t=this._oldBounds.upperLeft(),_=this.bounds.width()/(i||this.bounds.width()),N=this.bounds.height()/(s||this.bounds.height()),b=n.x-t.x,C=n.y-t.y,this.getLabels().each(function(e){if(e.getReferencePoint()){var t=e.getReferencePoint(),i=t.segment.from,n=t.segment.to;if(!(i&&i.parent&&n&&n.parent))return;var s=i.bounds.center(),o=n.bounds.center();if(s.x===t.segment.fromPosition.x&&s.y===t.segment.fromPosition.y&&o.x===t.segment.toPosition.x&&o.y===t.segment.toPosition.y&&!t.dirty)return;if(this.parent.initializingShapes){(h=ORYX.Core.Math.getOrthogonalIdentityVector(s,o)).x*=t.distance,h.y*=t.distance,h.x+=t.intersection.x,h.y+=t.intersection.y,e.setX(h.x),e.setY(h.y),t.segment.fromPosition=s,t.segment.toPosition=o}else{var a=ORYX.Core.Math.getDistanceBetweenTwoPoints(t.segment.fromPosition,t.segment.toPosition,t.intersection),r=ORYX.Core.Math.getPointBetweenTwoPoints(s,o,isNaN(a)?.5:a),h=ORYX.Core.Math.getOrthogonalIdentityVector(s,o),c=1===Math.abs(h.y),d=1===Math.abs(h.x);h.x*=t.distance,h.y*=t.distance,h.x+=r.x,h.y+=r.y;var l=c&&t.orientation&&(t.iorientation||t.orientation).endsWith("r")?-e.getWidth():0,u=d&&t.orientation&&(t.iorientation||t.orientation).startsWith("l")?2-e.getHeight():0;e.setX(h.x+l),e.setY(h.y+u),this.updateReferencePointOfLabel(e,r,i,n)}}else{if(e.position&&!this.parent.initializingShapes){var f=e.position.x+b*(_||1);f>this.bounds.lowerRight().x&&(f+=this.bounds.width()-this.bounds.width()/(_||1));var g=e.position.y+C*(N||1);return g>this.bounds.lowerRight().y&&(g+=this.bounds.height()-this.bounds.height()/(N||1)),e.setX(f),void e.setY(g)}switch(e.getEdgePosition()){case"starttop":var p=this._getAngle(this.dockers[0],this.dockers[1]),O=this.dockers.first().bounds.center();p<=90||270<p?(e.horizontalAlign("left"),e.verticalAlign("bottom"),e.x=O.x+e.getOffsetTop(),e.y=O.y-e.getOffsetTop(),e.rotate(360-p,O)):(e.horizontalAlign("right"),e.verticalAlign("bottom"),e.x=O.x-e.getOffsetTop(),e.y=O.y-e.getOffsetTop(),e.rotate(180-p,O));break;case"startmiddle":p=this._getAngle(this.dockers[0],this.dockers[1]),O=this.dockers.first().bounds.center();p<=90||270<p?(e.horizontalAlign("left"),e.verticalAlign("bottom"),e.x=O.x+2,e.y=O.y+4,e.rotate(360-p,O)):(e.horizontalAlign("right"),e.verticalAlign("bottom"),e.x=O.x+1,e.y=O.y+4,e.rotate(180-p,O));break;case"startbottom":p=this._getAngle(this.dockers[0],this.dockers[1]),O=this.dockers.first().bounds.center();p<=90||270<p?(e.horizontalAlign("left"),e.verticalAlign("top"),e.x=O.x+e.getOffsetBottom(),e.y=O.y+e.getOffsetBottom(),e.rotate(360-p,O)):(e.horizontalAlign("right"),e.verticalAlign("top"),e.x=O.x-e.getOffsetBottom(),e.y=O.y+e.getOffsetBottom(),e.rotate(180-p,O));break;case"midtop":if((v=this.dockers.length)%2==0){p=this._getAngle(this.dockers[v/2-1],this.dockers[v/2]);var R=this.dockers[v/2-1].bounds.center(),S=this.dockers[v/2].bounds.center();O={x:(R.x+S.x)/2,y:(R.y+S.y)/2};e.horizontalAlign("center"),e.verticalAlign("bottom"),e.x=O.x,e.y=O.y-e.getOffsetTop(),p<=90||270<p?e.rotate(360-p,O):e.rotate(180-p,O)}else{var m=parseInt(v/2);p=this._getAngle(this.dockers[m],this.dockers[m+1]),O=this.dockers[m].bounds.center();p<=90||270<p?(e.horizontalAlign("left"),e.verticalAlign("bottom"),e.x=O.x+e.getOffsetTop(),e.y=O.y-e.getOffsetTop(),e.rotate(360-p,O)):(e.horizontalAlign("right"),e.verticalAlign("bottom"),e.x=O.x-e.getOffsetTop(),e.y=O.y-e.getOffsetTop(),e.rotate(180-p,O))}break;case"midbottom":var v;if((v=this.dockers.length)%2==0){p=this._getAngle(this.dockers[v/2-1],this.dockers[v/2]),R=this.dockers[v/2-1].bounds.center(),S=this.dockers[v/2].bounds.center(),O={x:(R.x+S.x)/2,y:(R.y+S.y)/2};e.horizontalAlign("center"),e.verticalAlign("top"),e.x=O.x,e.y=O.y+e.getOffsetTop(),p<=90||270<p?e.rotate(360-p,O):e.rotate(180-p,O)}else{m=parseInt(v/2),p=this._getAngle(this.dockers[m],this.dockers[m+1]),O=this.dockers[m].bounds.center();p<=90||270<p?(e.horizontalAlign("left"),e.verticalAlign("top"),e.x=O.x+e.getOffsetBottom(),e.y=O.y+e.getOffsetBottom(),e.rotate(360-p,O)):(e.horizontalAlign("right"),e.verticalAlign("top"),e.x=O.x-e.getOffsetBottom(),e.y=O.y+e.getOffsetBottom(),e.rotate(180-p,O))}break;case"endtop":var E=this.dockers.length;p=this._getAngle(this.dockers[E-2],this.dockers[E-1]),O=this.dockers.last().bounds.center();p<=90||270<p?(e.horizontalAlign("right"),e.verticalAlign("bottom"),e.x=O.x-e.getOffsetTop(),e.y=O.y-e.getOffsetTop(),e.rotate(360-p,O)):(e.horizontalAlign("left"),e.verticalAlign("bottom"),e.x=O.x+e.getOffsetTop(),e.y=O.y-e.getOffsetTop(),e.rotate(180-p,O));break;case"endbottom":E=this.dockers.length,p=this._getAngle(this.dockers[E-2],this.dockers[E-1]),O=this.dockers.last().bounds.center();p<=90||270<p?(e.horizontalAlign("right"),e.verticalAlign("top"),e.x=O.x-e.getOffsetBottom(),e.y=O.y+e.getOffsetBottom(),e.rotate(360-p,O)):(e.horizontalAlign("left"),e.verticalAlign("top"),e.x=O.x+e.getOffsetBottom(),e.y=O.y+e.getOffsetBottom(),e.rotate(180-p,O))}}}.bind(this)),this.children.each(function(e){e instanceof ORYX.Core.Node&&this.calculatePositionOfAttachedChildNode.call(this,e)}.bind(this)),this.refreshAttachedNodes(),this.refresh(),this.isChanged=!1,this._dockerUpdated=!1,this._oldBounds=this.bounds.clone()}var r=navigator.userAgent;(-1!==navigator.appVersion.indexOf("MSIE 10")||-1!==r.indexOf("Trident")&&-1!==r.indexOf("rv:11"))&&this.node.parentNode.insertBefore(this.node,this.node)},movePointToUpperLeftOfNode:function(e,t){e.x-=t.width()/2,e.y-=t.height()/2},refreshAttachedNodes:function(){this.attachedNodePositionData.values().each(function(e){var t=e.segment.docker1.bounds.center(),i=e.segment.docker2.bounds.center();this.relativizePoint(t),this.relativizePoint(i);var n=new Object;n.x=t.x+e.relativDistanceFromDocker1*(i.x-t.x),n.y=t.y+e.relativDistanceFromDocker1*(i.y-t.y),this.movePointToUpperLeftOfNode(n,e.node.bounds),e.node.bounds.moveTo(n),e.node._update()}.bind(this))},calculatePositionOfAttachedChildNode:function(e){var t=new Object;t.x=0,t.y=0,this.attachedNodePositionData[e.getId()]?e.isChanged&&this.findEdgeSegmentForNode(e):(this.attachedNodePositionData[e.getId()]=new Object,this.attachedNodePositionData[e.getId()].relativDistanceFromDocker1=0,this.attachedNodePositionData[e.getId()].node=e,this.attachedNodePositionData[e.getId()].segment=new Object,this.findEdgeSegmentForNode(e))},findEdgeSegmentForNode:function(e){var t=this.dockers.length,n=void 0;for(i=1;i<t;i++){var s=this.dockers[i-1].bounds.center(),o=this.dockers[i].bounds.center();this.relativizePoint(s),this.relativizePoint(o);var a=e.bounds.center(),r=ORYX.Core.Math.distancePointLinie(s,o,a,!0);(r||0==r)&&(!n&&0!=n||r<n)&&(n=r,this.attachedNodePositionData[e.getId()].segment.docker1=this.dockers[i-1],this.attachedNodePositionData[e.getId()].segment.docker2=this.dockers[i]),r||n||0==n||(ORYX.Core.Math.getDistancePointToPoint(a,s)<ORYX.Core.Math.getDistancePointToPoint(a,o)?this.attachedNodePositionData[e.getId()].relativDistanceFromDocker1=0:this.attachedNodePositionData[e.getId()].relativDistanceFromDocker1=1,this.attachedNodePositionData[e.getId()].segment.docker1=this.dockers[i-1],this.attachedNodePositionData[e.getId()].segment.docker2=this.dockers[i])}(n||0==n)&&(this.attachedNodePositionData[e.getId()].relativDistanceFromDocker1=this.getLineParameterForPosition(this.attachedNodePositionData[e.getId()].segment.docker1,this.attachedNodePositionData[e.getId()].segment.docker2,e))},findSegment:function(e){var t,n=this.dockers.length,s=e instanceof ORYX.Core.UIObject?e.bounds.center():e;for(i=1;i<n;i++){var o=this.dockers[i-1].bounds.center(),a=this.dockers[i].bounds.center(),r=ORYX.Core.Math.distancePointLinie(o,a,s,!0);"number"==typeof r&&(void 0===t||r<t.distance)&&(t={distance:r,fromDocker:this.dockers[i-1],toDocker:this.dockers[i]})}return t},getLineParameterForPosition:function(e,t,i){var n=e.bounds.center(),s=t.bounds.center();this.relativizePoint(n),this.relativizePoint(s);var o=ORYX.Core.Math.getPointOfIntersectionPointLine(n,s,i.bounds.center(),!0);return o?ORYX.Core.Math.getDistancePointToPoint(o,n)/ORYX.Core.Math.getDistancePointToPoint(n,s):0},relativizePoint:function(e){e.x-=this.bounds.upperLeft().x,e.y-=this.bounds.upperLeft().y},optimizedUpdate:function(){var e=function(e){if(e._dockedShape&&e._dockedShapeBounds){var t={x:e._dockedShape.bounds.a.x-e._dockedShapeBounds.a.x,y:e._dockedShape.bounds.a.y-e._dockedShapeBounds.a.y};e.bounds.moveBy(t),e._dockedShapeBounds.moveBy(t)}};e(this.dockers.first()),e(this.dockers.last()),this.refresh()},refresh:function(){var a;if(arguments.callee.$.refresh.apply(this,arguments),this._paths.each(function(e,t){var i=this._dockersByPath[e.id],n=void 0,s=void 0;a?s="M"+a.x+" "+a.y:(n=i[0].bounds.center(),s="M"+(a=n).x+" "+n.y);for(var o=1;o<i.length;o++)s=s+"L"+(n=i[o].bounds.center()).x+" "+n.y+" ",a=n;e.setAttributeNS(null,"d",s),this._interactionPaths[t].setAttributeNS(null,"d",s)}.bind(this)),0<this.getChildNodes().length){var e=this.bounds.upperLeft().x,t=this.bounds.upperLeft().y;this.node.firstChild.childNodes[1].setAttributeNS(null,"transform","translate("+e+", "+t+")")}},getIntersectionPoint:function(){var e=Math.floor(this.dockers.length/2);return ORYX.Core.Math.midPoint(this.dockers[e-1].bounds.center(),this.dockers[e].bounds.center())},isBoundsIncluded:function(s){var o=this.dockers,a=o.length;return o.any(function(e,t){if(t==a-1)return!1;var i=e.bounds.center(),n=o[t+1].bounds.center();return ORYX.Core.Math.isRectOverLine(i.x,i.y,n.x,n.y,s.a.x,s.a.y,s.b.x,s.b.y)})},isPointIncluded:function(e,t){var i=void 0;if(this.absoluteBounds().isIncluded(e,t,ORYX.CONFIG.OFFSET_EDGE_BOUNDS)&&0<this.dockers.length)for(var n,s,o=0;n=this.dockers[o].bounds.center(),s=this.dockers[++o].bounds.center(),!(i=ORYX.Core.Math.isPointInLine(e,t,n.x,n.y,s.x,s.y,ORYX.CONFIG.OFFSET_EDGE_BOUNDS))&&o<this.dockers.length-1;);return i},isPointOverOffset:function(){return!1},containsNode:function(e){return!(!this._paths.include(e)&&!this._interactionPaths.include(e))},_getAngle:function(e,t){var i=e instanceof ORYX.Core.Controls.Docker?e.absoluteCenterXY():e,n=t instanceof ORYX.Core.Controls.Docker?t.absoluteCenterXY():t;return ORYX.Core.Math.getAngle(i,n)},alignDockers:function(){this._update(!0);var n=this.dockers.first().bounds.center(),e=this.dockers.last().bounds.center(),s=e.x-n.x,o=e.y-n.y,a=this.dockers.length-1;this.dockers.each(function(e,t){var i=t/a;e.bounds.unregisterCallback(this._dockerChangedCallback),e.bounds.moveTo(n.x+i*s,n.y+i*o),e.bounds.registerCallback(this._dockerChangedCallback)}.bind(this)),this._dockerChanged()},add:function(e){if(arguments.callee.$.add.apply(this,arguments),e instanceof ORYX.Core.Controls.Docker&&this.dockers.include(e)){var t=this._dockersByPath.values()[0];t&&t.splice(this.dockers.indexOf(e),0,e),this.handleChildShapesAfterAddDocker(e)}},handleChildShapesAfterAddDocker:function(r){if(!(!r instanceof ORYX.Core.Controls.Docker)){var e=this.dockers.indexOf(r);if(0<e&&e<this.dockers.length-1){var t=this.dockers[e-1],i=this.dockers[e+1],n=this.getAttachedNodePositionDataForSegment(t,i),s=ORYX.Core.Math.getDistancePointToPoint(t.bounds.center(),r.bounds.center()),o=ORYX.Core.Math.getDistancePointToPoint(i.bounds.center(),r.bounds.center());if(s+o){var a=s/(s+o);n.each(function(e){if(e.value.relativDistanceFromDocker1<a)e.value.segment.docker2=r,e.value.relativDistanceFromDocker1=e.value.relativDistanceFromDocker1/a;else{e.value.segment.docker1=r;var t=1-a,i=e.value.relativDistanceFromDocker1-a;e.value.relativDistanceFromDocker1=i/t}}),this.getLabels().each(function(e){var t=e.getReferencePoint();if(t){var i=this.dockers.indexOf(r);if(i>=t.segment.fromIndex&&i<=t.segment.toIndex){var n=this.findSegment(t.intersection);n||(n.fromDocker=t.segment.fromIndex>=this.dockers.length/2?this.dockers[0]:this.dockers[this.dockers.length-2],n.toDocker=this.dockers[this.dockers.indexOf(from)+1]);var s=n.fromDocker.bounds.center(),o=n.toDocker.bounds.center(),a=ORYX.Core.Math.getPointOfIntersectionPointLine(s,o,t.intersection,!0);this.updateReferencePointOfLabel(e,a,n.fromDocker,n.toDocker,!0)}}}.bind(this)),this.refreshAttachedNodes()}}}},getAttachedNodePositionDataForSegment:function(t,i){if(!(t instanceof ORYX.Core.Controls.Docker&&i instanceof ORYX.Core.Controls.Docker))return[];var e=this.attachedNodePositionData.findAll(function(e){return e.value.segment.docker1===t&&e.value.segment.docker2===i});return e||[]},remove:function(e){arguments.callee.$.remove.apply(this,arguments),this.attachedNodePositionData[e.getId()]&&delete this.attachedNodePositionData[e.getId()],e instanceof ORYX.Core.Controls.Docker&&this.handleChildShapesAfterRemoveDocker(e)},updateReferencePointOfLabel:function(e,t,i,n,s){if(e.getReferencePoint()&&e.isVisible){var o=e.getReferencePoint();if(o.orientation&&"ce"!==o.orientation){var a=this._getAngle(i,n);0<=o.distance?0==a?(e.horizontalAlign("left"),e.verticalAlign("bottom")):0<a&&a<90?(e.horizontalAlign("right"),e.verticalAlign("bottom")):90==a?(e.horizontalAlign("right"),e.verticalAlign("top")):90<a&&a<180?(e.horizontalAlign("right"),e.verticalAlign("top")):180==a?(e.horizontalAlign("left"),e.verticalAlign("top")):180<a&&a<270?(e.horizontalAlign("left"),e.verticalAlign("top")):270==a?(e.horizontalAlign("left"),e.verticalAlign("top")):270<a&&a<=360&&(e.horizontalAlign("left"),e.verticalAlign("bottom")):0==a?(e.horizontalAlign("left"),e.verticalAlign("top")):0<a&&a<90?(e.horizontalAlign("left"),e.verticalAlign("top")):90==a?(e.horizontalAlign("left"),e.verticalAlign("top")):90<a&&a<180?(e.horizontalAlign("left"),e.verticalAlign("bottom")):180==a?(e.horizontalAlign("left"),e.verticalAlign("bottom")):180<a&&a<270?(e.horizontalAlign("right"),e.verticalAlign("bottom")):270==a?(e.horizontalAlign("right"),e.verticalAlign("top")):270<a&&a<=360&&(e.horizontalAlign("right"),e.verticalAlign("top")),o.iorientation=o.iorientation||o.orientation,o.orientation=("top"==e.verticalAlign()?"u":"l")+("left"==e.horizontalAlign()?"l":"r")}e.setReferencePoint(jQuery.extend({},{intersection:t,segment:{from:i,fromIndex:this.dockers.indexOf(i),fromPosition:i.bounds.center(),to:n,toIndex:this.dockers.indexOf(n),toPosition:n.bounds.center()},dirty:s||!1},o))}},handleChildShapesAfterRemoveDocker:function(a){a instanceof ORYX.Core.Controls.Docker&&(this.attachedNodePositionData.each(function(e){if(e.value.segment.docker1===a){if(-1==(t=this.dockers.indexOf(e.value.segment.docker2)))return;e.value.segment.docker1=this.dockers[t-1]}else if(e.value.segment.docker2===a){var t;if(-1==(t=this.dockers.indexOf(e.value.segment.docker1)))return;e.value.segment.docker2=this.dockers[t+1]}}.bind(this)),this.getLabels().each(function(e){var t=e.getReferencePoint();if(t){var i=t.segment.from,n=t.segment.to;if(i===a||n===a){var s=this.findSegment(t.intersection);s?(i=i===a?this.dockers[this.dockers.indexOf(n)-1]:i,n=this.dockers[this.dockers.indexOf(i)+1]):(i=s.fromDocker,n=s.toDocker);var o=ORYX.Core.Math.getPointOfIntersectionPointLine(i.bounds.center(),n.bounds.center(),t.intersection,!0);this.updateReferencePointOfLabel(e,o,i,n,!0)}}}.bind(this)),this.refreshAttachedNodes())},addDocker:function(d,l){var u,f;return this._dockersByPath.any(function(c){return c.value.any(function(e,t){if(u){var i=u.bounds.center(),n=e.bounds.center(),s=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI))if(0<=navigator.userAgent.indexOf("MSIE")){var o=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==o&&(s=o/100)}if(1!==s&&(d.x=d.x/s,d.y=d.y/s),ORYX.Core.Math.isPointInLine(d.x,d.y,i.x,i.y,n.x,n.y,10)){var a=this._paths.find(function(e){return e.id===c.key});if(a){var r=a.getAttributeNS(NAMESPACE_ORYX,"allowDockers");if(r&&"no"===r.toLowerCase())return!0}var h=l||this.createDocker(this.dockers.indexOf(u)+1,d);return h.bounds.centerMoveTo(d),l&&this.add(h,this.dockers.indexOf(u)+1),f=h,!0}return u=e,!1}return u=e,!1}.bind(this))}.bind(this)),f},removeDocker:function(t){2<this.dockers.length&&this.dockers.first()!==t&&this._dockersByPath.any(function(e){return!!e.value.member(t)&&(t===e.value.last()||(this.remove(t),this._dockersByPath[e.key]=e.value.without(t),this.isChanged=!0,this._dockerChanged()),!0)}.bind(this))},removeUnusedDockers:function(){var r=$H({});return this.dockers.each(function(e,t){if(0!=t&&t!=this.dockers.length-1){var i=this.dockers[t-1];-1!=r.values().indexOf(i)&&this.dockers[t-2]&&(i=this.dockers[t-2]);var n=this.dockers[t+1],s=i.getDockedShape()&&i.referencePoint?i.getAbsoluteReferencePoint():i.bounds.center(),o=n.getDockedShape()&&n.referencePoint?n.getAbsoluteReferencePoint():n.bounds.center(),a=e.bounds.center();ORYX.Core.Math.isPointInLine(a.x,a.y,s.x,s.y,o.x,o.y,1)&&(r[t]=e)}}.bind(this)),r.each(function(e){this.removeDocker(e.value)}.bind(this)),0<r.values().length&&this._update(!0),r},_init:function(e){var g,p,O,R;arguments.callee.$._init.apply(this,arguments);var t=e.getElementsByTagNameNS(NAMESPACE_SVG,"defs");if(0<t.length){t=t[0];var i,n=$A(t.getElementsByTagNameNS(NAMESPACE_SVG,"marker")),s=this;n.each(function(e){try{var t;i=new ORYX.Core.SVG.SVGMarker(e.cloneNode(!0)),s._markers[i.id]=i,$A(i.element.getElementsByTagNameNS(NAMESPACE_SVG,"text")).each(function(e){t=new ORYX.Core.SVG.Label({textElement:e,shapeId:this.id}),s._labels[t.id]=t})}catch(e){}})}var o=e.getElementsByTagNameNS(NAMESPACE_SVG,"g");if(o.length<=0)throw"Edge: No g element found.";var a=o[0];a.setAttributeNS(null,"id",null);var S=!0;$A(a.childNodes).each(function(e,t){if(ORYX.Editor.checkClassType(e,SVGPathElement)){e=e.cloneNode(!1);var i=this.id+"_"+t;e.setAttributeNS(null,"id",i),this._paths.push(e);var n=[],s=e.getAttributeNS(null,"marker-start");if(s&&""!==s){s=(s=s.strip()).replace(/^url\(#/,"");var o=this.getValidMarkerId(s);e.setAttributeNS(null,"marker-start","url(#"+o+")"),n.push(this._markers[o])}if((s=e.getAttributeNS(null,"marker-mid"))&&""!==s){s=(s=s.strip()).replace(/^url\(#/,"");var a=this.getValidMarkerId(s);e.setAttributeNS(null,"marker-mid","url(#"+a+")"),n.push(this._markers[a])}if((s=e.getAttributeNS(null,"marker-end"))&&""!==s){s=s.strip();var r=this.getValidMarkerId(s);e.setAttributeNS(null,"marker-end","url(#"+r+")"),n.push(this._markers[r])}this._markersByPath[i]=n;var h=new PathParser,c=new ORYX.Core.SVG.PointsPathHandler;if(h.setHandler(c),h.parsePath(e),c.points.length<4)throw"Edge: Path has to have two or more points specified.";this._dockersByPath[i]=[];for(var d=0;d<c.points.length;d+=2){var l=c.points[d],u=c.points[d+1];if(S||0<d){var f=new ORYX.Core.Controls.Docker({eventHandlerCallback:this.eventHandlerCallback});f.bounds.centerMoveTo(l,u),f.bounds.registerCallback(this._dockerChangedCallback),this.add(f,this.dockers.length),g?(g=Math.min(l,g),p=Math.min(u,p)):(g=l,p=u),O?(O=Math.max(l,O),R=Math.max(u,R)):(O=l,R=u)}}S=!1}}.bind(this)),this.bounds.set(g,p,O,R),this._oldBounds=this.bounds.clone(),this._paths.reverse();var r=[];this._paths.each(function(e){r.push(this.node.childNodes[0].childNodes[0].childNodes[0].appendChild(e))}.bind(this)),this._paths=r,this._paths.each(function(e){var t=e.cloneNode(!1);t.setAttributeNS(null,"id",void 0),t.setAttributeNS(null,"stroke-width",10),t.setAttributeNS(null,"visibility","hidden"),t.setAttributeNS(null,"stroke-dasharray",null),t.setAttributeNS(null,"stroke","black"),t.setAttributeNS(null,"fill","none"),t.setAttributeNS(null,"title",this.getStencil().title()),this._interactionPaths.push(this.node.childNodes[0].childNodes[0].childNodes[0].appendChild(t))}.bind(this)),this._paths.reverse(),this._interactionPaths.reverse();var h=e.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"text");$A(h).each(function(e){var t=new ORYX.Core.SVG.Label({textElement:e,shapeId:this.id});this.node.childNodes[0].childNodes[0].appendChild(t.node),(this._labels[t.id]=t).registerOnChange(this.layout.bind(this))}.bind(this)),this.propertiesChanged.each(function(e){e.value=!0})},getValidMarkerId:function(e){if(0<=e.indexOf('url("#')){var t=e.replace(/^url\(\"#/,"").replace(/\"\)$/,"");return this.id+t}return e=e.replace(/^url\(#/,""),this.id.concat(e.replace(/\)$/,""))},addMarkers:function(t){this._markers.each(function(e){t.ownerDocument.getElementById(e.value.id)||(e.value.element=t.appendChild(e.value.element))})},removeMarkers:function(){var e=this.node.ownerSVGElement;if(e){var t=e.getElementsByTagNameNS(NAMESPACE_SVG,"defs");0<t.length&&(t=t[0],this._markers.each(function(e){t.ownerDocument.getElementById(e.value.id)&&(e.value.element=t.removeChild(e.value.element))}))}},_dockerChanged:function(){this._dockerUpdated=!0},serialize:function(){var e=arguments.callee.$.serialize.apply(this),i="";this._dockersByPath.each(function(e){e.value.each(function(e){var t=e.getDockedShape()&&e.referencePoint?e.referencePoint:e.bounds.center();i=i.concat(t.x+" "+t.y+" ")}),i+=" # "}.bind(this)),e.push({name:"dockers",prefix:"oryx",value:i,type:"literal"});var t=this.dockers.last().getDockedShape();t&&e.push({name:"target",prefix:"raziel",value:"#"+ERDF.__stripHashes(t.resourceId),type:"resource"});try{var n=this.getStencil().serialize();n.type&&(n.shape=this,n.data=e,n.result=void 0,n.forceExecution=!0,this._delegateEvent(n),n.result&&(e=n.result))}catch(e){}return e},deserialize:function(e){try{var t=this.getStencil().deserialize();t.type&&(t.shape=this,t.data=e,t.result=void 0,t.forceExecution=!0,this._delegateEvent(t),t.result&&(e=t.result))}catch(e){}var i,n=e.find(function(e){return e.prefix+"-"+e.name=="raziel-target"});n&&(i=this.getCanvas().getChildShapeByResourceId(n.value)),e.findAll(function(e){return e.prefix+"-"+e.name=="raziel-outgoing"}).each(function(e){if(this.parent){var t=this.getCanvas().getChildShapeByResourceId(e.value);t&&(t==i?(this.dockers.last().setDockedShape(t),this.dockers.last().setReferencePoint({x:t.bounds.width()/2,y:t.bounds.height()/2})):t instanceof ORYX.Core.Edge&&t.dockers.first().setDockedShape(this))}}.bind(this));var s=e.find(function(e){return"oryx"===e.prefix&&"dockers"===e.name});s?s.value.split("#").without("").without(" ").each(function(e,t){var i=e.replace(/,/g," ").split(" ").without("");if(i.length%2==0){var n=this._paths[t];if(n){if(0===t)for(;2<this._dockersByPath[n.id].length;)this.removeDocker(this._dockersByPath[n.id][1]);else for(;1<this._dockersByPath[n.id].length;)this.removeDocker(this._dockersByPath[n.id][0]);var s=this._dockersByPath[n.id];if(0===t){var o=parseFloat(i.shift()),a=parseFloat(i.shift());s.first().getDockedShape()?s.first().setReferencePoint({x:o,y:a}):s.first().bounds.centerMoveTo(o,a)}a=parseFloat(i.pop()),o=parseFloat(i.pop()),s.last().getDockedShape()?s.last().setReferencePoint({x:o,y:a}):s.last().bounds.centerMoveTo(o,a);for(var r=0;r<i.length;r++){o=parseFloat(i[r]),a=parseFloat(i[++r]),this.createDocker().bounds.centerMoveTo(o,a)}}}}.bind(this)):this.alignDockers();arguments.callee.$.deserialize.apply(this,arguments),this._changed()},toString:function(){return this.getStencil().title()+" "+this.id},getTarget:function(){return this.dockers.last()?this.dockers.last().getDockedShape():null},getSource:function(){return this.dockers.first()?this.dockers.first().getDockedShape():null},isDocked:function(){var t=!1;return this.dockers.each(function(e){if(e.isDocked())throw t=!0,$break}),t},toJSON:function(){var e=arguments.callee.$.toJSON.apply(this,arguments);return this.getTarget()&&(e.target={resourceId:this.getTarget().resourceId}),e}},ORYX.Core.Edge=ORYX.Core.Shape.extend(ORYX.Core.Edge),!ORYX)var ORYX={};if(ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.AbstractPlugin=Clazz.extend({facade:null,construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADED,this.onLoaded.bind(this))},onLoaded:function(){},onSelectionChanged:function(){},showOverlay:function(e,t,i,n){e instanceof Array||(e=[e]),e=e.map(function(e){var t=e;return"string"==typeof e&&(t=(t=this.facade.getCanvas().getChildShapeByResourceId(e))||this.facade.getCanvas().getChildById(e,!0)),t}.bind(this)).compact(),this.overlayID||(this.overlayID=this.type+ORYX.Editor.provideId()),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_SHOW,id:this.overlayID,shapes:e,attributes:t,node:i,nodePosition:n||"NW"})},hideOverlay:function(){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_HIDE,id:this.overlayID})},doTransform:function(e,t){if(!t||!e)return"";var i=(new DOMParser).parseFromString(e,"text/xml");source=t,new Ajax.Request(source,{asynchronous:!1,method:"get",onSuccess:function(e){xsl=e.responseText}.bind(this),onFailure:function(e){ORYX.Log.error("XSL load failed"+e)}.bind(this)});var n=new XSLTProcessor,s=(new DOMParser).parseFromString(xsl,"text/xml");n.importStylesheet(s);try{var o=n.transformToFragment(i,document),a=(new XMLSerializer).serializeToString(o);return a=a.startsWith("<?xml")?a:'<?xml version="1.0" encoding="UTF-8"?>'+a}catch(e){return-1}},openXMLWindow:function(e){window.open("data:application/xml,"+encodeURIComponent(e),"_blank","resizable=yes,width=600,height=600,toolbar=0,scrollbars=yes")},openDownloadWindow:function(e,t){var i=window.open("");if(null!=i){i.document.open(),i.document.write("<html><body>");var n=i.document.createElement("form");i.document.body.appendChild(n);var s=function(e,t){var i=document.createElement("input");return i.name=e,i.type="hidden",i.value=t,i};n.appendChild(s("download",t)),n.appendChild(s("file",e)),n.method="POST",i.document.write("</body></html>"),i.document.close(),n.action=ORYX.PATH+"/download",n.submit()}},getSerializedDOM:function(){var e=DataManager.serializeDOM(this.facade);return e='<?xml version="1.0" encoding="utf-8"?><html xmlns="http://www.w3.org/1999/xhtml" xmlns:b3mn="http://b3mn.org/2007/b3mn" xmlns:ext="http://b3mn.org/2007/ext" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:atom="http://b3mn.org/2007/atom+xhtml"><head profile="http://purl.org/NET/erdf/profile"><link rel="schema.dc" href="http://purl.org/dc/elements/1.1/" /><link rel="schema.dcTerms" href="http://purl.org/dc/terms/ " /><link rel="schema.b3mn" href="http://b3mn.org" /><link rel="schema.oryx" href="http://oryx-editor.org/" /><link rel="schema.raziel" href="http://raziel.org/" /><base href="'+location.href.split("?")[0]+'" /></head><body>'+e+"</body></html>"},enableReadOnlyMode:function(){this.facade.disableEvent(ORYX.CONFIG.EVENT_MOUSEDOWN),this._stopSelectionChange=function(){0<this.facade.getSelection().length&&this.facade.setSelection([])},this.facade.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,this._stopSelectionChange.bind(this))},disableReadOnlyMode:function(){this.facade.enableEvent(ORYX.CONFIG.EVENT_MOUSEDOWN),this._stopSelectionChange&&(this.facade.unregisterOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,this._stopSelectionChange.bind(this)),this._stopSelectionChange=void 0)},getRDFFromDOM:function(){try{var t="";source=ORYX.PATH+"lib/extract-rdf.xsl",new Ajax.Request(source,{asynchronous:!1,method:"get",onSuccess:function(e){t=e.responseText}.bind(this),onFailure:function(e){ORYX.Log.error("XSL load failed"+e)}.bind(this)});var e=new DOMParser,i=e.parseFromString(this.getSerializedDOM(),"text/xml"),n=e.parseFromString(t,"text/xml"),s=new XSLTProcessor;s.importStylesheet(n);var o=s.transformToFragment(i,document);return(new XMLSerializer).serializeToString(o)}catch(e){return console.log("error serializing "+e),""}},isStencilSetExtensionLoaded:function(t){return this.facade.getStencilSets().values().any(function(e){return e.extensions().keys().any(function(e){return e==t}.bind(this))}.bind(this))},doLayout:function(e){this.facade.raiseEvent?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_LAYOUT,shapes:e}):this.facade.handleEvents({type:ORYX.CONFIG.EVENT_LAYOUT,shapes:e})},layoutEdges:function(e,t,i){if(this.facade.isExecutingCommands()){var n=ORYX.Core.Command.extend({construct:function(e,t,i,n){this.edges=e,this.node=t,this.plugin=n,this.offset=i;var s=t.absoluteXY();this.ulo={x:s.x-i.x,y:s.y-i.y}},execute:function(){this.changes?this.executeAgain():(this.changes=[],this.edges.each(function(e){this.changes.push({edge:e,oldDockerPositions:e.dockers.map(function(e){return e.bounds.center()})})}.bind(this)),this.edges.findAll(function(e){return 2<e.dockers.length}.bind(this)).each(function(e){if(e.dockers.first().getDockedShape()===this.node){var t=e.dockers[1];this.align(t.bounds,e.dockers.first())&&t.update()}else if(e.dockers.last().getDockedShape()===this.node){var i=e.dockers[e.dockers.length-2];this.align(i.bounds,e.dockers.last())&&i.update()}e._update(!0),e.removeUnusedDockers(),this.isBendPointIncluded(e)&&this.plugin.doLayout(e)}.bind(this)),this.edges.each(function(e){if(2==e.dockers.length){var t=e.dockers.first().getAbsoluteReferencePoint()||e.dockers.first().bounds.center(),i=e.dockers.last().getAbsoluteReferencePoint()||e.dockers.first().bounds.center();(Math.abs(-Math.abs(t.x-i.x)+Math.abs(this.offset.x))<2||Math.abs(-Math.abs(t.y-i.y)+Math.abs(this.offset.y))<2)&&this.plugin.doLayout(e)}}.bind(this)),this.edges.each(function(e,t){this.changes[t].dockerPositions=e.dockers.map(function(e){return e.bounds.center()})}.bind(this)))},align:function(e,t){var i=t.getAbsoluteReferencePoint()||t.bounds.center(),n=e.center().x-i.x,s=e.center().y-i.y;if(Math.abs(-Math.abs(n)+Math.abs(this.offset.x))<3&&void 0===this.offset.xs&&e.moveBy({x:-n,y:0}),Math.abs(-Math.abs(s)+Math.abs(this.offset.y))<3&&void 0===this.offset.ys&&e.moveBy({y:-s,x:0}),void 0!==this.offset.xs||void 0!==this.offset.ys){var o=t.getDockedShape().absoluteXY();n=e.center().x-(o.x+(i.x-o.x)/this.offset.xs),s=e.center().y-(o.y+(i.y-o.y)/this.offset.ys),Math.abs(-Math.abs(n)+Math.abs(this.offset.x))<3&&e.moveBy({x:-(e.center().x-i.x),y:0}),Math.abs(-Math.abs(s)+Math.abs(this.offset.y))<3&&e.moveBy({y:-(e.center().y-i.y),x:0})}},isBendPointIncluded:function(n){var s=n.dockers.first().getDockedShape(),o=n.dockers.last().getDockedShape();return s&&(s=s.absoluteBounds()).widen(5),o&&(o=o.absoluteBounds()).widen(20),n.dockers.any(function(e,t){var i=e.bounds.center();return 0!=t&&t!=n.dockers.length-1&&(s&&s.isIncluded(i)||o&&o.isIncluded(i))})},removeAllDocker:function(t){t.dockers.slice(1,t.dockers.length-1).each(function(e){t.removeDocker(e)})},executeAgain:function(){this.changes.each(function(n){this.removeAllDocker(n.edge),n.dockerPositions.each(function(e,t){if(0!=t&&t!=n.dockerPositions.length-1){var i=n.edge.createDocker(void 0,e);i.bounds.centerMoveTo(e),i.update()}}.bind(this)),n.edge._update(!0)}.bind(this))},rollback:function(){this.changes.each(function(n){this.removeAllDocker(n.edge),n.oldDockerPositions.each(function(e,t){if(0!=t&&t!=n.oldDockerPositions.length-1){var i=n.edge.createDocker(void 0,e);i.bounds.centerMoveTo(e),i.update()}}.bind(this)),n.edge._update(!0)}.bind(this))}});this.facade.executeCommands([new n(t,e,i,this)])}}}),!ORYX)var ORYX={};if(ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.AbstractLayouter=ORYX.Plugins.AbstractPlugin.extend({layouted:[],construct:function(e){arguments.callee.$.construct.apply(this,arguments),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LAYOUT,this._initLayout.bind(this))},isIncludedInLayout:function(t){return this.layouted instanceof Array||(this.layouted=[this.layouted].compact()),this.layouted.length<=0||this.layouted.any(function(e){return"string"==typeof e?t.getStencil().id().include(e):t instanceof e})},_initLayout:function(e){var t=[e.shapes].flatten().compact().findAll(function(e){return this.isIncludedInLayout(e)}.bind(this));0<t.length&&this.layout(t)},layout:function(e){throw new Error("Layouter has to implement the layout function.")}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.Edit=Clazz.extend({construct:function(e){this.facade=e,this.clipboard=new ORYX.Plugins.Edit.ClipBoard,this.facade.offer({name:ORYX.I18N.Edit.cut,description:ORYX.I18N.Edit.cutDesc,icon:ORYX.PATH+"images/cut.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:88,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,this.editCut),group:ORYX.I18N.Edit.group,index:1,minShape:1}),this.facade.offer({name:ORYX.I18N.Edit.copy,description:ORYX.I18N.Edit.copyDesc,icon:ORYX.PATH+"images/page_copy.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:67,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,this.editCopy,[!0,!1]),group:ORYX.I18N.Edit.group,index:2,minShape:1}),this.facade.offer({name:ORYX.I18N.Edit.paste,description:ORYX.I18N.Edit.pasteDesc,icon:ORYX.PATH+"images/page_paste.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:86,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,this.editPaste),isEnabled:this.clipboard.isOccupied.bind(this.clipboard),group:ORYX.I18N.Edit.group,index:3,minShape:0,maxShape:0}),this.facade.offer({name:ORYX.I18N.Edit.del,description:ORYX.I18N.Edit.delDesc,icon:ORYX.PATH+"images/cross.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:8,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN},{keyCode:46,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,this.editDelete),group:ORYX.I18N.Edit.group,index:4,minShape:1})},callEdit:function(e,t){window.setTimeout(function(){e.apply(this,t instanceof Array?t:[])}.bind(this),1)},handleMouseDown:function(e){this._controlPressed&&(this._controlPressed=!1,this.editCopy(),this.editPaste(),e.forceExecution=!0,this.facade.raiseEvent(e,this.clipboard.shapesAsJson))},getAllShapesToConsider:function(i){var n=[],s=[];i.each(function(t){if(isChildShapeOfAnother=i.any(function(e){return e.hasChildShape(t)}),!isChildShapeOfAnother){if(n.push(t),t instanceof ORYX.Core.Node){var e=t.getOutgoingNodes();e=e.findAll(function(e){return!i.include(e)}),n=n.concat(e)}s=s.concat(t.getChildShapes(!0))}}.bind(this));var e=this.facade.getCanvas().getChildEdges().select(function(e){return!n.include(e)&&(0!==e.getAllDockedShapes().size()&&e.getAllDockedShapes().all(function(e){return e instanceof ORYX.Core.Edge||s.include(e)}))});return n=n.concat(e)},editCut:function(){return this.editCopy(!1,!0),this.editDelete(!0),!1},editCopy:function(e,t){var i=this.facade.getSelection();0!=i.length&&(this.clipboard.refresh(i,this.getAllShapesToConsider(i),this.facade.getCanvas().getStencil().stencilSet().namespace(),t),e&&this.facade.updateSelection())},editPaste:function(){var e={childShapes:this.clipboard.shapesAsJson,stencilset:{namespace:this.clipboard.SSnamespace}};jQuery.extend(e,ORYX.Core.AbstractShape.JSONHelper);var i=e.getChildShapes(!0).pluck("resourceId"),n={};e.eachChild(function(t,e){return t.outgoing=t.outgoing.select(function(e){return i.include(e.resourceId)}),t.outgoing.each(function(e){n[e.resourceId]||(n[e.resourceId]=[]),n[e.resourceId].push(t)}),t}.bind(this),!0,!0),e.eachChild(function(e,t){return e.target&&!i.include(e.target.resourceId)&&(e.target=void 0,e.targetRemoved=!0),e.dockers&&1<=e.dockers.length&&e.dockers[0].getDocker&&(e.dockers[0].getDocker().getDockedShape()&&!i.include(e.dockers[0].getDocker().getDockedShape().resourceId)||!e.getShape().dockers[0].getDockedShape()&&!n[e.resourceId])&&(e.sourceRemoved=!0),e}.bind(this),!0,!0),e.eachChild(function(i,e){return this.clipboard.useOffset&&(i.bounds={lowerRight:{x:i.bounds.lowerRight.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:i.bounds.lowerRight.y+ORYX.CONFIG.COPY_MOVE_OFFSET},upperLeft:{x:i.bounds.upperLeft.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:i.bounds.upperLeft.y+ORYX.CONFIG.COPY_MOVE_OFFSET}}),i.dockers?i.dockers=i.dockers.map(function(e,t){return(!0===i.targetRemoved&&t==i.dockers.length-1&&e.getDocker||!0===i.sourceRemoved&&0==t&&e.getDocker)&&(e=e.getDocker().bounds.center()),0==t&&e.getDocker instanceof Function&&!0!==i.sourceRemoved&&(e.getDocker().getDockedShape()||0<(n[i.resourceId]||[]).length&&(!(i.getShape()instanceof ORYX.Core.Node)||n[i.resourceId][0].getShape()instanceof ORYX.Core.Node))||t==i.dockers.length-1&&e.getDocker instanceof Function&&!0!==i.targetRemoved&&(e.getDocker().getDockedShape()||i.target)?{x:e.x,y:e.y,getDocker:e.getDocker}:this.clipboard.useOffset?{x:e.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:e.y+ORYX.CONFIG.COPY_MOVE_OFFSET,getDocker:e.getDocker}:{x:e.x,y:e.y,getDocker:e.getDocker}}.bind(this)):i.getShape()instanceof ORYX.Core.Node&&i.dockers&&0<i.dockers.length&&(!i.dockers.first().getDocker||!0===i.sourceRemoved||!i.dockers.first().getDocker().getDockedShape()&&!n[i.resourceId])&&(i.dockers=i.dockers.map(function(e,t){return!0===i.sourceRemoved&&0==t&&e.getDocker&&(e=e.getDocker().bounds.center()),this.clipboard.useOffset?{x:e.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:e.y+ORYX.CONFIG.COPY_MOVE_OFFSET,getDocker:e.getDocker}:{x:e.x,y:e.y,getDocker:e.getDocker}}.bind(this))),i}.bind(this),!1,!0),this.clipboard.useOffset=!0,this.facade.importJSON(e)},editDelete:function(){var e=this.facade.getSelection(),t=new ORYX.Plugins.Edit.ClipBoard;t.refresh(e,this.getAllShapesToConsider(e));var i=new ORYX.Plugins.Edit.DeleteCommand(t,this.facade);this.facade.executeCommands([i])}}),ORYX.Plugins.Edit.ClipBoard=Clazz.extend({construct:function(){this.shapesAsJson=[],this.selection=[],this.SSnamespace="",this.useOffset=!0},isOccupied:function(){return 0<this.shapesAsJson.length},refresh:function(e,t,i,n){this.selection=e,this.SSnamespace=i,this.outgoings={},this.parents={},this.targets={},this.useOffset=!0!==n,this.shapesAsJson=t.map(function(e){var t=e.toJSON();return t.parent={resourceId:e.getParentShape().resourceId},t.parentIndex=e.getParentShape().getChildShapes().indexOf(e),t})}}),ORYX.Plugins.Edit.DeleteCommand=ORYX.Core.Command.extend({construct:function(e,t){this.clipboard=e,this.shapesAsJson=e.shapesAsJson,this.facade=t,this.dockers=this.shapesAsJson.map(function(e){var t=e.getShape(),i=t.getIncomingShapes().map(function(e){return e.getDockers().last()}),n=t.getOutgoingShapes().map(function(e){return e.getDockers().first()});return t.getDockers().concat(i,n).compact().map(function(e){return{object:e,referencePoint:e.referencePoint,dockedShape:e.getDockedShape()}})}).flatten()},execute:function(){this.shapesAsJson.each(function(e){this.facade.deleteShape(e.getShape())}.bind(this)),this.facade.setSelection([]),this.facade.getCanvas().update(),this.facade.updateSelection()},rollback:function(){this.shapesAsJson.each(function(e){var t=e.getShape();(this.facade.getCanvas().getChildShapeByResourceId(e.parent.resourceId)||this.facade.getCanvas()).add(t,t.parentIndex)}.bind(this)),this.dockers.each(function(e){e.object.setDockedShape(e.dockedShape),e.object.setReferencePoint(e.referencePoint)}.bind(this)),this.facade.setSelection(this.selectedShapes),this.facade.getCanvas().update(),this.facade.updateSelection()}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.View={facade:void 0,construct:function(e,t){this.facade=e,this.zoomLevel=1,this.maxFitToScreenLevel=1.5,this.minZoomLevel=.1,this.maxZoomLevel=2.5,this.diff=5,null!=t&&t.properties.each(function(e){e.zoomLevel&&(this.zoomLevel=Number(1)),e.maxFitToScreenLevel&&(this.maxFitToScreenLevel=Number(e.maxFitToScreenLevel)),e.minZoomLevel&&(this.minZoomLevel=Number(e.minZoomLevel)),e.maxZoomLevel&&(this.maxZoomLevel=Number(e.maxZoomLevel))}.bind(this)),this.facade.offer({name:ORYX.I18N.View.zoomIn,functionality:this.zoom.bind(this,[1+ORYX.CONFIG.ZOOM_OFFSET]),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/magnifier_zoom_in.png",description:ORYX.I18N.View.zoomInDesc,index:1,minShape:0,maxShape:0,isEnabled:function(){return this.zoomLevel<this.maxZoomLevel}.bind(this)}),this.facade.offer({name:ORYX.I18N.View.zoomOut,functionality:this.zoom.bind(this,[1-ORYX.CONFIG.ZOOM_OFFSET]),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/magnifier_zoom_out.png",description:ORYX.I18N.View.zoomOutDesc,index:2,minShape:0,maxShape:0,isEnabled:function(){return this._checkSize()}.bind(this)}),this.facade.offer({name:ORYX.I18N.View.zoomStandard,functionality:this.setAFixZoomLevel.bind(this,1),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/zoom_standard.png",cls:"icon-large",description:ORYX.I18N.View.zoomStandardDesc,index:3,minShape:0,maxShape:0,isEnabled:function(){return 1!=this.zoomLevel}.bind(this)}),this.facade.offer({name:ORYX.I18N.View.zoomFitToModel,functionality:this.zoomFitToModel.bind(this),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/image.png",description:ORYX.I18N.View.zoomFitToModelDesc,index:4,minShape:0,maxShape:0})},setAFixZoomLevel:function(e){this.zoomLevel=e,this._checkZoomLevelRange(),this.zoom(1)},zoom:function(e){this.zoomLevel*=e;var t=this.facade.getCanvas().getHTMLContainer().parentNode.parentNode,i=this.facade.getCanvas(),n=i.bounds.width()*this.zoomLevel,s=i.bounds.height()*this.zoomLevel,o=(i.node.parentNode.parentNode.parentNode.offsetHeight-s)/2;o=20<o?o-20:0,i.node.parentNode.parentNode.style.marginTop=o+"px",o+=5,i.getHTMLContainer().style.top=o+"px";var a=t.scrollTop-Math.round((i.getHTMLContainer().parentNode.getHeight()-s)/2)+this.diff,r=t.scrollLeft-Math.round((i.getHTMLContainer().parentNode.getWidth()-n)/2)+this.diff;i.setSize({width:n,height:s},!0),i.node.setAttributeNS(null,"transform","scale("+this.zoomLevel+")"),this.facade.updateSelection(),t.scrollTop=a,t.scrollLeft=r,i.zoomLevel=this.zoomLevel},zoomFitToModel:function(){var e=this.facade.getCanvas().getHTMLContainer().parentNode.parentNode,t=e.getHeight()-30,i=e.getWidth()-30,n=this.facade.getCanvas().getChildShapes();if(!n||n.length<1)return!1;var s=n[0].absoluteBounds().clone();n.each(function(e){s.include(e.absoluteBounds().clone())});var o=i/s.width(),a=t/s.height(),r=a<o?a:o;r>this.maxFitToScreenLevel&&(r=this.maxFitToScreenLevel),this.setAFixZoomLevel(r),e.scrollTop=Math.round(s.upperLeft().y*this.zoomLevel)-5,e.scrollLeft=Math.round(s.upperLeft().x*this.zoomLevel)-5},_checkSize:function(){var e=this.facade.getCanvas().getHTMLContainer().parentNode;return Math.min(e.parentNode.getWidth()/e.getWidth(),e.parentNode.getHeight()/e.getHeight())<1.05},_checkZoomLevelRange:function(){this.zoomLevel<this.minZoomLevel&&(this.zoomLevel=this.minZoomLevel),this.zoomLevel>this.maxZoomLevel&&(this.zoomLevel=this.maxZoomLevel)}},ORYX.Plugins.View=Clazz.extend(ORYX.Plugins.View),!Signavio)var Signavio={};if(Signavio.Core||(Signavio.Core={}),Signavio.Core.Version="1.0",!Signavio)var Signavio=new Object;Signavio.Plugins||(Signavio.Plugins=new Object),Signavio.Plugins.Utils||(Signavio.Plugins.Utils=new Object),Signavio.Helper||(Signavio.Helper=new Object),new function(){ORYX.Editor.provideId=function(){for(var e=[],t=0;t<36;t++)e[t]=Math.floor(16*Math.random());e[14]=4,e[19]=3&e[19]|8;for(t=0;t<36;t++)e[t]="0123456789ABCDEF"[e[t]];return e[8]=e[13]=e[18]=e[23]="-","sid-"+e.join("")}},ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.Loading={construct:function(e){this.facade=e,this.node=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",this.facade.getCanvas().getHTMLContainer().parentNode,["div",{class:"LoadingIndicator"},""]),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADING_ENABLE,this.enableLoading.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADING_DISABLE,this.disableLoading.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADING_STATUS,this.showStatus.bind(this)),this.disableLoading()},enableLoading:function(e){e.text?this.node.innerHTML=e.text+"...":this.node.innerHTML=ORYX.I18N.Loading.waiting,this.node.removeClassName("StatusIndicator"),this.node.addClassName("LoadingIndicator"),this.node.style.display="block";var t=this.facade.getCanvas().rootNode.parentNode.parentNode.parentNode.parentNode;this.node.style.top=t.offsetTop+"px",this.node.style.left=t.offsetLeft+"px"},disableLoading:function(){this.node.style.display="none"},showStatus:function(e){if(e.text){this.node.innerHTML=e.text,this.node.addClassName("StatusIndicator"),this.node.removeClassName("LoadingIndicator"),this.node.style.display="block";var t=this.facade.getCanvas().rootNode.parentNode.parentNode.parentNode.parentNode;this.node.style.top=t.offsetTop+"px",this.node.style.left=t.offsetLeft+"px";var i=e.timeout?e.timeout:2e3;window.setTimeout(function(){this.disableLoading()}.bind(this),i)}}},ORYX.Plugins.Loading=Clazz.extend(ORYX.Plugins.Loading),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.CanvasResize=Clazz.extend({construct:function(e){this.facade=e,new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"N",this.resize.bind(this)),new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"W",this.resize.bind(this)),new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"E",this.resize.bind(this)),new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"S",this.resize.bind(this)),window.setTimeout(function(){jQuery(window).trigger("resize")})},resize:function(e,t){resizeCanvas=function(e,t,i){var n=i.getCanvas(),s=n.bounds,o=i.getCanvas().getHTMLContainer().parentNode.parentNode;if("E"==e||"W"==e?n.setSize({width:(s.width()+t)*n.zoomLevel,height:s.height()*n.zoomLevel}):"S"!=e&&"N"!=e||n.setSize({width:s.width()*n.zoomLevel,height:(s.height()+t)*n.zoomLevel}),"N"==e||"W"==e){var a="N"==e?{x:0,y:t}:{x:t,y:0};n.getChildNodes(!1,function(e){e.bounds.moveBy(a)}),n.getChildEdges().findAll(function(e){return 0<e.getAllDockedShapes().length}).collect(function(e){return e.dockers.findAll(function(e){return!e.getDockedShape()})}).flatten().each(function(e){e.bounds.moveBy(a)})}else"S"==e?o.scrollTop+=t:"E"==e&&(o.scrollLeft+=t);jQuery(window).trigger("resize"),n.update(),i.updateSelection()};var i=ORYX.Core.Command.extend({construct:function(e,t,i){this.position=e,this.extentionSize=t,this.facade=i},execute:function(){resizeCanvas(this.position,this.extentionSize,this.facade)},rollback:function(){resizeCanvas(this.position,-this.extentionSize,this.facade)},update:function(){}}),n=ORYX.CONFIG.CANVAS_RESIZE_INTERVAL;t&&(n=-n);var s=new i(e,n,this.facade);this.facade.executeCommands([s])}}),ORYX.Plugins.CanvasResizeButton=Clazz.extend({construct:function(i,s,e){var o=(this.canvas=i).getHTMLContainer().parentNode;window.myParent=o;var a=jQuery("#canvasSection")[0],r=a,h=jQuery("#canvasSection").find(".ORYX_Editor")[0],c=h.children[0],t="glyphicon glyphicon-chevron-",n="glyphicon glyphicon-chevron-";"N"==s?(t+="up",n+="down"):"S"==s?(t+="down",n+="up"):"E"==s?(t+="right",n+="left"):"W"==s&&(t+="left",n+="right");var d="canvas-shrink-"+s,l="canvas-grow-"+s,u=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",o,["div",{class:"canvas_resize_indicator canvas_resize_indicator_grow "+s,id:d,title:ORYX.I18N.RESIZE.tipGrow+ORYX.I18N.RESIZE[s]},["i",{class:t}]]),f=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",o,["div",{class:"canvas_resize_indicator canvas_resize_indicator_shrink "+s,id:l,title:ORYX.I18N.RESIZE.tipGrow+ORYX.I18N.RESIZE[s]},["i",{class:n}]]),g=function(){u.show();var e=i.bounds.width(),t=i.bounds.height();"N"==s&&t-ORYX.CONFIG.CANVAS_RESIZE_INTERVAL>ORYX.CONFIG.CANVAS_MIN_HEIGHT?f.show():"E"==s&&e-ORYX.CONFIG.CANVAS_RESIZE_INTERVAL>ORYX.CONFIG.CANVAS_MIN_WIDTH?f.show():"S"==s&&t-ORYX.CONFIG.CANVAS_RESIZE_INTERVAL>ORYX.CONFIG.CANVAS_MIN_HEIGHT?f.show():"W"==s&&e-ORYX.CONFIG.CANVAS_RESIZE_INTERVAL>ORYX.CONFIG.CANVAS_MIN_WIDTH?f.show():f.hide()}.bind(this),p=function(){u.hide(),f.hide()};o.parentNode.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,function(e){!function(e){if(-1!=e.target.id.indexOf("canvas-shrink")||-1!=e.target.id.indexOf("canvas-grow")||-1!=e.target.parentNode.id.indexOf("canvas-shrink")||-1!=e.target.parentNode.id.indexOf("canvas-grow"))return e.target.id==d||e.target.id==l||e.target.parentNode.id==d||e.target.parentNode.id==l;if(e.target!=o&&e.target!=r&&e.target!=r.firstChild&&e.target!=c&&e.target!=r)return!1;var t=void 0!==e.offsetX?e.offsetX:e.layerX,i=void 0!==e.offsetY?e.offsetY:e.layerY,n=0;h.clientWidth<a.clientWidth&&(n=(a.clientWidth-h.clientWidth)/2);return i-=a.scrollTop,t-=a.scrollLeft,"N"==s?i<60:"W"==s?t<60+n:"E"==s?a.clientWidth-t<60+n:"S"==s&&a.clientHeight-i<60}(e)?p():g()},!1),u.addEventListener(ORYX.CONFIG.EVENT_MOUSEOVER,function(e){g()},!0),f.addEventListener(ORYX.CONFIG.EVENT_MOUSEOVER,function(e){g()},!0),o.parentNode.addEventListener(ORYX.CONFIG.EVENT_MOUSEOUT,function(e){p()},!0),p(),u.addEventListener("click",function(){e(s),g()},!0),f.addEventListener("click",function(){e(s,!0),g()},!0)}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.RenameShapes=Clazz.extend({facade:void 0,construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_CANVAS_SCROLL,this.hideField.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DBLCLICK,this.actOnDBLClick.bind(this)),this.facade.offer({keyCodes:[{keyCode:113,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.renamePerF2.bind(this)}),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEDOWN,this.hide.bind(this),!0)},renamePerF2:function(){var e=this.facade.getSelection();this.actOnDBLClick(void 0,e.first())},actOnDBLClick:function(t,o){if(o instanceof ORYX.Core.Shape){this.destroy();var e=o.getStencil().properties().findAll(function(e){return e.refToView()&&0<e.refToView().length&&e.directlyEditable()}),i=(e=e.findAll(function(e){return!e.readonly()&&(e.type()==ORYX.CONFIG.TYPE_STRING||e.type()==ORYX.CONFIG.TYPE_EXPRESSION||e.type()==ORYX.CONFIG.TYPE_DATASOURCE)})).collect(function(e){return e.refToView()}).flatten().compact(),n=o.getLabels().findAll(function(t){return i.any(function(e){return t.id.endsWith(e)})});if(0!=n.length){var s=n.length<=1?n[0]:null;if(!s&&!(s=n.find(function(e){return e.node==t.target||e.node==t.target.parentNode}))){var a=this.facade.eventCoordinates(t),r=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI))if(0<=navigator.userAgent.indexOf("MSIE")){var h=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==h&&(r=h/100)}1!==r&&(a.x=a.x/r,a.y=a.y/r),a.y+=$("editor-header").clientHeight-$("canvasSection").scrollTop-5,0==KISBPM.HEADER_CONFIG.showAppTitle&&(a.y+=61),a.x-=$("canvasSection").scrollLeft;var c=this.facade.getCanvas().rootNode.lastChild.getScreenCTM();a.x*=c.a,a.y*=c.d;var d=n.collect(function(e){var t=this.getCenterPosition(e.node);return{diff:Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2)),label:e}}.bind(this));d.sort(function(e,t){return e.diff>t.diff}),s=d[0].label}var l=e.find(function(e){return e.refToView().any(function(e){return s.id==o.id+e})}),u=Math.min(Math.max(100,o.bounds.width()),200),f=this.getCenterPosition(s.node,o);f.x-=u/2;var g=l.prefix()+"-"+l.id(),p=document.createElement("textarea");p.id="shapeTextInput",p.style.position="absolute",p.style.width=u+"px",p.style.left=f.x<10?10:f.x+"px",p.style.top=f.y-15+"px",p.className="x-form-textarea x-form-field x_form_text_set_absolute",p.value=o.properties[g],this.oldValueText=o.properties[g],document.getElementById("canvasSection").appendChild(p),this.shownTextField=p,this.updateValueFunction=function(e,t){var i=o,n=this.facade;if(t!=e){var s=new(ORYX.Core.Command.extend({construct:function(){this.el=i,this.propId=g,this.oldValue=t,this.newValue=e,this.facade=n},execute:function(){this.el.setProperty(this.propId,this.newValue),this.facade.setSelection([this.el]),this.facade.getCanvas().update(),this.facade.updateSelection()},rollback:function(){this.el.setProperty(this.propId,this.oldValue),this.facade.setSelection([this.el]),this.facade.getCanvas().update(),this.facade.updateSelection()}}));this.facade.executeCommands([s])}}.bind(this),jQuery("#shapeTextInput").focus(),jQuery("#shapeTextInput").autogrow(),this.facade.disableEvent(ORYX.CONFIG.EVENT_KEYDOWN)}}},getCenterPosition:function(e,t){if(!e)return{x:0,y:0};for(var i=this.facade.getCanvas().node.getScreenCTM(),n=t.bounds.upperLeft(),s=!0,o=t;s;)if("BPMNDiagram"===o.getParentShape().getStencil().idWithoutNs())s=!1;else{var a=o.getParentShape().bounds.upperLeft();n.x+=a.x,n.y+=a.y,o=o.getParentShape()}var r=t.bounds.midPoint();r.x+=n.x+i.e,r.y+=n.y+i.f,r.x*=i.a,r.y*=i.d;var h=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)&&0<=navigator.userAgent.indexOf("MSIE")){var c=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==c&&(h=c/100)}if(1===h)r.y=r.y-jQuery("#canvasSection").offset().top+5,r.x-=jQuery("#canvasSection").offset().left;else{var d=jQuery("#canvasSection").offset().left,l=jQuery("#canvasSection").scrollLeft(),u=jQuery("#canvasSection").scrollTop(),f=i.e-d*h,g=0;10<f&&(g=f/h-f),r.y=r.y-jQuery("#canvasSection").offset().top*h+5+(u*h-u),r.x=r.x-d*h+g+(l*h-l)}return r},hide:function(e){if(this.shownTextField&&(!e||e.target!==this.shownTextField)){var t=this.shownTextField.value;t!==this.oldValueText&&this.updateValueFunction(t,this.oldValueText),this.destroy()}},hideField:function(e){this.shownTextField&&this.destroy()},destroy:function(e){var t=jQuery("#shapeTextInput");t&&(t.remove(),delete this.shownTextField,this.facade.enableEvent(ORYX.CONFIG.EVENT_KEYDOWN))}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.ProcessLink=Clazz.extend({facade:void 0,construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_PROPERTY_CHANGED,this.propertyChanged.bind(this))},propertyChanged:function(e,t){"oryx-refuri"!==e.name||!t instanceof ORYX.Core.Node||(e.value&&0<e.value.length&&"undefined"!=e.value?this.show(t,e.value):this.hide(t))},show:function(e,t){var i=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["a",{target:"_blank"},["path",{"stroke-width":1,stroke:"#00DD00",fill:"#00AA00",d:"M3,3 l0,-2.5 l7.5,0 l0,-2.5 l7.5,4.5 l-7.5,3.5 l0,-2.5 l-8,0","line-captions":"round"}]]);(i=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["a",{target:"_blank"},["path",{style:"fill:#92BFFC;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:0.72",d:"M0 1.44 L0 15.05 L11.91 15.05 L11.91 5.98 L7.37 1.44 L0 1.44 Z"}],["path",{style:"stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:0.72;fill:none;",transform:"translate(7.5, -8.5)",d:"M0 10.51 L0 15.05 L4.54 15.05"}],["path",{style:"fill:#f28226;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:0.72",transform:"translate(-3, -1)",d:"M0 8.81 L0 13.06 L5.95 13.06 L5.95 15.05 A50.2313 50.2313 -175.57 0 0 10.77 11.08 A49.9128 49.9128 -1.28 0 0 5.95 6.54 L5.95 8.81 L0 8.81 Z"}]])).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_SHOW,id:"arissupport.urlref_"+e.id,shapes:[e],node:i,nodePosition:"SE"})},hide:function(e){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_HIDE,id:"arissupport.urlref_"+e.id})}}),Array.prototype.insertFrom=function(e,t){t=Math.max(0,t);var i=this[e=Math.min(Math.max(0,e),this.length-1)],n=this.without(i),s=n.slice(0,t);return s.push(i),n.length>t&&(s=s.concat(n.slice(t))),s},ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.Arrangement=ORYX.Plugins.AbstractPlugin.extend({facade:void 0,construct:function(e){this.facade=e,this.facade.offer({name:ORYX.I18N.Arrangement.am,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_MIDDLE]),group:ORYX.I18N.Arrangement.groupA,icon:ORYX.PATH+"images/shape_align_middle.png",description:ORYX.I18N.Arrangement.amDesc,index:1,minShape:2}),this.facade.offer({name:ORYX.I18N.Arrangement.ac,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_CENTER]),group:ORYX.I18N.Arrangement.groupA,icon:ORYX.PATH+"images/shape_align_center.png",description:ORYX.I18N.Arrangement.acDesc,index:2,minShape:2}),this.facade.offer({name:ORYX.I18N.Arrangement.as,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_SIZE]),group:ORYX.I18N.Arrangement.groupA,icon:ORYX.PATH+"images/shape_align_size.png",description:ORYX.I18N.Arrangement.asDesc,index:3,minShape:2}),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_TOP,this.setZLevel.bind(this,this.setToTop)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_BACK,this.setZLevel.bind(this,this.setToBack)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_FORWARD,this.setZLevel.bind(this,this.setForward)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_BACKWARD,this.setZLevel.bind(this,this.setBackward))},onSelectionChanged:function(e){var t=this.facade.getSelection();1===t.length&&t[0]instanceof ORYX.Core.Edge&&this.setToTop(t)},setZLevel:function(e,t){var i=new(ORYX.Core.Command.extend({construct:function(e,t,i){this.callback=e,this.elements=t,this.elAndIndex=t.map(function(e){return{el:e,previous:e.parent.children[e.parent.children.indexOf(e)-1]}}),this.facade=i},execute:function(){this.callback(this.elements),this.facade.setSelection(this.elements)},rollback:function(){for(var e=this.elAndIndex.sortBy(function(e){var t=e.el;return $A(t.node.parentNode.childNodes).indexOf(t.node)}),t=0;t<e.length;t++){var i=e[t].el,n=i.parent,s=n.children.indexOf(i),o=n.children.indexOf(e[t].previous);o=o||0,n.children=n.children.insertFrom(s,o),i.node.parentNode.insertBefore(i.node,i.node.parentNode.childNodes[o+1])}this.facade.setSelection(this.elements)}}))(e,this.facade.getSelection(),this.facade);t.excludeCommand?i.execute():this.facade.executeCommands([i])},setToTop:function(e){e.sortBy(function(e,t){return $A(e.node.parentNode.childNodes).indexOf(e.node)}).each(function(e){var t=e.parent;t.children.last()!==e&&(t.children=t.children.without(e),t.children.push(e),e.node.parentNode.appendChild(e.node))})},setToBack:function(e){var t=e.sortBy(function(e,t){return $A(e.node.parentNode.childNodes).indexOf(e.node)});(t=t.reverse()).each(function(e){var t=e.parent;t.children=t.children.without(e),t.children.unshift(e),e.node.parentNode.insertBefore(e.node,e.node.parentNode.firstChild)})},setBackward:function(e){var i=e.sortBy(function(e,t){return $A(e.node.parentNode.childNodes).indexOf(e.node)});(i=i.reverse()).findAll(function(t){return!i.some(function(e){return e.node==t.node.previousSibling})}).each(function(e){if(null!==e.node.previousSibling){var t=e.parent,i=t.children.indexOf(e);t.children=t.children.insertFrom(i,i-1),e.node.parentNode.insertBefore(e.node,e.node.previousSibling)}})},setForward:function(e){var i=e.sortBy(function(e,t){return $A(e.node.parentNode.childNodes).indexOf(e.node)});i.findAll(function(t){return!i.some(function(e){return e.node==t.node.nextSibling})}).each(function(e){var t=e.node.nextSibling;if(null!==t){var i=e.parent.children.indexOf(e),n=e.parent;n.children=n.children.insertFrom(i,i+1),e.node.parentNode.insertBefore(t,e.node)}})},alignShapes:function(e){var i=this.facade.getSelection();if(!((i=(i=(i=this.facade.getCanvas().getShapesWithSharedParent(i)).findAll(function(e){return e instanceof ORYX.Core.Node})).findAll(function(e){var t=e.getIncomingShapes();return 0==t.length||!i.include(t[0])})).length<2)){var t=i[0].absoluteBounds().clone();i.each(function(e){t.include(e.absoluteBounds().clone())});var n=0,s=0;i.each(function(e){n=Math.max(e.bounds.width(),n),s=Math.max(e.bounds.height(),s)});var o=new(ORYX.Core.Command.extend({construct:function(e,t,i,n,s,o){this.elements=e,this.bounds=t,this.maxHeight=i,this.maxWidth=n,this.way=s,this.facade=o.facade,this.plugin=o,this.orgPos=[]},setBounds:function(e,t){if(t||(t={width:ORYX.CONFIG.MAXIMUM_SIZE,height:ORYX.CONFIG.MAXIMUM_SIZE}),!e.bounds)throw"Bounds not definined.";var i={a:{x:e.bounds.upperLeft().x-(this.maxWidth-e.bounds.width())/2,y:e.bounds.upperLeft().y-(this.maxHeight-e.bounds.height())/2},b:{x:e.bounds.lowerRight().x+(this.maxWidth-e.bounds.width())/2,y:e.bounds.lowerRight().y+(this.maxHeight-e.bounds.height())/2}};this.maxWidth>t.width&&(i.a.x=e.bounds.upperLeft().x-(t.width-e.bounds.width())/2,i.b.x=e.bounds.lowerRight().x+(t.width-e.bounds.width())/2),this.maxHeight>t.height&&(i.a.y=e.bounds.upperLeft().y-(t.height-e.bounds.height())/2,i.b.y=e.bounds.lowerRight().y+(t.height-e.bounds.height())/2),e.bounds.set(i)},execute:function(){this.elements.each(function(e,t){this.orgPos[t]=e.bounds.upperLeft();var i,n=this.bounds.clone();if(e.parent&&!(e.parent instanceof ORYX.Core.Canvas)){var s=e.parent.absoluteBounds().upperLeft();n.moveBy(-s.x,-s.y)}switch(this.way){case ORYX.CONFIG.EDITOR_ALIGN_BOTTOM:i={x:e.bounds.upperLeft().x,y:n.b.y-e.bounds.height()};break;case ORYX.CONFIG.EDITOR_ALIGN_MIDDLE:i={x:e.bounds.upperLeft().x,y:(n.a.y+n.b.y-e.bounds.height())/2};break;case ORYX.CONFIG.EDITOR_ALIGN_TOP:i={x:e.bounds.upperLeft().x,y:n.a.y};break;case ORYX.CONFIG.EDITOR_ALIGN_LEFT:i={x:n.a.x,y:e.bounds.upperLeft().y};break;case ORYX.CONFIG.EDITOR_ALIGN_CENTER:i={x:(n.a.x+n.b.x-e.bounds.width())/2,y:e.bounds.upperLeft().y};break;case ORYX.CONFIG.EDITOR_ALIGN_RIGHT:i={x:n.b.x-e.bounds.width(),y:e.bounds.upperLeft().y};break;case ORYX.CONFIG.EDITOR_ALIGN_SIZE:e.isResizable&&(this.orgPos[t]={a:e.bounds.upperLeft(),b:e.bounds.lowerRight()},this.setBounds(e,e.maximumSize))}if(i){var o={x:e.bounds.upperLeft().x-i.x,y:e.bounds.upperLeft().y-i.y};e.bounds.moveTo(i),this.plugin.layoutEdges(e,e.getAllDockedShapes(),o)}}.bind(this))},rollback:function(){this.elements.each(function(e,t){this.way==ORYX.CONFIG.EDITOR_ALIGN_SIZE?e.isResizable&&e.bounds.set(this.orgPos[t]):e.bounds.moveTo(this.orgPos[t])}.bind(this))}}))(i,t,s,n,parseInt(e),this);this.facade.executeCommands([o])}}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.Save=Clazz.extend({facade:void 0,processURI:void 0,changeSymbol:"*",construct:function(e){this.facade=e,document.addEventListener("keydown",function(e){e.ctrlKey&&83===e.keyCode&&Event.stop(e)},!1),window.onbeforeunload=this.onUnLoad.bind(this),this.changeDifference=0,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_UNDO_EXECUTE,function(){this.changeDifference++,this.updateTitle()}.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_EXECUTE_COMMANDS,function(){this.changeDifference++,this.updateTitle()}.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_SAVED,function(){this.changeDifference=0,this.updateTitle()}.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_UNDO_ROLLBACK,function(){this.changeDifference--,this.updateTitle()}.bind(this)),this.hasChanges=this._hasChanges.bind(this)},updateTitle:function(){var e=window.document.title||document.getElementsByTagName("title")[0].childNodes[0].nodeValue;0===this.changeDifference&&e.startsWith(this.changeSymbol)?window.document.title=e.slice(1):0===this.changeDifference||e.startsWith(this.changeSymbol)||(window.document.title=this.changeSymbol+""+e)},_hasChanges:function(){return 0!==this.changeDifference||this.facade.getModelMetaData().new&&0<this.facade.getCanvas().getChildShapes().size()},onUnLoad:function(){if(this._hasChanges())return ORYX.I18N.Save.unsavedData}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.DragDropResize=ORYX.Plugins.AbstractPlugin.extend({construct:function(e){this.facade=e,this.currentShapes=[],this.toMoveShapes=[],this.distPoints=[],this.isResizing=!1,this.dragEnable=!1,this.dragIntialized=!1,this.edgesMovable=!0,this.offSetPosition={x:0,y:0},this.faktorXY={x:1,y:1},this.containmentParentNode,this.isAddingAllowed=!1,this.isAttachingAllowed=!1,this.callbackMouseMove=this.handleMouseMove.bind(this),this.callbackMouseUp=this.handleMouseUp.bind(this);var t=this.facade.getCanvas().getSvgContainer();this.selectedRect=new ORYX.Plugins.SelectedRect(t),ORYX.CONFIG.SHOW_GRIDLINE&&(this.vLine=new ORYX.Plugins.GridLine(t,ORYX.Plugins.GridLine.DIR_VERTICAL),this.hLine=new ORYX.Plugins.GridLine(t,ORYX.Plugins.GridLine.DIR_HORIZONTAL)),t=this.facade.getCanvas().getHTMLContainer(),this.scrollNode=this.facade.getCanvas().rootNode.parentNode.parentNode,this.resizerSE=new ORYX.Plugins.Resizer(t,"southeast",this.facade),this.resizerSE.registerOnResize(this.onResize.bind(this)),this.resizerSE.registerOnResizeEnd(this.onResizeEnd.bind(this)),this.resizerSE.registerOnResizeStart(this.onResizeStart.bind(this)),this.resizerNW=new ORYX.Plugins.Resizer(t,"northwest",this.facade),this.resizerNW.registerOnResize(this.onResize.bind(this)),this.resizerNW.registerOnResizeEnd(this.onResizeEnd.bind(this)),this.resizerNW.registerOnResizeStart(this.onResizeStart.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this))},handleMouseDown:function(e,t){if(this.dragBounds&&this.currentShapes.member(t)&&this.toMoveShapes.length){this.dragEnable=!0,this.dragIntialized=!0,this.edgesMovable=!0;var i=this.facade.getCanvas().node.getScreenCTM();this.faktorXY.x=i.a,this.faktorXY.y=i.d;var n=Event.pointerX(e),s=Event.pointerY(e),o=this.dragBounds.upperLeft();this.offSetPosition={x:n-o.x*this.faktorXY.x,y:s-o.y*this.faktorXY.y},this.offsetScroll={x:this.scrollNode.scrollLeft,y:this.scrollNode.scrollTop},document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.callbackMouseMove,!1),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.callbackMouseUp,!0)}},handleMouseUp:function(e){if(this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"dragdropresize.contain"}),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"dragdropresize.attached"}),this.dragEnable){if(!this.dragIntialized){if(this.afterDrag(),this.isAttachingAllowed&&1==this.toMoveShapes.length&&this.toMoveShapes[0]instanceof ORYX.Core.Node&&0<this.toMoveShapes[0].dockers.length){var t=this.facade.eventCoordinates(e),i=this.toMoveShapes[0].dockers[0],n=[new(ORYX.Core.Command.extend({construct:function(e,t,i,n){this.docker=e,this.newPosition=t,this.newDockedShape=i,this.newParent=i.parent||n.getCanvas(),this.oldPosition=e.parent.bounds.center(),this.oldDockedShape=e.getDockedShape(),this.oldParent=e.parent.parent||n.getCanvas(),this.facade=n,this.oldDockedShape&&(this.oldPosition=e.parent.absoluteBounds().center())},execute:function(){this.dock(this.newDockedShape,this.newParent,this.newPosition),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_ARRANGEMENT_TOP,excludeCommand:!0})},rollback:function(){this.dock(this.oldDockedShape,this.oldParent,this.oldPosition)},dock:function(e,t,i){t.add(this.docker.parent),this.docker.setDockedShape(void 0),this.docker.bounds.centerMoveTo(i),this.docker.setDockedShape(e),this.facade.setSelection([this.docker.parent]),this.facade.getCanvas().update(),this.facade.updateSelection()}}))(i,t,this.containmentParentNode,this.facade)];this.facade.executeCommands(n)}else this.isAddingAllowed&&this.refreshSelectedShapes();this.facade.updateSelection(),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DRAGDROP_END})}this.vLine&&this.vLine.hide(),this.hLine&&this.hLine.hide()}this.dragEnable=!1,document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.callbackMouseUp,!0),document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.callbackMouseMove,!1)},handleMouseMove:function(e){if(this.dragEnable){this.dragIntialized&&(this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DRAGDROP_START}),this.dragIntialized=!1,this.resizerSE.hide(),this.resizerNW.hide(),this._onlyEdges=this.currentShapes.all(function(e){return e instanceof ORYX.Core.Edge}),this.beforeDrag(),this._currentUnderlyingNodes=[]);var t={x:Event.pointerX(e)-this.offSetPosition.x,y:Event.pointerY(e)-this.offSetPosition.y};t.x-=this.offsetScroll.x-this.scrollNode.scrollLeft,t.y-=this.offsetScroll.y-this.scrollNode.scrollTop;var i=e.shiftKey||e.ctrlKey;ORYX.CONFIG.GRID_ENABLED&&!i?t=this.snapToGrid(t):(this.vLine&&this.vLine.hide(),this.hLine&&this.hLine.hide()),t.x/=this.faktorXY.x,t.y/=this.faktorXY.y,t.x=Math.max(0,t.x),t.y=Math.max(0,t.y);var n=this.facade.getCanvas();t.x=Math.min(n.bounds.width()-this.dragBounds.width(),t.x),t.y=Math.min(n.bounds.height()-this.dragBounds.height(),t.y),this.dragBounds.moveTo(t),this.resizeRectangle(this.dragBounds),this.isAttachingAllowed=!1;var s=this.facade.eventCoordinates(e),o=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI))if(0<=navigator.userAgent.indexOf("MSIE")){var a=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==a&&(o=a/100)}1!==o&&(s.x=s.x/o,s.y=s.y/o);var r=$A(this.facade.getCanvas().getAbstractShapesAtPosition(s)),h=1==this.toMoveShapes.length&&this.toMoveShapes[0]instanceof ORYX.Core.Node&&0<this.toMoveShapes[0].dockers.length;if((h=h&&1!=r.length)||r.length!==this._currentUnderlyingNodes.length||!r.all(function(e,t){return this._currentUnderlyingNodes[t]===e}.bind(this))){if(this._onlyEdges)this.isAddingAllowed=!0,this.containmentParentNode=this.facade.getCanvas();else{var c={event:e,underlyingNodes:r,checkIfAttachable:h};this.checkRules(c)}this._currentUnderlyingNodes=r.reverse(),this.isAttachingAllowed?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"dragdropresize.attached",elements:[this.containmentParentNode],style:ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_RECTANGLE,color:ORYX.CONFIG.SELECTION_VALID_COLOR}):this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"dragdropresize.attached"}),this.isAttachingAllowed?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"dragdropresize.contain"}):this.isAddingAllowed?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"dragdropresize.contain",elements:[this.containmentParentNode],color:ORYX.CONFIG.SELECTION_VALID_COLOR}):this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"dragdropresize.contain",elements:[this.containmentParentNode],color:ORYX.CONFIG.SELECTION_INVALID_COLOR})}}},checkRules:function(e){var t=e.event,i=e.underlyingNodes,n=e.checkIfAttachable,s=e.noEdges;if(this.containmentParentNode=i.reverse().find(function(t){return t instanceof ORYX.Core.Canvas||(t instanceof ORYX.Core.Node||t instanceof ORYX.Core.Edge&&!s)&&!(this.currentShapes.member(t)||this.currentShapes.any(function(e){return 0<e.children.length&&e.getChildNodes(!0).member(t)}))}.bind(this)),n&&(this.isAttachingAllowed=this.facade.getRules().canConnect({sourceShape:this.containmentParentNode,edgeShape:this.toMoveShapes[0],targetShape:this.toMoveShapes[0]}),this.isAttachingAllowed)){var o=this.facade.eventCoordinates(t);this.isAttachingAllowed=this.containmentParentNode.isPointOverOffset(o.x,o.y)}this.isAttachingAllowed||(this.isAddingAllowed=this.toMoveShapes.all(function(e){return e instanceof ORYX.Core.Edge||e instanceof ORYX.Core.Controls.Docker||this.containmentParentNode===e.parent||!(this.containmentParentNode===e||this.containmentParentNode instanceof ORYX.Core.Edge&&s||!this.facade.getRules().canContain({containingShape:this.containmentParentNode,containedShape:e}))}.bind(this))),!this.isAttachingAllowed&&!this.isAddingAllowed&&this.containmentParentNode instanceof ORYX.Core.Edge&&(e.noEdges=!0,e.underlyingNodes.reverse(),this.checkRules(e))},refreshSelectedShapes:function(){if(this.dragBounds){var e=this.dragBounds.upperLeft(),t=this.oldDragBounds.upperLeft(),i={x:e.x-t.x,y:e.y-t.y},n=[new ORYX.Core.Command.Move(this.toMoveShapes,i,this.containmentParentNode,this.currentShapes,this)];this._undockedEdgesCommand instanceof ORYX.Core.Command&&n.unshift(this._undockedEdgesCommand),this.facade.executeCommands(n),this.dragBounds&&(this.oldDragBounds=this.dragBounds.clone())}},onResize:function(e){this.dragBounds&&(this.dragBounds=e,this.isResizing=!0,this.resizeRectangle(this.dragBounds))},onResizeStart:function(){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_RESIZE_START})},onResizeEnd:function(){if(this.currentShapes instanceof Array&&!(this.currentShapes.length<=0)&&this.isResizing){var e=ORYX.Core.Command.extend({construct:function(e,t,i){this.shape=e,this.oldBounds=e.bounds.clone(),this.newBounds=t,this.plugin=i},execute:function(){this.shape.bounds.set(this.newBounds.a,this.newBounds.b),this.update(this.getOffset(this.oldBounds,this.newBounds))},rollback:function(){this.shape.bounds.set(this.oldBounds.a,this.oldBounds.b),this.update(this.getOffset(this.newBounds,this.oldBounds))},getOffset:function(e,t){return{x:t.a.x-e.a.x,y:t.a.y-e.a.y,xs:t.width()/e.width(),ys:t.height()/e.height()}},update:function(e){this.shape.getLabels().each(function(e){e.changed()});var t=[].concat(this.shape.getIncomingShapes()).concat(this.shape.getOutgoingShapes()).findAll(function(e){return e instanceof ORYX.Core.Edge}.bind(this));this.plugin.layoutEdges(this.shape,t,e),this.plugin.facade.setSelection([this.shape]),this.plugin.facade.getCanvas().update(),this.plugin.facade.updateSelection()}}),t=this.dragBounds.clone(),i=this.currentShapes[0];if(i.parent){var n=i.parent.absoluteXY();t.moveBy(-n.x,-n.y)}var s=new e(i,t,this);this.facade.executeCommands([s]),this.isResizing=!1,this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_RESIZE_END})}},beforeDrag:function(){var e=ORYX.Core.Command.extend({construct:function(e){this.dockers=e.collect(function(e){return e instanceof ORYX.Core.Controls.Docker?{docker:e,dockedShape:e.getDockedShape(),refPoint:e.referencePoint}:void 0}).compact()},execute:function(){this.dockers.each(function(e){e.docker.setDockedShape(void 0)})},rollback:function(){this.dockers.each(function(e){e.docker.setDockedShape(e.dockedShape),e.docker.setReferencePoint(e.refPoint)})}});this._undockedEdgesCommand=new e(this.toMoveShapes),this._undockedEdgesCommand.execute()},hideAllLabels:function(e){e.getLabels().each(function(e){e.hide()}),e.getAllDockedShapes().each(function(e){var t=e.getLabels();0<t.length&&t.each(function(e){e.hide()})}),e.getChildren().each(function(e){e instanceof ORYX.Core.Shape&&this.hideAllLabels(e)}.bind(this))},afterDrag:function(){},showAllLabels:function(e){for(var t=0;t<e.length;t++){e[t].show()}var i=e.getAllDockedShapes();for(t=0;t<i.length;t++){var n=i[t].getLabels();0<n.length&&n.each(function(e){e.show()})}for(t=0;t<e.children.length;t++){var s=e.children[t];s instanceof ORYX.Core.Shape&&this.showAllLabels(s)}},onSelectionChanged:function(e){var s=e.elements;if(this.dragEnable=!1,this.dragIntialized=!1,this.resizerSE.hide(),this.resizerNW.hide(),s&&0!=s.length){this.currentShapes=s;var t=this.facade.getCanvas().getShapesWithSharedParent(s);this.toMoveShapes=t,this.toMoveShapes=this.toMoveShapes.findAll(function(e){return e instanceof ORYX.Core.Node&&(0===e.dockers.length||!s.member(e.dockers.first().getDockedShape()))}),s.each(function(e){if(e instanceof ORYX.Core.Edge){var i=e.getDockers(),t=s.member(i.first().getDockedShape()),n=s.member(i.last().getDockedShape());if(!t&&!n)!i.first().getDockedShape()&&!i.last().getDockedShape()&&(this.toMoveShapes=this.toMoveShapes.concat(i));2<e.dockers.length&&t&&n&&(this.toMoveShapes=this.toMoveShapes.concat(i.findAll(function(e,t){return 0<t&&t<i.length-1})))}}.bind(this));var i=void 0;if(this.toMoveShapes.each(function(e){var t=e;e instanceof ORYX.Core.Controls.Docker&&(t=e.parent),i?i.include(t.absoluteBounds()):i=t.absoluteBounds()}.bind(this)),i||s.each(function(e){i?i.include(e.absoluteBounds()):i=e.absoluteBounds()}),this.dragBounds=i,this.oldDragBounds=i.clone(),this.resizeRectangle(i),this.selectedRect.show(),1==s.length&&s[0].isResizable){var n=s[0].getStencil().fixedAspectRatio()?s[0].bounds.width()/s[0].bounds.height():void 0;this.resizerSE.setBounds(this.dragBounds,s[0].minimumSize,s[0].maximumSize,n),this.resizerSE.show(),this.resizerNW.setBounds(this.dragBounds,s[0].minimumSize,s[0].maximumSize,n),this.resizerNW.show()}else this.resizerSE.setBounds(void 0),this.resizerNW.setBounds(void 0);ORYX.CONFIG.GRID_ENABLED&&(this.distPoints=[],this.distPointTimeout&&window.clearTimeout(this.distPointTimeout),this.distPointTimeout=window.setTimeout(function(){this.facade.getCanvas().getChildShapes(!0).findAll(function(e){for(var t=e.parent;t;){if(s.member(t))return!1;t=t.parent}return!0}).each(function(e){if(!(e instanceof ORYX.Core.Edge)){var t=e.absoluteXY(),i=e.bounds.width(),n=e.bounds.height();this.distPoints.push({ul:{x:t.x,y:t.y},c:{x:t.x+i/2,y:t.y+n/2},lr:{x:t.x+i,y:t.y+n}})}}.bind(this))}.bind(this),10))}else this.selectedRect.hide(),this.currentShapes=[],this.toMoveShapes=[],this.dragBounds=void 0,this.oldDragBounds=void 0},snapToGrid:function(e){var o,a,r,h,t=this.dragBounds,i=this.vLine?this.vLine.getScale():1,n={x:e.x/i,y:e.y/i},c=e.x/i+t.width()/2,d=e.y/i+t.height()/2;e.x,t.width(),e.y,t.height();return this.distPoints.each(function(e){var t,i,n,s;Math.abs(e.c.x-c)<10&&(t=e.c.x-c,n=e.c.x),Math.abs(e.c.y-d)<10&&(i=e.c.y-d,s=e.c.y),void 0!==t&&(o=void 0===o?t:Math.abs(t)<Math.abs(o)?t:o)===t&&(r=n),void 0!==i&&(a=void 0===a?i:Math.abs(i)<Math.abs(a)?i:a)===i&&(h=s)}),void 0!==o?(n.x+=o,n.x*=i,this.vLine&&r&&this.vLine.update(r)):(n.x=e.x-e.x%(ORYX.CONFIG.GRID_DISTANCE/2),this.vLine&&this.vLine.hide()),void 0!==a?(n.y+=a,n.y*=i,this.hLine&&h&&this.hLine.update(h)):(n.y=e.y-e.y%(ORYX.CONFIG.GRID_DISTANCE/2),this.hLine&&this.hLine.hide()),n},showGridLine:function(){},resizeRectangle:function(e){this.selectedRect.resize(e)}}),ORYX.Plugins.SelectedRect=Clazz.extend({construct:function(e){this.parentId=e,this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",$(e),["g"]),this.dashedArea=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["rect",{x:0,y:0,"stroke-width":1,stroke:"#777777",fill:"none","stroke-dasharray":"2,2","pointer-events":"none"}]),this.hide()},hide:function(){this.node.setAttributeNS(null,"display","none")},show:function(){this.node.setAttributeNS(null,"display","")},resize:function(e){var t=e.upperLeft(),i=ORYX.CONFIG.SELECTED_AREA_PADDING;this.dashedArea.setAttributeNS(null,"width",e.width()+2*i),this.dashedArea.setAttributeNS(null,"height",e.height()+2*i),this.node.setAttributeNS(null,"transform","translate("+(t.x-i)+", "+(t.y-i)+")")}}),ORYX.Plugins.GridLine=Clazz.extend({construct:function(e,t){ORYX.Plugins.GridLine.DIR_HORIZONTAL!==t&&ORYX.Plugins.GridLine.DIR_VERTICAL!==t&&(t=ORYX.Plugins.GridLine.DIR_HORIZONTAL),this.parent=$(e),this.direction=t,this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.parent,["g"]),this.line=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["path",{"stroke-width":1,stroke:"silver",fill:"none","stroke-dasharray":"5,5","pointer-events":"none"}]),this.hide()},hide:function(){this.node.setAttributeNS(null,"display","none")},show:function(){this.node.setAttributeNS(null,"display","")},getScale:function(){try{return this.parent.parentNode.transform.baseVal.getItem(0).matrix.a}catch(e){return 1}},update:function(e){if(this.direction===ORYX.Plugins.GridLine.DIR_HORIZONTAL){var t=e instanceof Object?e.y:e,i=this.parent.parentNode.parentNode.width.baseVal.value/this.getScale();this.line.setAttributeNS(null,"d","M 0 "+t+" L "+i+" "+t)}else{var n=e instanceof Object?e.x:e,s=this.parent.parentNode.parentNode.height.baseVal.value/this.getScale();this.line.setAttributeNS(null,"d","M"+n+" 0 L "+n+" "+s)}this.show()}}),ORYX.Plugins.GridLine.DIR_HORIZONTAL="hor",ORYX.Plugins.GridLine.DIR_VERTICAL="ver",ORYX.Plugins.Resizer=Clazz.extend({construct:function(e,t,i){this.parentId=e,this.orientation=t,this.facade=i,this.node=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",$("canvasSection"),["div",{class:"resizer_"+this.orientation,style:"left:0px; top:0px;position:absolute;"}]),this.node.addEventListener(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this),!0),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.handleMouseUp.bind(this),!0),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.handleMouseMove.bind(this),!1),this.dragEnable=!1,this.offSetPosition={x:0,y:0},this.bounds=void 0,this.canvasNode=this.facade.getCanvas().node,this.minSize=void 0,this.maxSize=void 0,this.aspectRatio=void 0,this.resizeCallbacks=[],this.resizeStartCallbacks=[],this.resizeEndCallbacks=[],this.hide(),this.scrollNode=this.node.parentNode.parentNode.parentNode},handleMouseDown:function(e){this.dragEnable=!0,this.offsetScroll={x:this.scrollNode.scrollLeft,y:this.scrollNode.scrollTop},this.offSetPosition={x:Event.pointerX(e)-this.position.x,y:Event.pointerY(e)-this.position.y},this.resizeStartCallbacks.each(function(e){e(this.bounds)}.bind(this))},handleMouseUp:function(e){this.dragEnable=!1,this.containmentParentNode=null,this.resizeEndCallbacks.each(function(e){e(this.bounds)}.bind(this))},handleMouseMove:function(e){if(this.dragEnable){e.shiftKey||e.ctrlKey?this.aspectRatio=this.bounds.width()/this.bounds.height():this.aspectRatio=void 0;var t={x:Event.pointerX(e)-this.offSetPosition.x,y:Event.pointerY(e)-this.offSetPosition.y};t.x-=this.offsetScroll.x-this.scrollNode.scrollLeft,t.y-=this.offsetScroll.y-this.scrollNode.scrollTop,t.x=Math.min(t.x,this.facade.getCanvas().bounds.width()),t.y=Math.min(t.y,this.facade.getCanvas().bounds.height());var i={x:t.x-this.position.x,y:t.y-this.position.y};this.aspectRatio&&(newAspectRatio=(this.bounds.width()+i.x)/(this.bounds.height()+i.y),newAspectRatio>this.aspectRatio?i.x=this.aspectRatio*(this.bounds.height()+i.y)-this.bounds.width():newAspectRatio<this.aspectRatio&&(i.y=(this.bounds.width()+i.x)/this.aspectRatio-this.bounds.height())),"northwest"===this.orientation?(this.bounds.width()-i.x>this.maxSize.width&&(i.x=-(this.maxSize.width-this.bounds.width()),this.aspectRatio&&(i.y=this.aspectRatio*i.x)),this.bounds.width()-i.x<this.minSize.width&&(i.x=-(this.minSize.width-this.bounds.width()),this.aspectRatio&&(i.y=this.aspectRatio*i.x)),this.bounds.height()-i.y>this.maxSize.height&&(i.y=-(this.maxSize.height-this.bounds.height()),this.aspectRatio&&(i.x=i.y/this.aspectRatio)),this.bounds.height()-i.y<this.minSize.height&&(i.y=-(this.minSize.height-this.bounds.height()),this.aspectRatio&&(i.x=i.y/this.aspectRatio))):(this.bounds.width()+i.x>this.maxSize.width&&(i.x=this.maxSize.width-this.bounds.width(),this.aspectRatio&&(i.y=this.aspectRatio*i.x)),this.bounds.width()+i.x<this.minSize.width&&(i.x=this.minSize.width-this.bounds.width(),this.aspectRatio&&(i.y=this.aspectRatio*i.x)),this.bounds.height()+i.y>this.maxSize.height&&(i.y=this.maxSize.height-this.bounds.height(),this.aspectRatio&&(i.x=i.y/this.aspectRatio)),this.bounds.height()+i.y<this.minSize.height&&(i.y=this.minSize.height-this.bounds.height(),this.aspectRatio&&(i.x=i.y/this.aspectRatio))),"northwest"===this.orientation?(this.bounds.extend({x:-i.x,y:-i.y}),this.bounds.moveBy(i)):this.bounds.extend(i),this.update(),this.resizeCallbacks.each(function(e){e(this.bounds)}.bind(this)),Event.stop(e)}},registerOnResizeStart:function(e){this.resizeStartCallbacks.member(e)||this.resizeStartCallbacks.push(e)},unregisterOnResizeStart:function(e){this.resizeStartCallbacks.member(e)&&(this.resizeStartCallbacks=this.resizeStartCallbacks.without(e))},registerOnResizeEnd:function(e){this.resizeEndCallbacks.member(e)||this.resizeEndCallbacks.push(e)},unregisterOnResizeEnd:function(e){this.resizeEndCallbacks.member(e)&&(this.resizeEndCallbacks=this.resizeEndCallbacks.without(e))},registerOnResize:function(e){this.resizeCallbacks.member(e)||this.resizeCallbacks.push(e)},unregisterOnResize:function(e){this.resizeCallbacks.member(e)&&(this.resizeCallbacks=this.resizeCallbacks.without(e))},hide:function(){this.node.style.display="none"},show:function(){this.bounds&&(this.node.style.display="")},setBounds:function(e,t,i,n){this.bounds=e,t||(t={width:ORYX.CONFIG.MINIMUM_SIZE,height:ORYX.CONFIG.MINIMUM_SIZE}),i||(i={width:ORYX.CONFIG.MAXIMUM_SIZE,height:ORYX.CONFIG.MAXIMUM_SIZE}),this.minSize=t,this.maxSize=i,this.aspectRatio=n,this.update()},update:function(){if(this.bounds){var e=this.bounds.upperLeft();this.bounds.width()<this.minSize.width&&this.bounds.set(e.x,e.y,e.x+this.minSize.width,e.y+this.bounds.height()),this.bounds.height()<this.minSize.height&&this.bounds.set(e.x,e.y,e.x+this.bounds.width(),e.y+this.minSize.height),this.bounds.width()>this.maxSize.width&&this.bounds.set(e.x,e.y,e.x+this.maxSize.width,e.y+this.bounds.height()),this.bounds.height()>this.maxSize.height&&this.bounds.set(e.x,e.y,e.x+this.bounds.width(),e.y+this.maxSize.height);var t=this.canvasNode.getScreenCTM();e.x*=t.a,e.y*=t.d;var i=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI))if(0<=navigator.userAgent.indexOf("MSIE")){var n=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==n&&(i=n/100)}if(1===i)e.y=e.y-jQuery("#canvasSection").offset().top+t.f,e.x=e.x-jQuery("#canvasSection").offset().left+t.e;else{var s=jQuery("#canvasSection").offset().left,o=jQuery("#canvasSection").scrollLeft(),a=jQuery("#canvasSection").scrollTop(),r=t.e-s*i,h=0;10<r&&(h=r/i-r),e.y=e.y-jQuery("#canvasSection").offset().top*i+(a*i-a)+t.f,e.x=e.x-s*i+h+(o*i-o)+t.e}"northwest"===this.orientation?(e.x-=13,e.y-=13):(e.x+=t.a*this.bounds.width()+3,e.y+=t.d*this.bounds.height()+3),this.position=e;var c=jQuery("#flowDesigner");this.node.style.left=this.position.x-c.scrollLeft()+"px",this.node.style.top=this.position.y-c.scrollTop()+25+"px"}}}),ORYX.Core.Command.Move=ORYX.Core.Command.extend({construct:function(e,t,i,n,s){this.moveShapes=e,this.selectedShapes=n,this.offset=t,this.plugin=s,this.newParents=e.collect(function(e){return i||e.parent}),this.oldParents=e.collect(function(e){return e.parent}),this.dockedNodes=e.findAll(function(e){return e instanceof ORYX.Core.Node&&1==e.dockers.length}).collect(function(e){return{docker:e.dockers[0],dockedShape:e.dockers[0].getDockedShape(),refPoint:e.dockers[0].referencePoint}})},execute:function(){this.dockAllShapes(),this.move(this.offset),this.addShapeToParent(this.newParents),this.selectCurrentShapes(),this.plugin.facade.getCanvas().update(),this.plugin.facade.updateSelection()},rollback:function(){var e={x:-this.offset.x,y:-this.offset.y};this.move(e),this.addShapeToParent(this.oldParents),this.dockAllShapes(!0),this.selectCurrentShapes(),this.plugin.facade.getCanvas().update(),this.plugin.facade.updateSelection()},move:function(t,e){for(var i=0;i<this.moveShapes.length;i++){var n=this.moveShapes[i];if(n.bounds.moveBy(t),n instanceof ORYX.Core.Node){(n.dockers||[]).each(function(e){e.bounds.moveBy(t)});var s=[].concat(n.getIncomingShapes()).concat(n.getOutgoingShapes()).findAll(function(t){return t instanceof ORYX.Core.Edge&&!this.moveShapes.any(function(e){return e==t||e instanceof ORYX.Core.Controls.Docker&&e.parent==t})}.bind(this)).findAll(function(e){return!(e.dockers.first().getDockedShape()!=n&&this.moveShapes.include(e.dockers.first().getDockedShape())||e.dockers.last().getDockedShape()!=n&&this.moveShapes.include(e.dockers.last().getDockedShape()))}.bind(this));this.plugin.layoutEdges(n,s,t);for(var o=[].concat(n.getIncomingShapes()).concat(n.getOutgoingShapes()).findAll(function(t){return t instanceof ORYX.Core.Edge&&t.dockers.first().isDocked()&&t.dockers.last().isDocked()&&!this.moveShapes.include(t)&&!this.moveShapes.any(function(e){return e==t||e instanceof ORYX.Core.Controls.Docker&&e.parent==t})}.bind(this)).findAll(function(e){return this.moveShapes.indexOf(e.dockers.first().getDockedShape())>i||this.moveShapes.indexOf(e.dockers.last().getDockedShape())>i}.bind(this)),a=0;a<o.length;a++)for(var r=1;r<o[a].dockers.length-1;r++){var h=o[a].dockers[r];h.getDockedShape()||this.moveShapes.include(h)||h.bounds.moveBy(t)}}}},dockAllShapes:function(e){for(var t=0;t<this.dockedNodes.length;t++){var i=this.dockedNodes[t].docker;i.setDockedShape(e?this.dockedNodes[t].dockedShape:void 0),i.getDockedShape()&&i.setReferencePoint(this.dockedNodes[t].refPoint)}},addShapeToParent:function(t){for(var i=0;i<this.moveShapes.length;i++){var e=this.moveShapes[i];if(e instanceof ORYX.Core.Node&&e.parent!==t[i]){var n=t[i].absoluteXY(),s=e.absoluteXY(),o=s.x-n.x,a=s.y-n.y;if(t[i].add(e),e.getOutgoingShapes(function(e){e instanceof ORYX.Core.Node&&!this.moveShapes.member(e)&&t[i].add(e)}.bind(this)),e instanceof ORYX.Core.Node&&1==e.dockers.length){var r=e.bounds;o+=r.width()/2,a+=r.height()/2,e.dockers.first().bounds.centerMoveTo(o,a)}else e.bounds.moveTo(o,a)}}},selectCurrentShapes:function(){this.plugin.facade.setSelection(this.selectedShapes)}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.DragDocker=Clazz.extend({construct:function(e){this.facade=e,this.VALIDCOLOR=ORYX.CONFIG.SELECTION_VALID_COLOR,this.INVALIDCOLOR=ORYX.CONFIG.SELECTION_INVALID_COLOR,this.shapeSelection=void 0,this.docker=void 0,this.dockerParent=void 0,this.dockerSource=void 0,this.dockerTarget=void 0,this.lastUIObj=void 0,this.isStartDocker=void 0,this.isEndDocker=void 0,this.undockTreshold=10,this.initialDockerPosition=void 0,this.outerDockerNotMoved=void 0,this.isValid=!1,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DOCKERDRAG,this.handleDockerDrag.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEOVER,this.handleMouseOver.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEOUT,this.handleMouseOut.bind(this))},handleMouseOut:function(e,t){!this.docker&&t instanceof ORYX.Core.Controls.Docker?t.hide():!this.docker&&t instanceof ORYX.Core.Edge&&t.dockers.each(function(e){e.hide()})},handleMouseOver:function(e,t){!this.docker&&t instanceof ORYX.Core.Controls.Docker?t.show():!this.docker&&t instanceof ORYX.Core.Edge&&t.dockers.each(function(e){e.show()})},handleDockerDrag:function(e,t){this.handleMouseDown(e.uiEvent,t)},handleMouseDown:function(e,t){if(t instanceof ORYX.Core.Controls.Docker&&t.isMovable){this.shapeSelection=this.facade.getSelection(),this.facade.setSelection(),this.docker=t,this.initialDockerPosition=this.docker.bounds.center(),this.outerDockerNotMoved=!1,this.dockerParent=t.parent,this._commandArg={docker:t,dockedShape:t.getDockedShape(),refPoint:t.referencePoint||t.bounds.center()},this.docker.show(),t.parent instanceof ORYX.Core.Edge&&(t.parent.dockers.first()==t||t.parent.dockers.last()==t)?t.parent.dockers.first()==t&&t.parent.dockers.last().getDockedShape()?this.dockerTarget=t.parent.dockers.last().getDockedShape():t.parent.dockers.last()==t&&t.parent.dockers.first().getDockedShape()&&(this.dockerSource=t.parent.dockers.first().getDockedShape()):(this.dockerSource=void 0,this.dockerTarget=void 0),this.isStartDocker=this.docker.parent.dockers.first()===this.docker,this.isEndDocker=this.docker.parent.dockers.last()===this.docker,this.facade.getCanvas().add(this.docker.parent),this.docker.parent.getLabels().each(function(e){e.hide()});var i=this.facade.eventCoordinates(e),n=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI))if(0<=navigator.userAgent.indexOf("MSIE")){var s=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==s&&(n=s/100)}1!==n&&(i.x=i.x/n,i.y=i.y/n),(this.isStartDocker||this.isEndDocker)&&this.docker.isDocked()?this.outerDockerNotMoved=!0:(this.docker.setDockedShape(void 0),this.docker.bounds.centerMoveTo(i),this.dockerParent._update());var o={movedCallback:this.dockerMoved.bind(this),upCallback:this.dockerMovedFinished.bind(this)};this.startEventPos=i,ORYX.Core.UIEnableDrag(e,t,o)}},dockerMoved:function(e){this.outerDockerNotMoved=!1;var t=void 0;if(this.docker.parent&&(this.isStartDocker||this.isEndDocker)){var i=this.facade.eventCoordinates(e),n=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI))if(0<=navigator.userAgent.indexOf("MSIE")){var s=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==s&&(n=s/100)}if(1!==n&&(i.x=i.x/n,i.y=i.y/n),this.docker.isDocked()){if(ORYX.Core.Math.getDistancePointToPoint(i,this.initialDockerPosition)<this.undockTreshold)return void(this.outerDockerNotMoved=!0);this.docker.setDockedShape(void 0),this.dockerParent._update()}var o=this.facade.getCanvas().getAbstractShapesAtPosition(i),a=o.pop();if(this.docker.parent===a&&(a=o.pop()),this.lastUIObj==a);else if(a instanceof ORYX.Core.Shape){if(this.docker.parent instanceof ORYX.Core.Edge){var r=this.getHighestParentBeforeCanvas(a);if(r instanceof ORYX.Core.Edge&&this.docker.parent===r)return this.isValid=!1,void this.dockerParent._update();this.isValid=!1;for(var h=a,c=a;!this.isValid&&h&&!(h instanceof ORYX.Core.Canvas);)a=h,this.isValid=this.facade.getRules().canConnect({sourceShape:this.dockerSource?this.dockerSource:this.isStartDocker?a:void 0,edgeShape:this.docker.parent,targetShape:this.dockerTarget?this.dockerTarget:this.isEndDocker?a:void 0}),h=h.parent;this.isValid||(a=c)}else this.isValid=this.facade.getRules().canConnect({sourceShape:a,edgeShape:this.docker.parent,targetShape:this.docker.parent});this.lastUIObj&&this.hideMagnets(this.lastUIObj),this.isValid&&this.showMagnets(a),this.showHighlight(a,this.isValid?this.VALIDCOLOR:this.INVALIDCOLOR),this.lastUIObj=a}else this.hideHighlight(),this.lastUIObj&&this.hideMagnets(this.lastUIObj),this.lastUIObj=void 0,this.isValid=!1;this.lastUIObj&&this.isValid&&!e.shiftKey&&!e.ctrlKey&&(t=this.lastUIObj.magnets.find(function(e){return e.absoluteBounds().isIncluded(i)}))&&this.docker.bounds.centerMoveTo(t.absoluteCenterXY())}if(!e.shiftKey&&!e.ctrlKey&&!t){var d=ORYX.CONFIG.DOCKER_SNAP_OFFSET,l=d+1,u=d+1,f=this.docker.bounds.center();if(this.docker.parent)if(this.docker.parent.dockers.each(function(e){if(this.docker!=e){var t=e.referencePoint?e.getAbsoluteReferencePoint():e.bounds.center();l=Math.abs(l)>Math.abs(t.x-f.x)?t.x-f.x:l,u=Math.abs(u)>Math.abs(t.y-f.y)?t.y-f.y:u}}.bind(this)),Math.abs(l)<d||Math.abs(u)<d)l=Math.abs(l)<d?l:0,u=Math.abs(u)<d?u:0,this.docker.bounds.centerMoveTo(f.x+l,f.y+u);else{var g=this.docker.parent.dockers[Math.max(this.docker.parent.dockers.indexOf(this.docker)-1,0)],p=this.docker.parent.dockers[Math.min(this.docker.parent.dockers.indexOf(this.docker)+1,this.docker.parent.dockers.length-1)];if(g&&p&&g!==this.docker&&p!==this.docker){var O=g.bounds.center(),R=p.bounds.center(),S=this.docker.bounds.center();if(ORYX.Core.Math.isPointInLine(S.x,S.y,O.x,O.y,R.x,R.y,10)){var m=(Number(R.y)-Number(O.y))/(Number(R.x)-Number(O.x)),v=(O.y-O.x*m-(S.y-S.x*-Math.pow(m,-1)))/(-Math.pow(m,-1)-m),E=O.y-O.x*m+m*v;if(isNaN(v)||isNaN(E))return;this.docker.bounds.centerMoveTo(v,E)}}}}this.dockerParent._update()},dockerMovedFinished:function(e){if(this.facade.setSelection(this.shapeSelection),this.hideHighlight(),this.dockerParent.getLabels().each(function(e){e.show()}),this.lastUIObj&&(this.isStartDocker||this.isEndDocker)&&(this.isValid&&(this.docker.setDockedShape(this.lastUIObj),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DRAGDOCKER_DOCKED,docker:this.docker,parent:this.docker.parent,target:this.lastUIObj})),this.hideMagnets(this.lastUIObj)),this.docker.hide(),this.outerDockerNotMoved){var t=this.facade.eventCoordinates(e),i=this.facade.getCanvas().getAbstractShapesAtPosition(t),n=i.findAll(function(e){return e instanceof ORYX.Core.Node});i=n.length?n:i,this.facade.setSelection(i)}else{var s=ORYX.Core.Command.extend({construct:function(e,t,i,n,s,o){this.docker=e,this.index=e.parent.dockers.indexOf(e),this.newPosition=t,this.newDockedShape=n,this.oldPosition=i,this.oldDockedShape=s,this.facade=o,this.index=e.parent.dockers.indexOf(e),this.shape=e.parent},execute:function(){this.docker.parent||(this.docker=this.shape.dockers[this.index]),this.dock(this.newDockedShape,this.newPosition),this.removedDockers=this.shape.removeUnusedDockers(),this.facade.updateSelection()},rollback:function(){this.dock(this.oldDockedShape,this.oldPosition),(this.removedDockers||$H({})).each(function(e){this.shape.add(e.value,Number(e.key)),this.shape._update(!0)}.bind(this)),this.facade.updateSelection()},dock:function(e,t){this.docker.setDockedShape(void 0),e?(this.docker.setDockedShape(e),this.docker.setReferencePoint(t)):this.docker.bounds.centerMoveTo(t),this.facade.getCanvas().update()}});if(this.docker.parent){var o=new s(this.docker,this.docker.getDockedShape()?this.docker.referencePoint:this.docker.bounds.center(),this._commandArg.refPoint,this.docker.getDockedShape(),this._commandArg.dockedShape,this.facade);this.facade.executeCommands([o])}}this.docker=void 0,this.dockerParent=void 0,this.dockerSource=void 0,this.dockerTarget=void 0,this.lastUIObj=void 0},hideHighlight:function(){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"validDockedShape"})},showHighlight:function(e,t){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"validDockedShape",elements:[e],color:t})},showMagnets:function(e){e.magnets.each(function(e){e.show()})},hideMagnets:function(e){e.magnets.each(function(e){e.hide()})},getHighestParentBeforeCanvas:function(e){if(e instanceof ORYX.Core.Shape){for(var t=e.parent;t&&!(t.parent instanceof ORYX.Core.Canvas);)t=t.parent;return t}}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.AddDocker=Clazz.extend({construct:function(e){this.facade=e,this.enableAdd=!1,this.enableRemove=!1,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this))},setEnableAdd:function(e){this.enableAdd=e,this.enableAdd?jQuery("#add-bendpoint-button").addClass("pressed"):(jQuery("#add-bendpoint-button").removeClass("pressed"),jQuery("#add-bendpoint-button").blur())},setEnableRemove:function(e){this.enableRemove=e,this.enableRemove?jQuery("#remove-bendpoint-button").addClass("pressed"):(jQuery("#remove-bendpoint-button").removeClass("pressed"),jQuery("#remove-bendpoint-button").blur())},enabledAdd:function(e){return this.enableAdd},enabledRemove:function(){return this.enableRemove},handleMouseDown:function(e,t){this.enabledAdd()&&t instanceof ORYX.Core.Edge?(this.newDockerCommand({edge:t,position:this.facade.eventCoordinates(e)}),this.setEnableAdd(!1)):this.enabledRemove()&&t instanceof ORYX.Core.Controls.Docker&&t.parent instanceof ORYX.Core.Edge&&(this.newDockerCommand({edge:t.parent,docker:t}),this.setEnableRemove(!1)),document.body.style.cursor="default"},newDockerCommand:function(e){if(e.edge){var t=new(ORYX.Core.Command.extend({construct:function(e,t,i,n,s,o){this.addEnabled=e,this.deleteEnabled=t,this.edge=i,this.docker=n,this.pos=s,this.facade=o},execute:function(){this.addEnabled?this.docker?this.edge.add(this.docker,this.index):(this.docker=this.edge.addDocker(this.pos),this.index=this.edge.dockers.indexOf(this.docker)):this.deleteEnabled&&(this.index=this.edge.dockers.indexOf(this.docker),this.pos=this.docker.bounds.center(),this.edge.removeDocker(this.docker)),this.edge.getLabels().invoke("show"),this.facade.getCanvas().update(),this.facade.updateSelection()},rollback:function(){this.addEnabled?this.docker instanceof ORYX.Core.Controls.Docker&&this.edge.removeDocker(this.docker):this.deleteEnabled&&this.edge.add(this.docker,this.index),this.edge.getLabels().invoke("show"),this.facade.getCanvas().update(),this.facade.updateSelection()}}))(this.enabledAdd(),this.enabledRemove(),e.edge,e.docker,e.position,this.facade);this.facade.executeCommands([t])}}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.SelectionFrame=Clazz.extend({construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this)),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.handleMouseUp.bind(this),!0),this.position={x:0,y:0},this.size={width:0,height:0},this.offsetPosition={x:0,y:0},this.moveCallback=void 0,this.offsetScroll={x:0,y:0},this.node=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",$("canvasSection"),["div",{class:"Oryx_SelectionFrame"}]),this.hide()},handleMouseDown:function(e,t){if(t instanceof ORYX.Core.Canvas){var i=t.rootNode.parentNode.parentNode,n=this.facade.getCanvas().node.getScreenCTM();this.offsetPosition={x:n.e,y:n.f},this.setPos({x:Event.pointerX(e)-jQuery("#canvasSection").offset().left,y:Event.pointerY(e)-jQuery("#canvasSection").offset().top+5}),this.resize({width:0,height:0}),this.moveCallback=this.handleMouseMove.bind(this),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.moveCallback,!1),this.offsetScroll={x:i.scrollLeft,y:i.scrollTop},this.show()}Event.stop(e)},handleMouseUp:function(e){if(this.moveCallback){this.hide(),document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.moveCallback,!1),this.moveCallback=void 0;var t=this.facade.getCanvas().node.getScreenCTM(),s={x:0<this.size.width?this.position.x:this.position.x+this.size.width,y:0<this.size.height?this.position.y:this.position.y+this.size.height},o={x:s.x+Math.abs(this.size.width),y:s.y+Math.abs(this.size.height)},i=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI))if(0<=navigator.userAgent.indexOf("MSIE")){var n=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==n&&(i=n/100)}if(1===i)s.x=s.x-(t.e-jQuery("#canvasSection").offset().left),s.y=s.y-(t.f-jQuery("#canvasSection").offset().top),o.x=o.x-(t.e-jQuery("#canvasSection").offset().left),o.y=o.y-(t.f-jQuery("#canvasSection").offset().top);else{var a=jQuery("#canvasSection").offset().left,r=jQuery("#canvasSection").scrollLeft(),h=jQuery("#canvasSection").scrollTop(),c=s.e-a*i,d=0;10<c&&(d=c/i-c),s.x=s.x-(t.e-a*i+d+(r*i-r)),s.y=s.y-(t.f-jQuery("#canvasSection").offset().top*i+(h*i-h)),o.x=o.x-(t.e-a*i+d+(r*i-r)),o.y=o.y-(t.f-jQuery("#canvasSection").offset().top*i+(h*i-h))}s.x/=t.a,s.y/=t.d,o.x/=t.a,o.y/=t.d;var l=this.facade.getCanvas().getChildShapes(!0).findAll(function(e){var t=e.absoluteBounds(),i=t.upperLeft(),n=t.lowerRight();return i.x>s.x&&i.y>s.y&&n.x<o.x&&n.y<o.y});this.facade.setSelection(l)}},handleMouseMove:function(e){var t={width:Event.pointerX(e)-this.position.x-jQuery("#canvasSection").offset().left,height:Event.pointerY(e)-this.position.y-jQuery("#canvasSection").offset().top+5},i=this.facade.getCanvas().rootNode.parentNode.parentNode;t.width-=this.offsetScroll.x-i.scrollLeft,t.height-=this.offsetScroll.y-i.scrollTop,this.resize(t),Event.stop(e)},hide:function(){this.node.style.display="none"},show:function(){this.node.style.display=""},setPos:function(e){this.node.style.top=e.y+"px",this.node.style.left=e.x+"px",this.position=e},resize:function(e){this.setPos(this.position),this.size=Object.clone(e),e.width<0&&(this.node.style.left=this.position.x+e.width+"px",e.width=-e.width),e.height<0&&(this.node.style.top=this.position.y+e.height+"px",e.height=-e.height),this.node.style.width=e.width+"px",this.node.style.height=e.height+"px"}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.ShapeHighlighting=Clazz.extend({construct:function(e){this.parentNode=e.getCanvas().getSvgContainer(),this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.parentNode,["g"]),this.highlightNodes={},e.registerOnEvent(ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,this.setHighlight.bind(this)),e.registerOnEvent(ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,this.hideHighlight.bind(this))},setHighlight:function(e){if(e&&e.highlightId){var t=this.highlightNodes[e.highlightId];t||(t=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["path",{"stroke-width":2,fill:"none"}]),this.highlightNodes[e.highlightId]=t),e.elements&&0<e.elements.length?(this.setAttributesByStyle(t,e),this.show(t)):this.hide(t)}},hideHighlight:function(e){e&&e.highlightId&&this.highlightNodes[e.highlightId]&&this.hide(this.highlightNodes[e.highlightId])},hide:function(e){e.setAttributeNS(null,"display","none")},show:function(e){e.setAttributeNS(null,"display","")},setAttributesByStyle:function(e,t){if(t.style&&t.style==ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_RECTANGLE){var i=t.elements[0].absoluteBounds(),n=t.strokewidth?t.strokewidth:ORYX.CONFIG.BORDER_OFFSET;e.setAttributeNS(null,"d",this.getPathRectangle(i.a,i.b,n)),e.setAttributeNS(null,"stroke",t.color?t.color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR),e.setAttributeNS(null,"stroke-opacity",t.opacity?t.opacity:.2),e.setAttributeNS(null,"stroke-width",n)}else if(1==t.elements.length&&t.elements[0]instanceof ORYX.Core.Edge&&"selection"!=t.highlightId){(s=this.getPathEdge(t.elements[0].dockers))&&0<s.length&&e.setAttributeNS(null,"d",s),e.setAttributeNS(null,"stroke",t.color?t.color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR),e.setAttributeNS(null,"stroke-opacity",t.opacity?t.opacity:.2),e.setAttributeNS(null,"stroke-width",ORYX.CONFIG.OFFSET_EDGE_BOUNDS)}else{var s;(s=this.getPathByElements(t.elements))&&0<s.length&&e.setAttributeNS(null,"d",s),e.setAttributeNS(null,"stroke",t.color?t.color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR),e.setAttributeNS(null,"stroke-opacity",t.opacity?t.opacity:1),e.setAttributeNS(null,"stroke-width",t.strokewidth?t.strokewidth:2)}},getPathByElements:function(e){if(e&&!(e.length<=0)){var s=ORYX.CONFIG.SELECTED_AREA_PADDING,o="";return e.each(function(e){if(e){var t=e.absoluteBounds();t.widen(s);var i=t.upperLeft(),n=t.lowerRight();o+=this.getPath(i,n)}}.bind(this)),o}},getPath:function(e,t){return this.getPathCorners(e,t)},getPathCorners:function(e,t){var i=ORYX.CONFIG.SELECTION_HIGHLIGHT_SIZE,n="";return n=(n=(n=(n=n+"M"+e.x+" "+(e.y+i)+" l0 -"+i+" l"+i+" 0 ")+"M"+e.x+" "+(t.y-i)+" l0 "+i+" l"+i+" 0 ")+"M"+t.x+" "+(t.y-i)+" l0 "+i+" l-"+i+" 0 ")+"M"+t.x+" "+(e.y+i)+" l0 -"+i+" l-"+i+" 0 "},getPathRectangle:function(e,t,i){ORYX.CONFIG.SELECTION_HIGHLIGHT_SIZE;var n="",s=i/2;return n=(n=(n=(n=(n=n+"M"+(e.x+s)+" "+e.y)+" L"+(e.x+s)+" "+(t.y-s))+" L"+(t.x-s)+" "+(t.y-s))+" L"+(t.x-s)+" "+(e.y+s))+" L"+(e.x+s)+" "+(e.y+s)},getPathEdge:function(e){var t=e.length,n="M"+e[0].bounds.center().x+" "+e[0].bounds.center().y;for(i=1;i<t;i++){var s=e[i].bounds.center();n=n+" L"+s.x+" "+s.y}return n}}),ORYX.Plugins.HighlightingSelectedShapes=Clazz.extend({construct:function(e){this.facade=e,this.opacityFull=.9,this.opacityLow=.4},onSelectionChanged:function(e){e.elements&&1<e.elements.length?(this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"selection",elements:e.elements.without(e.subSelection),color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR,opacity:e.subSelection?this.opacityLow:this.opacityFull}),e.subSelection?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"subselection",elements:[e.subSelection],color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR,opacity:this.opacityFull}):this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"subselection"})):(this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"selection"}),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"subselection"}))}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.Overlay=Clazz.extend({facade:void 0,styleNode:void 0,construct:function(e){this.facade=e,this.changes=[],this.facade.registerOnEvent(ORYX.CONFIG.EVENT_OVERLAY_SHOW,this.show.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_OVERLAY_HIDE,this.hide.bind(this)),this.styleNode=document.createElement("style"),this.styleNode.setAttributeNS(null,"type","text/css"),document.getElementsByTagName("head")[0].appendChild(this.styleNode)},show:function(t){if(!(!t||!t.shapes||!t.shapes instanceof Array||!t.id||!t.id instanceof String||0==t.id.length)){t.attributes&&t.shapes.each(function(e){!e instanceof ORYX.Core.Shape||this.setAttributes(e.node,t.attributes)}.bind(this));var e=!0;try{e=t.node&&t.node instanceof SVGElement}catch(e){}t.node&&e&&(t._temps=[],t.shapes.each(function(i,e){if(!(!i instanceof ORYX.Core.Shape)){var n={};if(n.svg=t.dontCloneNode?t.node:t.node.cloneNode(!0),i.node.firstChild.appendChild(n.svg),i instanceof ORYX.Core.Edge&&!t.nodePosition&&(t.nodePosition="START"),t.nodePosition){var s=i.bounds,o=t.nodePosition.toUpperCase();i instanceof ORYX.Core.Node&&"START"==o?o="NW":i instanceof ORYX.Core.Node&&"END"==o?o="SE":i instanceof ORYX.Core.Edge&&"START"==o?s=i.getDockers().first().bounds:i instanceof ORYX.Core.Edge&&"END"==o&&(s=i.getDockers().last().bounds),n.callback=function(){var e=0,t=0;if("NW"==o);else if("N"==o)e=s.width()/2;else if("NE"==o)e=s.width();else if("E"==o)e=s.width(),t=s.height()/2;else if("SE"==o)e=s.width(),t=s.height();else if("S"==o)e=s.width()/2,t=s.height();else if("SW"==o)t=s.height();else if("W"==o)t=s.height()/2;else{if("START"!=o&&"END"!=o)return;e=s.width()/2,t=s.height()/2}i instanceof ORYX.Core.Edge&&(e+=s.upperLeft().x,t+=s.upperLeft().y),n.svg.setAttributeNS(null,"transform","translate("+e+", "+t+")")}.bind(this),n.element=i,n.callback(),s.registerCallback(n.callback)}t._temps.push(n)}}.bind(this))),this.changes[t.id]||(this.changes[t.id]=[]),this.changes[t.id].push(t)}},hide:function(e){e&&e.id&&!(!e.id instanceof String)&&0!=e.id.length&&this.changes[e.id]&&(this.changes[e.id].each(function(e){e.shapes.each(function(e,t){!e instanceof ORYX.Core.Shape||this.deleteAttributes(e.node)}.bind(this)),e._temps&&e._temps.each(function(e){e.svg&&e.svg.parentNode&&e.svg.parentNode.removeChild(e.svg),e.callback&&e.element&&e.element.bounds.unregisterCallback(e.callback)}.bind(this))}.bind(this)),this.changes[e.id]=null)},setAttributes:function(e,t){var i=this.getAllChilds(e.firstChild.firstChild),n=[];i.each(function(e){n.push($A(e.attributes).findAll(function(e){return e.nodeValue.startsWith("url(#")}))}),(n=(n=(n=n.flatten().compact()).collect(function(e){return e.nodeValue}).uniq()).collect(function(e){return e.slice(5,e.length-1)})).unshift(e.id+" .me");var s,o=$H(t).toJSON().gsub(",",";").gsub('"',""),a=t.stroke?o.slice(0,o.length-1)+"; fill:"+t.stroke+";}":o;if(t.fill){var r=Object.clone(t);r.fill="black",s=$H(r).toJSON().gsub(",",";").gsub('"',"")}csstags=n.collect(function(e,t){return"#"+e+" * "+(t?a:o)+(s?" #"+e+" text * "+s:"")});var h=csstags.join(" ")+"\n";this.styleNode.appendChild(document.createTextNode(h))},deleteAttributes:function(t){$A(this.styleNode.childNodes).findAll(function(e){return e.textContent.include("#"+t.id)}).each(function(e){e.parentNode.removeChild(e)})},getAllChilds:function(e){var t=$A(e.childNodes);return $A(e.childNodes).each(function(e){t.push(this.getAllChilds(e))}.bind(this)),t.flatten()}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.KeysMove=ORYX.Plugins.AbstractPlugin.extend({facade:void 0,construct:function(e){this.facade=e,this.copyElements=[],this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:65,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.selectAll.bind(this)}),this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_LEFT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_LEFT,!1)}),this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_LEFT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_LEFT,!0)}),this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_RIGHT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_RIGHT,!1)}),this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_RIGHT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_RIGHT,!0)}),this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_UP,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_UP,!1)}),this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_UP,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_UP,!0)}),this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_DOWN,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_DOWN,!1)}),this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_DOWN,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_DOWN,!0)})},selectAll:function(e){Event.stop(e.event),this.facade.setSelection(this.facade.getCanvas().getChildShapes(!0))},move:function(e,t,i){Event.stop(i.event);var n=t?20:5,s=this.facade.getSelection(),o=this.facade.getSelection(),a={x:0,y:0};switch(e){case ORYX.CONFIG.KEY_CODE_LEFT:a.x=-1*n;break;case ORYX.CONFIG.KEY_CODE_RIGHT:a.x=n;break;case ORYX.CONFIG.KEY_CODE_UP:a.y=-1*n;break;case ORYX.CONFIG.KEY_CODE_DOWN:a.y=n}s=s.findAll(function(e){if(e instanceof ORYX.Core.Node&&1==e.dockers.length&&s.include(e.dockers.first().getDockedShape()))return!1;var t=e.parent;do{if(s.include(t))return!1}while(t=t.parent);return!0});var r=!0;if((!s.all(function(e){return e instanceof ORYX.Core.Edge&&(e.isDocked()&&(r=!1),!0)})||r)&&0<(s=s.map(function(e){if(e instanceof ORYX.Core.Node)return e;if(e instanceof ORYX.Core.Edge){var t=e.dockers;return s.include(e.dockers.first().getDockedShape())&&(t=t.without(e.dockers.first())),s.include(e.dockers.last().getDockedShape())&&(t=t.without(e.dockers.last())),t}return null}).flatten().compact()).size()){var h=[this.facade.getCanvas().bounds.lowerRight().x,this.facade.getCanvas().bounds.lowerRight().y,0,0];if(s.each(function(e){h[0]=Math.min(h[0],e.bounds.upperLeft().x),h[1]=Math.min(h[1],e.bounds.upperLeft().y),h[2]=Math.max(h[2],e.bounds.lowerRight().x),h[3]=Math.max(h[3],e.bounds.lowerRight().y)}),h[0]+a.x<0&&(a.x=-h[0]),h[1]+a.y<0&&(a.y=-h[1]),h[2]+a.x>this.facade.getCanvas().bounds.lowerRight().x&&(a.x=this.facade.getCanvas().bounds.lowerRight().x-h[2]),h[3]+a.y>this.facade.getCanvas().bounds.lowerRight().y&&(a.y=this.facade.getCanvas().bounds.lowerRight().y-h[3]),0!=a.x||0!=a.y){var c=[new ORYX.Core.Command.Move(s,a,null,o,this)];this.facade.executeCommands(c)}}},getUndockedCommant:function(e){var t=ORYX.Core.Command.extend({construct:function(e){this.dockers=e.collect(function(e){return e instanceof ORYX.Core.Controls.Docker?{docker:e,dockedShape:e.getDockedShape(),refPoint:e.referencePoint}:void 0}).compact()},execute:function(){this.dockers.each(function(e){e.docker.setDockedShape(void 0)})},rollback:function(){this.dockers.each(function(e){e.docker.setDockedShape(e.dockedShape),e.docker.setReferencePoint(e.refPoint)})}});return(command=new t(e)).execute(),command}}),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.Layouter||(ORYX.Plugins.Layouter={}),new function(){ORYX.Plugins.Layouter.EdgeLayouter=ORYX.Plugins.AbstractLayouter.extend({layouted:["http://b3mn.org/stencilset/bpmn1.1#SequenceFlow","http://b3mn.org/stencilset/bpmn1.1#MessageFlow","http://b3mn.org/stencilset/timjpdl3#SequenceFlow","http://b3mn.org/stencilset/jbpm4#SequenceFlow","http://b3mn.org/stencilset/bpmn2.0#MessageFlow","http://b3mn.org/stencilset/bpmn2.0#SequenceFlow","http://b3mn.org/stencilset/bpmn2.0choreography#MessageFlow","http://b3mn.org/stencilset/bpmn2.0choreography#SequenceFlow","http://b3mn.org/stencilset/bpmn2.0conversation#ConversationLink","http://b3mn.org/stencilset/epc#ControlFlow","http://www.signavio.com/stencilsets/processmap#ProcessLink","http://www.signavio.com/stencilsets/organigram#connection"],layout:function(e){e.each(function(e){this.doLayout(e)}.bind(this))},doLayout:function(e){var t=e.getIncomingNodes()[0],i=e.getOutgoingNodes()[0];if(t&&i){var n=this.getPositions(t,i,e);0<n.length&&this.setDockers(e,n[0].a,n[0].b)}},getPositions:function(e,t,i){var n=e.absoluteBounds(),s=t.absoluteBounds(),o=n.center(),a=s.center(),r=n.midPoint(),h=s.midPoint(),c=Object.clone(i.dockers.first().referencePoint),d=Object.clone(i.dockers.last().referencePoint),l=i.dockers.first().getAbsoluteReferencePoint(),u=i.dockers.last().getAbsoluteReferencePoint();if(Math.abs(l.x-u.x)<1||Math.abs(l.y-u.y)<1)return[];var f={};f.x=o.x<a.x?(a.x-s.width()/2-(o.x+n.width()/2))/2+(o.x+n.width()/2):(o.x-n.width()/2-(a.x+s.width()/2))/2+(a.x+s.width()/2),f.y=o.y<a.y?(a.y-s.height()/2-(o.y+n.height()/2))/2+(o.y+n.height()/2):(o.y-n.height()/2-(a.y+s.height()/2))/2+(a.y+s.height()/2),n.widen(5),s.widen(20);var g=[],p=this.getOffset.bind(this);return n.isIncluded(a.x,o.y)||s.isIncluded(a.x,o.y)||g.push({a:{x:a.x+p(d,h,"x"),y:o.y+p(c,r,"y")},z:this.getWeight(e,o.x<a.x?"r":"l",t,o.y<a.y?"t":"b",i)}),n.isIncluded(o.x,a.y)||s.isIncluded(o.x,a.y)||g.push({a:{x:o.x+p(c,r,"x"),y:a.y+p(d,h,"y")},z:this.getWeight(e,o.y<a.y?"b":"t",t,o.x<a.x?"l":"r",i)}),n.isIncluded(f.x,o.y)||s.isIncluded(f.x,a.y)||g.push({a:{x:f.x,y:o.y+p(c,r,"y")},b:{x:f.x,y:a.y+p(d,h,"y")},z:this.getWeight(e,"r",t,"l",i,o.x>a.x)}),n.isIncluded(o.x,f.y)||s.isIncluded(a.x,f.y)||g.push({a:{x:o.x+p(c,r,"x"),y:f.y},b:{x:a.x+p(d,h,"x"),y:f.y},z:this.getWeight(e,"b",t,"t",i,o.y>a.y)}),g.sort(function(e,t){return e.z<t.z?1:(e.z,t.z,-1)})},getOffset:function(e,t,i){return e[i]-t[i]},getWeight:function(e,t,i,n,s,o){t=(t||"").toLowerCase(),n=(n||"").toLowerCase(),["t","r","b","l"].include(t)||(t="r"),["t","r","b","l"].include(n)||(t="l"),o&&(t="t"==t?"b":"r"==t?"l":"b"==t?"t":"r",n="t"==n?"b":"r"==n?"l":"b"==n?"t":"r");var a=this.facade.getRules().getLayoutingRules(e,s).out,r=this.facade.getRules().getLayoutingRules(i,s).in,h=a[t],c=r[n],d=function(e,t,i){switch(e){case"t":return Math.abs(t.x-i.x)<2&&t.y<i.y;case"r":return t.x>i.x&&Math.abs(t.y-i.y)<2;case"b":return Math.abs(t.x-i.x)<2&&t.y>i.y;case"l":return t.x<i.x&&Math.abs(t.y-i.y)<2;default:return!1}},l=e.getIncomingShapes().findAll(function(e){return e instanceof ORYX.Core.Edge}).any(function(e){return d(t,e.dockers[e.dockers.length-2].bounds.center(),e.dockers.last().bounds.center())}),u=i.getOutgoingShapes().findAll(function(e){return e instanceof ORYX.Core.Edge}).any(function(e){return d(n,e.dockers[1].bounds.center(),e.dockers.first().bounds.center())});return l||u?0:h+c},setDockers:function(t,e,i){t&&(t.dockers.each(function(e){t.removeDocker(e)}),[e,i].compact().each(function(e){t.createDocker(void 0,e).bounds.centerMoveTo(e)}),t.dockers.each(function(e){e.update()}),t._update(!0))}})},ORYX.Plugins||(ORYX.Plugins=new Object),new function(){ORYX.Plugins.BPMN2_0={construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DRAGDOCKER_DOCKED,this.handleDockerDocked.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_PROPWINDOW_PROP_CHANGED,this.handlePropertyChanged.bind(this)),this.facade.registerOnEvent("layout.bpmn2_0.pool",this.handleLayoutPool.bind(this)),this.facade.registerOnEvent("layout.bpmn2_0.subprocess",this.handleSubProcess.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_SHAPEREMOVED,this.handleShapeRemove.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADED,this.afterLoad.bind(this)),this.namespace=void 0},afterLoad:function(){this.facade.getCanvas().getChildNodes().each(function(e){e.getStencil().id().endsWith("Pool")&&this.handleLayoutPool({shape:e})}.bind(this))},onSelectionChanged:function(e){var i=e.elements;if(i&&1===i.length){var t=this.getNamespace(),n=i[0];if("Pool"===n.getStencil().idWithoutNs()&&0===n.getChildNodes().length){var s={type:t+"Lane",position:{x:0,y:0},namespace:n.getStencil().namespace(),parent:n};this.facade.createShape(s),this.facade.getCanvas().update(),this.facade.setSelection([n])}}if(i.any(function(e){return e instanceof ORYX.Core.Node&&e.getStencil().id().endsWith("Lane")})){var o=i.findAll(function(e){return e instanceof ORYX.Core.Node&&e.getStencil().id().endsWith("Lane")}),a=[],r=[];o.each(function(e){a.push(this.getParentPool(e))}.bind(this)),a=a.uniq().findAll(function(e){var t=this.getLanes(e,!0);return t.all(function(e){return o.include(e)})?(r=r.concat(t),!0):!(!i.include(e)||!t.any(function(e){return o.include(e)}))&&(r=r.concat(t),!0)}.bind(this)),0<r.length&&0<a.length&&(i=(i=i.without.apply(i,r)).concat(a),this.facade.setSelection(i.uniq()))}},handleShapeRemove:function(e){var t=e.shape,i=e.parent;if(t instanceof ORYX.Core.Node&&"Lane"===t.getStencil().idWithoutNs()&&this.facade.isExecutingCommands()){var n=this.getParentPool(i);if(n&&n.parent){var s=function(e){return!e.getChildNodes().any(function(e){return"Lane"===e.getStencil().idWithoutNs()})},o=s(t),a=i.getChildNodes().any(function(e){return"Lane"===e.getStencil().idWithoutNs()});if(o&&a){var r=new c(t,i,n,this);this.facade.executeCommands([r])}else if(o||this.facade.getSelection().any(function(e){return e instanceof ORYX.Core.Node&&"Lane"===e.getStencil().idWithoutNs()&&e.isParent(t)&&s(e)}))o&&!a&&i==n&&i.add(t);else{var h=ORYX.Core.Command.extend({construct:function(e,t){this.children=e.getChildNodes(!0),this.facade=t},execute:function(){this.children.each(function(e){e.bounds.moveBy(30,0)})},rollback:function(){this.children.each(function(e){e.bounds.moveBy(-30,0)})}});this.facade.executeCommands([new h(t,this.facade)])}}}},hashedSubProcesses:{},hashChildShapes:function(e){e.getChildNodes().each(function(e){this.hashedSubProcesses[e.id]&&(this.hashedSubProcesses[e.id]=e.absoluteXY(),this.hashedSubProcesses[e.id].width=e.bounds.width(),this.hashedSubProcesses[e.id].height=e.bounds.height(),this.hashChildShapes(e))}.bind(this))},handleSubProcess:function(e){var t=e.shape;if(!this.hashedSubProcesses[t.id])return this.hashedSubProcesses[t.id]=t.absoluteXY(),this.hashedSubProcesses[t.id].width=t.bounds.width(),void(this.hashedSubProcesses[t.id].height=t.bounds.height());var i=t.absoluteXY();i.x-=this.hashedSubProcesses[t.id].x,i.y-=this.hashedSubProcesses[t.id].y;var n=this.hashedSubProcesses[t.id].width!==t.bounds.width()||this.hashedSubProcesses[t.id].height!==t.bounds.height();this.hashedSubProcesses[t.id]=t.absoluteXY(),this.hashedSubProcesses[t.id].width=t.bounds.width(),this.hashedSubProcesses[t.id].height=t.bounds.height(),this.hashChildShapes(t),this.facade.isExecutingCommands()&&!n&&this.moveChildDockers(t,i)},moveChildDockers:function(e,c){if(c.x||c.y){var d=e.getChildNodes(!0),t=d.map(function(e){return[].concat(e.getIncomingShapes()).concat(e.getOutgoingShapes())}).flatten().uniq().map(function(e){return 2<e.dockers.length?e.dockers.slice(1,e.dockers.length-1):[]}).flatten(),l=e.absoluteBounds();l.moveBy(-c.x,-c.y);var u={};t.each(function(e){if(!e.isChanged){var t=Object.clone(c);if(!l.isIncluded(e.bounds.center())){var i=e.parent.dockers.indexOf(e),n=e.parent.dockers.length,s=e.parent.getSource(),o=e.parent.getTarget();if(!(d.include(s)&&d.include(o))){var a=0!==i&&l.isIncluded(e.parent.dockers[i-1].bounds.center()),r=i!==n-1&&l.isIncluded(e.parent.dockers[i+1].bounds.center());if(!a&&!r)return;var h=e.parent.dockers[a?i-1:i+1];if(Math.abs(-Math.abs(h.bounds.center().x-e.bounds.center().x))<2)t.y=0;else{if(!(Math.abs(-Math.abs(h.bounds.center().y-e.bounds.center().y))<2))return;t.x=0}}}u[e.getId()]={docker:e,offset:t}}}),this.facade.executeCommands([new ORYX.Core.MoveDockersCommand(u)])}},handleDockerDocked:function(e){var t=this.getNamespace(),i=e.parent,n=e.target;i.getStencil().id()===t+"SequenceFlow"&&(n.getStencil().groups().find(function(e){if("Gateways"==e)return e})||"Expression"!=i.properties["oryx-conditiontype"]?i.setProperty("oryx-showdiamondmarker",!1):i.setProperty("oryx-showdiamondmarker",!0),this.facade.getCanvas().update())},handlePropertyChanged:function(e){var i=this.getNamespace(),t=e.elements,n=e.key,s=e.value,o=!1;t.each(function(e){if(e.getStencil().id()===i+"SequenceFlow"&&"oryx-conditiontype"===n){if("Expression"!=s)e.setProperty("oryx-showdiamondmarker",!1);else{var t=e.getIncomingShapes();t||e.setProperty("oryx-showdiamondmarker",!0),t.find(function(e){var t=e.getStencil().groups().find(function(e){if("Gateways"==e)return e});if(t)return t})?e.setProperty("oryx-showdiamondmarker",!1):e.setProperty("oryx-showdiamondmarker",!0)}o=!0}}.bind(this)),o&&this.facade.getCanvas().update()},hashedPoolPositions:{},hashedLaneDepth:{},hashedBounds:{},hashedPositions:{},handleLayoutPool:function(e){var t=e.shape,i=this.facade.getSelection(),n=i.include(t)?t:i.first();if(n=n||t,this.currentPool=t,(n.getStencil().id().endsWith("Pool")||n.getStencil().id().endsWith("Lane"))&&(n===t||n.isParent(t)||this.hashedBounds[t.id][n.id])){this.hashedBounds[t.id]||(this.hashedBounds[t.id]={});var s=this.getLanes(t);if(!(s.length<=0)){var o=this.getLanes(t,!0),a=o.clone(),r=$H({});if(o.each(function(e){r[e.id]=e.bounds.upperLeft()}),1===s.length&&this.getLanes(s.first()).length<=0)s.first().setProperty("oryx-showcaption",0<s.first().properties["oryx-name"].trim().length),s.first().node.getElementsByTagName("rect")[0].setAttributeNS(null,"display","none");else o.invoke("setProperty","oryx-showcaption",!0),o.each(function(e){e.node.getElementsByTagName("rect")[0].removeAttributeNS(null,"display")});for(var h=[],c=[],d=-1;++d<o.length;)this.hashedBounds[t.id][o[d].id]||c.push(o[d]);0<c.length&&(n=c.first());var l,u,f,g,p=$H(this.hashedBounds[t.id]).keys();for(d=-1;++d<p.length;)o.any(function(e){return e.id==p[d]})||(h.push(this.hashedBounds[t.id][p[d]]),i=i.without(function(e){return e.id==p[d]}));if(0<h.length||0<c.length)l=1===c.length&&1===this.getLanes(c[0].parent).length?this.adjustHeight(s,c[0].parent):this.updateHeight(t),u=this.adjustWidth(s,t.bounds.width()),t.update();else if(t==n){if(1===i.length&&this.isResized(t,this.hashedPoolPositions[t.id])){var O=this.hashedPoolPositions[t.id].upperLeft(),R=t.bounds.upperLeft(),S=0;if(this.shouldScale(t))S=this.hashedPoolPositions[t.id].height()/t.bounds.height();this.adjustLanes(t,o,O.x-R.x,O.y-R.y,S)}l=this.adjustHeight(s,void 0,t.bounds.height()),u=this.adjustWidth(s,t.bounds.width())}else{if(1===i.length&&this.isResized(n,this.hashedBounds[t.id][n.id])){O=this.hashedBounds[t.id][n.id].upperLeft(),R=n.absoluteXY();f=O.x-R.x,g=O.y-R.y,(f||g)&&(a=a.without(n),this.adjustLanes(t,this.getAllExcludedLanes(t,n),f,0));var m=this.getLanes(n,!0);if(0<m.length)if(this.shouldScale(n)){S=this.hashedBounds[t.id][n.id].height()/n.bounds.height();this.adjustLanes(t,m,f,g,S)}else this.adjustLanes(t,m,f,g,0)}var v=o.map(function(e){return{shape:e,bounds:e.bounds.clone()}});l=this.adjustHeight(s,n),this.checkForChanges(o,v),u=this.adjustWidth(s,n.bounds.width()+30*this.getDepth(n,t))}if(this.setDimensions(t,u,l,f,g),this.facade.isExecutingCommands()&&(0===h.length||0!==c.length)&&(this.updateDockers(a,t),this.hashedPositions[t.id]&&this.hashedPositions[t.id].keys().any(function(e,t){return(o[t]||{}).id!==e}))){var E=ORYX.Core.Command.extend({construct:function(e,t,i,n,s){this.originPosition=Object.clone(e),this.newPosition=Object.clone(t),this.lanes=i,this.plugin=n,this.pool=s},execute:function(){this.executed||(this.executed=!0,this.lanes.each(function(e){this.newPosition[e.id]&&e.bounds.moveTo(this.newPosition[e.id])}.bind(this)),this.plugin.hashedPositions[this.pool]=Object.clone(this.newPosition))},rollback:function(){this.lanes.each(function(e){this.originPosition[e.id]&&e.bounds.moveTo(this.originPosition[e.id])}.bind(this)),this.plugin.hashedPositions[this.pool]=Object.clone(this.originPosition)}}),b=$H({});o.each(function(e){b[e.id]=e.bounds.upperLeft()});var C=new E(r,b,o,this,t.id);this.facade.executeCommands([C])}this.hashedBounds[t.id]={},this.hashedPositions[t.id]=r;for(d=-1;++d<o.length;)this.hashedBounds[t.id][o[d].id]=o[d].absoluteBounds(),this.hashChildShapes(o[d]),this.hashedLaneDepth[o[d].id]=this.getDepth(o[d],t),this.forceToUpdateLane(o[d]);this.hashedPoolPositions[t.id]=t.bounds.clone()}}},shouldScale:function(e){var t=e.getChildNodes().findAll(function(e){return e.getStencil().id().endsWith("Lane")});return 1<t.length||t.any(function(e){return this.shouldScale(e)}.bind(this))},checkForChanges:function(e,t){if(this.facade.isExecutingCommands()&&t.any(function(e){return e.shape.bounds.toString()!==e.bounds.toString()})){var i=ORYX.Core.Command.extend({construct:function(e){this.oldState=e,this.newState=e.map(function(e){return{shape:e.shape,bounds:e.bounds.clone()}})},execute:function(){this.executed&&this.applyState(this.newState),this.executed=!0},rollback:function(){this.applyState(this.oldState)},applyState:function(e){e.each(function(e){e.shape.bounds.set(e.bounds.upperLeft(),e.bounds.lowerRight())})}});this.facade.executeCommands([new i(t)])}},isResized:function(e,t){if(!t||!e)return!1;var i=t;return 0!==Math.round(i.width()-e.bounds.width())||0!==Math.round(i.height()-e.bounds.height())},adjustLanes:function(t,e,i,n,s){s=s||0,e.each(function(e){e.getChildNodes().each(function(e){if(!e.getStencil().id().endsWith("Lane")){var t=s?e.bounds.center().y-e.bounds.center().y/s:-n;e.bounds.moveBy(i||0,-t),s&&e.getStencil().id().endsWith("Subprocess")&&this.moveChildDockers(e,{x:0,y:-t})}}.bind(this)),this.hashedBounds[t.id][e.id].moveBy(-(i||0),s?0:-n),s&&(e.isScaled=!0)}.bind(this))},getAllExcludedLanes:function(e,t){var i=[];return e.getChildNodes().each(function(e){t&&e===t||!e.getStencil().id().endsWith("Lane")||(i.push(e),i=i.concat(this.getAllExcludedLanes(e,t)))}.bind(this)),i},forceToUpdateLane:function(e){e.bounds.height()!==e._svgShapes[0].height&&(e.isChanged=!0,e.isResized=!0,e._update())},getDepth:function(e,t){for(var i=0;e&&e.parent&&e!==t;)e=e.parent,++i;return i},updateDepth:function(e,t,i){var n=30*(t-i);e.getChildNodes().each(function(e){e.bounds.moveBy(n,0),[].concat(children[j].getIncomingShapes()).concat(children[j].getOutgoingShapes())})},setDimensions:function(e,t,i,n,s){var o=e.getStencil().id().endsWith("Lane");e.bounds.set(o?30:e.bounds.a.x-(n||0),o?e.bounds.a.y:e.bounds.a.y-(s||0),t?e.bounds.a.x+t-(o?30:n||0):e.bounds.b.x,i?e.bounds.a.y+i-(o?0:s||0):e.bounds.b.y)},setLanePosition:function(e,t){e.bounds.moveTo(30,t)},adjustWidth:function(e,t){return(e||[]).each(function(e){this.setDimensions(e,t),this.adjustWidth(this.getLanes(e),t-30)}.bind(this)),t},adjustHeight:function(e,t,i){var n=0;if(!t&&i)for(var s=-1;++s<e.length;)n+=e[s].bounds.height();s=-1;for(var o=0;++s<e.length;){if(e[s]===t)this.adjustHeight(this.getLanes(e[s]),void 0,e[s].bounds.height()),e[s].bounds.set({x:30,y:o},{x:e[s].bounds.width()+30,y:e[s].bounds.height()+o});else if(!t&&i){var a=e[s].bounds.height()*i/n;this.adjustHeight(this.getLanes(e[s]),void 0,a),this.setDimensions(e[s],null,a),this.setLanePosition(e[s],o)}else{(a=this.adjustHeight(this.getLanes(e[s]),t,i))||(a=e[s].bounds.height()),this.setDimensions(e[s],null,a),this.setLanePosition(e[s],o)}o+=e[s].bounds.height()}return o},updateHeight:function(e){var t=this.getLanes(e);if(0==t.length)return e.bounds.height();for(var i=0,n=-1;++n<t.length;)this.setLanePosition(t[n],i),i+=this.updateHeight(t[n]);return this.setDimensions(e,null,i),i},getOffset:function(e,t,i){var n={x:0,y:0},s=(n=e.absoluteXY(),this.hashedBounds[i.id][e.id]||(!0===t?this.hashedPoolPositions[e.id]:void 0));return s?(n.x-=s.upperLeft().x,n.y-=s.upperLeft().y,n):{x:0,y:0}},getNextLane:function(e){for(;e&&!e.getStencil().id().endsWith("Lane");){if(e instanceof ORYX.Core.Canvas)return null;e=e.parent}return e},getParentPool:function(e){for(;e&&!e.getStencil().id().endsWith("Pool");){if(e instanceof ORYX.Core.Canvas)return null;e=e.parent}return e},updateDockers:function(e,t){for(var i,n=t.absoluteBounds(),s=[],o=(this.hashedPoolPositions[t.id]||n).clone(),a=-1,r=-1,h=-1,c=-1,d={};++a<e.length;)if(this.hashedBounds[t.id][e[a].id]){var l=e[a].isScaled;delete e[a].isScaled;var u=e[a].getChildNodes(),f=e[a].absoluteBounds(),g=this.hashedBounds[t.id][e[a].id]||f,p=this.getOffset(e[a],!0,t),O=0,R=this.getDepth(e[a],t);for(void 0!==this.hashedLaneDepth[e[a].id]&&this.hashedLaneDepth[e[a].id]!==R&&(O=30*(this.hashedLaneDepth[e[a].id]-R),p.x+=O),r=-1;++r<u.length;){O&&!u[r].getStencil().id().endsWith("Lane")&&(s.push({xOffset:O,shape:u[r]}),u[r].bounds.moveBy(O,0)),u[r].getStencil().id().endsWith("Subprocess")&&this.moveChildDockers(u[r],p);var S=[].concat(u[r].getIncomingShapes()).concat(u[r].getOutgoingShapes()).findAll(function(e){return e instanceof ORYX.Core.Edge});for(h=-1;++h<S.length;)if(S[h].getStencil().id().endsWith("MessageFlow"))this.layoutEdges(u[r],[S[h]],p);else for(c=-1;++c<S[h].dockers.length;)if(!(i=S[h].dockers[c]).getDockedShape()&&!i.isChanged){pos=i.bounds.center();var m=g.isIncluded(pos),v=(o.isIncluded(pos),0==c||g.isIncluded(S[h].dockers[c-1].bounds.center()),c==S[h].dockers.length-1||g.isIncluded(S[h].dockers[c+1].bounds.center()),Object.clone(p));if(l&&m&&this.isResized(e[a],this.hashedBounds[t.id][e[a].id])){var E=pos.y-f.upperLeft().y+v.y;v.y-=E-E*(f.height()/g.height())}m&&(d[i.id]={docker:i,offset:v})}}}var b=ORYX.Core.Command.extend({construct:function(e){this.state=e},execute:function(){this.executed&&this.state.each(function(e){e.shape.bounds.moveBy(e.xOffset,0)}),this.executed=!0},rollback:function(){this.state.each(function(e){e.shape.bounds.moveBy(-e.xOffset,0)})}});this.facade.executeCommands([new ORYX.Core.MoveDockersCommand(d),new b(s)])},moveBy:function(e,t){return e.x+=t.x,e.y+=t.y,e},getHashedBounds:function(e){return this.currentPool&&this.hashedBounds[this.currentPool.id][e.id]?this.hashedBounds[this.currentPool.id][e.id]:e.absoluteBounds()},getLanes:function(e,t){var i=this.getNamespace(),n=e.getChildNodes(t||!1).findAll(function(e){return e.getStencil().id()===i+"Lane"});return n=n.sort(function(e,t){var i=Math.round(e.bounds.upperLeft().y),n=Math.round(t.bounds.upperLeft().y),s=Math.round(e.bounds.lowerRight().y),o=Math.round(t.bounds.lowerRight().y),a=this.getHashedBounds(e),r=this.getHashedBounds(t),h=Math.round(a.upperLeft().y),c=Math.round(r.upperLeft().y),d=Math.round(a.lowerRight().y),l=Math.round(r.lowerRight().y);return i==n&&s==o&&(i=h,n=c,s=d,o=l),0===Math.round(e.bounds.height()-a.height())&&0===Math.round(t.bounds.height()-r.height())?i<n?-1:n<i?1:0:i<n&&s<o||i<n&&o<=s&&d<l||n<=i&&s<o&&h<c?-1:n<i&&o<s||n<i&&s<=o&&l<d||i<=n&&o<s&&c<h?1:0}.bind(this))},getNamespace:function(){if(!this.namespace){var e=this.facade.getStencilSets();if(!e.keys())return;this.namespace=e.keys()[0]}return this.namespace}};var c=ORYX.Core.Command.extend({construct:function(e,t,i,n){this.facade=n.facade,this.plugin=n,this.shape=e,this.changes,this.pool=i,this.parent=t,this.shapeChildren=[],this.shape.getChildShapes().each(function(e){this.shapeChildren.push({shape:e,bounds:{a:{x:e.bounds.a.x,y:e.bounds.a.y},b:{x:e.bounds.b.x,y:e.bounds.b.y}}})}.bind(this)),this.shapeUpperLeft=this.shape.bounds.upperLeft(),this.parentHeight=this.parent.bounds.height()},getLeafLanes:function(e){var t=this.plugin.getLanes(e).map(function(e){return this.getLeafLanes(e)}.bind(this)).flatten();return 0<t.length?t:[e]},findNewLane:function(){this.plugin.getLanes(this.parent);var e=this.getLeafLanes(this.parent);this.lane=e.find(function(e){return e.bounds.upperLeft().y>=this.shapeUpperLeft.y}.bind(this))||e.last(),this.laneUpperLeft=this.lane.bounds.upperLeft()},execute:function(){if(this.changes)this.executeAgain();else{if(this.lane||this.findNewLane(),this.lane){var e=this.laneUpperLeft,t=this.shapeUpperLeft,i=this.plugin.getDepth(this.lane,this.parent)-1;this.changes=$H({}),e.y>=t.y?(this.lane.getChildShapes().each(function(e){this.changes[e.getId()]||(this.changes[e.getId()]=this.computeChanges(e,this.lane,this.lane,this.shape.bounds.height())),e.bounds.moveBy(0,this.shape.bounds.height())}.bind(this)),this.plugin.hashChildShapes(this.lane),this.shapeChildren.each(function(e){e.shape.bounds.set(e.bounds),e.shape.bounds.moveBy(t.x-30-30*i,0),this.changes[e.shape.getId()]||(this.changes[e.shape.getId()]=this.computeChanges(e.shape,this.shape,this.lane,0)),this.lane.add(e.shape)}.bind(this)),this.lane.bounds.moveBy(0,t.y-e.y)):t.y>e.y&&this.shapeChildren.each(function(e){e.shape.bounds.set(e.bounds),e.shape.bounds.moveBy(t.x-30-30*i,this.lane.bounds.height()),this.changes[e.shape.getId()]||(this.changes[e.shape.getId()]=this.computeChanges(e.shape,this.shape,this.lane,0)),this.lane.add(e.shape)}.bind(this))}var n=this.lane.bounds.height(),s=1===this.lane.length?this.parentHeight:this.lane.bounds.height()+this.shape.bounds.height();this.setHeight(s,n,this.parent,this.parentHeight,!0),this.plugin.getLanes(this.parent).each(function(e){this.changes[e.getId()]||e===this.lane||e===this.shape||(this.changes[e.getId()]=this.computeChanges(e,this.parent,this.parent,0))}.bind(this)),this.update()}},setHeight:function(e,t,i,n,s){this.plugin.setDimensions(this.lane,this.lane.bounds.width(),e),this.plugin.hashedBounds[this.pool.id][this.lane.id]=this.lane.absoluteBounds(),this.plugin.adjustHeight(this.plugin.getLanes(i),this.lane),!0===s&&(this.changes[this.shape.getId()]=this.computeChanges(this.shape,i,i,0,t,e)),this.plugin.setDimensions(i,i.bounds.width(),n),i!==this.pool&&this.plugin.setDimensions(this.pool,this.pool.bounds.width(),this.pool.bounds.height()+(e-t))},update:function(){this.plugin.hashedBounds[this.pool.id].REMOVED=!0},rollback:function(){var o=this.laneUpperLeft,a=this.shapeUpperLeft;this.changes.each(function(e){var t=e.value.oldParent,i=e.value.shape,n=(e.value.parentHeight,e.value.oldHeight),s=e.value.newHeight;i.getStencil().id().endsWith("Lane")&&i.bounds.moveTo(e.value.oldPosition),n?(this.setHeight(n,s,t,t.bounds.height()+(n-s)),o.y>=a.y&&this.lane.bounds.moveBy(0,this.shape.bounds.height()-1)):(t.add(i),i.bounds.moveTo(e.value.oldPosition))}.bind(this))},executeAgain:function(){this.changes.each(function(e){var t=e.value.newParent,i=e.value.shape,n=e.value.newHeight,s=e.value.oldHeight;if(n){var o=this.laneUpperLeft.y,a=this.shapeUpperLeft.y;a<=o&&this.lane.bounds.moveBy(0,a-o),this.setHeight(n,s,t,t.bounds.height()+(n-s))}else t.add(i),i.bounds.moveTo(e.value.newPosition)}.bind(this)),this.update()},computeChanges:function(e,t,i,n,s,o){t=this.changes[e.getId()]?this.changes[e.getId()].oldParent:t;var a=this.changes[e.getId()]?this.changes[e.getId()].oldPosition:e.bounds.upperLeft(),r=e.bounds.upperLeft(),h={x:r.x,y:r.y+n};return{shape:e,parentHeight:t.bounds.height(),oldParent:t,oldPosition:a,oldHeight:s,newParent:i,newPosition:h,newHeight:o}}});ORYX.Plugins.BPMN2_0=ORYX.Plugins.AbstractPlugin.extend(ORYX.Plugins.BPMN2_0)};